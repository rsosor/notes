Java çš„è¨»è§£é¡ä¼¼ C# çš„ Attributeç‰¹æ€§

ï¼Spring æ ¸å¿ƒè¨»è§£

1. stereotype(æ¨¡å¼è¨»è§£): @Controllerã€@Serviceã€@Repositoryã€@Componentã€@Configuration

2. IOC: @Autowiredã€@Qualifierã€@Resourceã€@Valueã€@Lookup

3. äº‹å‹™: @EnableTransactionManagementã€@Transactionalã€@TransactionalEventListener

4. @Order

5. @AliasFor

6. @Indexed ç‚º Spring æ¨¡å¼è¨»è§£æ·»åŠ ç´¢å¼•ï¼Œæå‡æ‡‰ç”¨å•Ÿå‹•æ€§èƒ½



ï¼Spring ä¸Šä¸‹æ–‡è¨»è§£

1. é…ç½®ç›¸é—œ: @Configurationã€@Beanã€@ComponentScanã€@PropertySourceã€@PropertySourcesã€@Conditionalã€@Importã€@ImportSourceã€@Profileã€@Lazyã€@Descriptionã€@Scopeã€@Primary

2. å…¶ä»–: @EventListenerã€@EnableAspectJAutoProxy ç”¨æ–¼é–‹å•Ÿæ”¯æ´ AspectJ çš„ @Aspect åˆ‡é¢é…ç½®æ”¯æ´ï¼Œä½¿ç”¨ Spring Boot å¼•å…¥äº† AOP å•Ÿå‹•å™¨å°±ä¸éœ€è¦é¡¯å¼é–‹å•Ÿ


ï¼Spring Web è¨»è§£

1. å®šç¾© Bean ç‰¹æ®Šç”Ÿå‘½é€±æœŸçš„è¤‡åˆè¨»è§£: @RequestScopeã€@SessionScopeã€@ApplicationScope

2. @XXXMappingï¼Œæˆ–ç›´æ¥ä½¿ç”¨ @RequestMapping ç„¶å¾Œæ‰‹å‹•è¨­å®š method

3. @ResponseStatus

4. Spring MVC çµ¦äº†æˆ‘å€‘å„ç¨®è¨»è§£æ–¹ä¾¿æˆ‘å€‘å¾ HTTP è«‹æ±‚å„ç¨®åœ°æ–¹ç²å–å¼•æ•¸: @RequestBodyã€@RequestHeaderã€@CookieValueã€@SessionAttributeã€@RequestAttributeã€@RequestParamã€@PathVariableã€@MatrixAttribute

5. @ControllerAdviceã€@RestControllerAdviceã€

6. å…¶ä»–: @CrossOrigin


ï¼Spring Boot è¨»è§£

1. ä¾†çœ‹ä¸€ä¸‹ä¸Šä¸‹æ–‡ç›¸é—œçš„è¨»è§£: @ConfigurationProperties

2. å†çœ‹çœ‹è‡ªå‹•é…ç½®ç›¸é—œçš„è¨»è§£ï¼Œ@EnableAutoConfigurationï¼Œ@SpringBootApplicationï¼›@AutoConfigureOrderã€@AutoConfigureAfterã€@AutoConfigureBefore

3. æœ€å¾Œä¾†çœ‹ä¸€ä¸‹åå¹¾ç¨®é…ç½®æ¢ä»¶


ï¼Spring Cloud è¨»è§£

1. é¦–å…ˆæ˜¯ Netflix åŒ…ä¸‹çš„ä¸€äº›è¨»è§£: @RibbonClient

2. client åŒ…ä¸‹çš„ @SpringCloudApplication

3. sleuth åŒ…ä¸‹çš„è¨»è§£å’Œéˆè·¯è·Ÿè¹¤ç›¸é—œï¼Œæ¯”è¼ƒå¸¸ç”¨çš„æ˜¯é€šé @SpanName æ‰‹å‹•è¨­å®š span çš„åç¨±ï¼Œå…¶å®ƒè¨»è§£å°æ–¼æ¥­å‹™é–‹ç™¼ä¸¦ä¸å¸¸ç”¨


@Indexed ä½¿ç”¨å ´æ™¯ï¼š
æœ‰å¤§é‡ä½¿ç”¨ @ComponentScan æƒæçš„ package åŒ…å«çš„é¡è¶Šå¤šçš„æ™‚å€™ï¼ŒSpring æ¨¡å¼è¨»è§£è§£æè€—æ™‚å°±è¶Šé•·ã€‚

<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context-indexer</artifactId>
        <version>5.1.12.RELEASE</version>
        <optional>true</optional>
    </dependency>
</dependencies>

å°ä½¿ç”¨æ¨¡å¼è¨»è§£çš„é¡åŠ ä¸Š @Indexedï¼š
@Indexed
@Controller
public class HelloController {
}

åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†@Indexedä¹‹åï¼Œç¼–è¯‘æ‰“åŒ…çš„æ—¶å€™ä¼šåœ¨é¡¹ç›®ä¸­è‡ªåŠ¨ç”Ÿæˆ META-INT/spring.components æ–‡ä»¶ã€‚
å½“ Spring åº”ç”¨ä¸Šä¸‹æ–‡æ‰§è¡Œ ComponentScan æ‰«ææ—¶ï¼ŒMETA-INT/spring.components å°†ä¼šè¢« CandidateComponentsIndexLoader è¯»å–å¹¶åŠ è½½ï¼Œè½¬æ¢ä¸º CandidateComponentsIndex å¯¹è±¡ï¼Œè¿™æ ·çš„è¯ @ComponentScan ä¸åœ¨æ‰«ææŒ‡å®šçš„ packageï¼Œè€Œæ˜¯è¯»å– CandidateComponentsIndex å¯¹è±¡ï¼Œä»è€Œè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„ã€‚

æ³¨æ„é»ï¼š
å‡è¨­ Spring æ‡‰ç”¨ä¸­å­˜åœ¨ä¸€ä¸ªåŒ…å« META-INT/spring.components è³‡æºçš„ a.jarï¼Œb.jar åƒ…å­˜åœ¨æ¨¡å¼è¨»è§£ï¼Œé‚£éº¼ä½¿ç”¨ @ComponentScan æƒæé€™å…©å€‹ JAR ä¸­çš„ package æ™‚ï¼Œb.jar ä¸­çš„æ¨¡å¼è¨»è§£ä¸æœƒè¢«è­˜åˆ¥ã€‚



åœ¨é¡åˆ¥åŠ ä¸Šç‰¹å®šçš„æ¨™è¨˜ï¼Œå°‡æœƒè¢«è¦–ç‚ºã€Œå…ƒä»¶ã€ï¼ˆbeanï¼‰
Spring Bootå•Ÿå‹•æ™‚ï¼Œæœƒæƒæç¨‹å¼å°ˆæ¡ˆä¸­æœ‰å“ªäº›é¡åˆ¥å…·æœ‰åƒé€™æ¨£çš„æ¨™è¨˜ã€‚æ‰¾åˆ°çš„è©±ï¼Œæœƒé»˜é»˜åœ°å»ºç«‹é€™äº›é¡åˆ¥çš„ç‰©ä»¶ã€‚
ä»¥ä¸‹åˆ—å‡ºå¸¸è¦‹çš„æ¨™è¨˜ï¼Œè¢«æ¨™è¨˜çš„é¡åˆ¥æˆ–æ–¹æ³•æœƒè¢«Spring Bootå»ºç«‹æˆå…ƒä»¶ã€‚
@RestControllerï¼šæ¨™è¨˜åœ¨ç”¨ä¾†æ¥æ”¶è«‹æ±‚èˆ‡å›å‚³è³‡æ–™(é€šå¸¸XMLã€JSONã€plain text)çš„è¡¨ç¤ºå±¤ã€‚æ–¼ç¬¬3èª²ä»‹ç´¹ã€‚
@Serviceï¼šæ¨™è¨˜åœ¨è² è²¬è³‡æ–™è™•ç†çš„æ¥­å‹™é‚è¼¯å±¤ã€‚æ–¼ç¬¬5èª²ä»‹ç´¹ã€‚
@Repositoryï¼šæ¨™è¨˜åœ¨èƒ½èˆ‡è³‡æ–™åº«äº’å‹•çš„è³‡æ–™æŒä¹…å±¤ã€‚æ–¼ç¬¬8èª²ä»‹ç´¹ã€‚
@Configurationï¼šæ¨™è¨˜åœ¨å°ˆé–€è®€å–æ‡‰ç”¨ç¨‹å¼è¨­å®šå€¼çš„é¡åˆ¥ã€‚æ–¼ç¬¬13èª²ä»‹ç´¹ã€‚
@Componentï¼šå¦‚æœä¸€å€‹é¡åˆ¥ä¸å¤ªå¥½æ­¸é¡åˆ°ä»¥ä¸Šé¡å‹ï¼Œå¯ä»¥ä½¿ç”¨é€™å€‹åç¨±æ¯”è¼ƒé€šä¿—çš„æ¨™è¨˜ï¼Œå®ƒçš„ä¸­æ–‡æ„æ€å°±æ˜¯ã€Œå…ƒä»¶ã€è€Œå·²ã€‚
@Beanï¼šæ¨™è¨˜åœ¨æ–¹æ³•ä¸Šï¼Œå…¶å›å‚³å€¼å°‡è¢«å»ºç«‹æˆå…ƒä»¶ã€‚è©²æ–¹æ³•é€šå¸¸è¢«å®£å‘Šåœ¨Configurationé¡åˆ¥ä¸­ã€‚å¥½è™•æ˜¯èƒ½è‡ªè¡Œé€²è¡Œå…ƒä»¶çš„å»ºæ§‹ã€‚æ–¼ç¬¬14èª²ä»‹ç´¹ã€‚
ä½¿ç”¨ã€Œ@Autowiredã€æ¨™è¨˜èƒ½å°‡å…ƒä»¶æ³¨å…¥åˆ°éœ€è¦çš„é¡åˆ¥ã€‚ä½†ä¸¦éæ¯å€‹é¡åˆ¥éƒ½èƒ½é€™éº¼åšï¼Œåªæœ‰å…ƒä»¶æ‰èƒ½æŠŠå¦ä¸€å€‹å…ƒä»¶æ³¨å…¥é€²ä¾†ã€‚
SpringBootFirstAppApplication.java
import org.springframework.boot.SpringApplication;
@SpringBootApplication			// å•Ÿå‹• Spring Boot çš„é¡åˆ¥
public class SpringBootFirstAppApplication {
	public static void main(String[] args) {
		SpringApplication.run(SpringBootFirstAppApplication.class,args);
	}
}
WelcomeController.java
import org.springframework.web.bind.annotation.RestController;
@RestController
public class WelcomeController {
	@GetMapping("/welcome")
	public String welcome() {
		return "welcome to spring boot app development";
	}
}
localhost:8080/welcome
@PreAuthorize("hasAuthority('ROLE_AUTH_DOWNLOAD')")

å¤šç·šç¨‹æœƒæœ‰åŒæ­¥ã€ç•°æ­¥å•é¡Œï¼ŒåŒæ­¥å¯ä»¥é¿å…ç·šç¨‹æ¶ä½”å®Œæˆäº¤æ˜“æ€§éœ€è¦çš„ACID

ç¨‹åº
é€²ç¨‹ã€ç·šç¨‹
ä½µç™¼ã€ä¸¦è¡Œ
åŒæ­¥ã€ç•°æ­¥

é«˜ä½µç™¼ç›¸é—œå¸¸ç”¨çš„ä¸€äº›æŒ‡æ¨™æœ‰éŸ¿æ‡‰æ™‚é–“ï¼ˆResponse Timeï¼‰ï¼Œååé‡ï¼ˆThroughputï¼‰ï¼Œæ¯ç§’æŸ¥è©¢ç‡QPSï¼ˆQuery Per Secondï¼‰ï¼Œä½µç™¼ç”¨æˆ¶æ•¸ç­‰ã€‚
å¤šç·šç¨‹åœ¨é€™è£åªæ˜¯åœ¨åŒ/ç•°æ­¥è§’åº¦ä¸Šè§£æ±ºé«˜ä½µç™¼å•é¡Œçš„å…¶ä¸­çš„ä¸€å€‹æ–¹æ³•æ‰‹æ®µï¼Œæ˜¯åœ¨åŒä¸€æ™‚åˆ»åˆ©ç”¨è¨ˆç®—æ©Ÿé–‘ç½®è³‡æºçš„ä¸€ç¨®æ–¹å¼

é€²ç¨‹ä¹‹é–“ä¸èƒ½å…±äº«å…§å­˜ï¼Œä½†ç·šç¨‹ä¹‹é–“å…±äº«å…§å­˜éå¸¸å®¹æ˜“ã€‚
ç³»çµ±å‰µå»ºé€²ç¨‹æ™‚éœ€è¦çµ¦é€²ç¨‹é‡æ–°åˆ†é…ç³»çµ±è³‡æºï¼Œä½†å‰µå»ºç·šç¨‹ä»£åƒ¹å°å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨å¤šç·šç¨‹å¯¦ç¾å¤šä»»å‹™ä½µç™¼æ¯”å¤šé€²ç¨‹æ•ˆç‡é«˜



SpringBoot é»˜èª

@SpringBootApplication è¨»è§£å†…éƒ¨æ˜¯ 3 å¤§è¨»è§£åŠŸèƒ½çš„é›†æˆ

@ComponentScan: é–‹å•Ÿçµ„ä»¶æƒæ
@SpringBootConfiguration: ä½œç”¨ç­‰åŒæ–¼ @Configuration è¨»è§£ï¼Œä¹Ÿæ˜¯ç”¨æ–¼æ¨™è¨˜é…ç½®é¡
@EnableAutoConfiguration: å…§éƒ¨å°å…¥ AutoConfigurationImportSelectorï¼Œè©²é¡ä¸­æœ‰å€‹ getCandidateConfigurations æ–¹æ³•ï¼Œè®€å– jar åŒ…ä¸­ META-INF/spring.factories æ–‡ä»¶ä¸­é…ç½®é¡ï¼Œå†æ ¹æ“šæ¢ä»¶é€²è¡ŒåŠ è¼‰å’Œé…ç½®ï¼Œæ¯”å¦‚: AOP / PropertyPlaceholder / FreeMarker / HttpMessageConverter / Jackson / DataSource / DataSourceTransactionManager / DispatcherServlet / WebMvc ç­‰ç­‰

SpringApplication.run(â€¦)çš„ä½œç”¨

å•Ÿå‹• SpringBoot æ‡‰ç”¨
åŠ è¼‰è‡ªå®šç¾©çš„çš„é…ç½®é¡ï¼Œå®Œæˆè‡ªå‹•é…ç½®åŠŸèƒ½
æŠŠç•¶å‰é …ç›®éƒ¨ç½²åˆ°åµŒå…¥çš„ Tomcat ä¼ºæœå™¨
å•Ÿå‹• Tomcat ä¼ºæœå™¨è·‘é …ç›®


@Aspect
@Autowired
@Bean
@Cacheable
@CacheEvict
@CachePut
@Component
@ComponentScan
@Configuration
@Controller
@ControllerEndpoint
@CookieValue
@EnableAutoConfiguration


@GetMappingã€@PostMappingã€@PutMappingã€@DeleteMappingã€@PatchMapping	// åªèƒ½åœ¨classå…§ï¼ŒAnnotation maps HTTP GET requests onto specific handler methods. It is a composed annotation that acts as a shortcut for 									// @RequestMapping(method = RequestMethod.GET).
å¯ä»¥å¯«åœ¨MyController.javaå…§ã€‚MyController provides mappings between request paths and handler methods.
The @GetMapping maps a / root path from a GET request to the index() method.

å¦‚æœæˆ‘å€‘æƒ³ä½¿ç”¨å‚³çµ±çš„@RequestMappingè¨»é‡‹å¯¦ç¾URLè™•ç†ç¨‹åºï¼Œé‚£éº¼å®ƒæ‡‰è©²æ˜¯é€™æ¨£çš„ï¼š
@RequestMapping(value="/get/{id}", method=RequestMethod.GET)
æ–°æ–¹æ³•å¯ä»¥ç°¡åŒ–ç‚ºï¼š
@GetMapping("/get/{id}")

æ‰€æœ‰ä¸Šè¿°è¨»é‡‹éƒ½å·²åœ¨å…§éƒ¨è¨»é‡‹äº†@RequestMappingä»¥åŠæ–¹æ³•å…ƒç´ ä¸­çš„ç›¸æ‡‰å€¼ã€‚

æºç¢¼ï¼š
@Target({ java.lang.annotation.ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@RequestMapping(method = { RequestMethod.GET })
public @interface GetMapping {
	// abstract codes
}

æ‰€æœ‰å…¶ä»–è¨»é‡‹éƒ½ä»¥ç›¸åŒæ–¹å¼å‰µå»ºï¼Œå³@PostMappingä½¿ç”¨RequestMethod.POSTé€²è¡Œè¨»é‡‹ç­‰ã€‚

ä½¿ç”¨æ–¹å¼
ä¸‹é¢æ˜¯çµåˆRestControllerçš„ç°¡å–®ä½¿ç”¨ï¼š
@RestController
@RequestMapping("users")
public class UserController {
	@Autowired
	UserService userService;

	@GetMapping("/status/check")
	public String status() {
		return "working";
	}

	@GetMapping("/{id}")
	public String getUser(@PathVariable String id) {
		return "HTTP Get was called";
	}

	@PostMapping
	public String createUser(@RequestBody UserDetailsRequestModel requestUserDetails) {
		return "HTTP POST was called";
	}

	@DeleteMapping("/{userId}")
	public String deleteUser(@PathVariable String userId) {
		return "HTTP DELETE was called";
	}

	@PutMapping("/{userId}")
	public String updateUser(@PathVariable String userId, @RequestBody UserDetailsRequestModel requestUserDetails) {
		return "HTTP PUT was called";
	}
}
ä¸‹é¢æ˜¯ä½¿ç”¨@Controllerçš„ä»£ç¢¼ï¼š
@Controller
public class HomeController {
	@GetMapping("/")
	public String homeInit(Model model) {
		return "home";
	}
}
åœ¨ä¸Šé¢çš„ä»£ç¢¼ä¸­ï¼ŒHomeControlleré¡å……ç•¶è«‹æ±‚æ§åˆ¶å™¨ã€‚å®ƒçš„homeInit()å°‡è™•ç†æ‰€æœ‰å‚³å…¥çš„URLè«‹æ±‚"/"ã€‚å®ƒæ¥å—a Model ä¸¦è¿”å›è¦–åœ–åç¨±homeã€‚ä½¿ç”¨é…ç½®çš„ã€Œè¦–åœ–è§£æå™¨ã€è§£æè¦–åœ–åç¨±"home"çš„é é¢ã€‚

å¯«æ³•å°æ¯”
@RequestMappingï¼š
@RequestMapping(value = "/workflow",
		produces = {"application/json"},
		consumes = {"application/json"},
		method = RequestMethod.POST)

@PostMappingï¼š
@PostMapping(path = "/members", consumes = "application/json", produces = "application/json")
public void addMember(@RequestBody Member member) {
	// code
}



@Lazy
@Qualifier
@Repository


@RequestMapping		// ç”¨æ–¼æ˜ å°„urlåˆ°æ§åˆ¶å™¨é¡æˆ–ä¸€å€‹ç‰¹å®šçš„è™•ç†ç¨‹åºæ–¹æ³•ï¼Œè€Œé€™å€‹å‹•ä½œç›¸ç­‰æ–¼ Servletä¸­åœ¨web.xmlçš„é…ç½®ã€‚å±¬æ–¼Spring MVCä»¥å‰ç‰ˆæœ¬ï¼Œåˆ°äº†æ–°ç‰ˆè¢«@GetMappingã€@PostMappingã€@PutMappingã€					// @DeleteMappingã€@PatchMappingæ–°è¨»é‡‹æ›¿ä»£ã€‚
æºç¢¼ï¼š
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Mapping
public @interface RequestMapping {
	String name() default "";
	@AliasFor("path")
	String[] value() default {};
	@AliasFor("value")
	String[] path() defalut {};
	RequestMethod[] method() default {};
	String[] params() default {};
	String[] headers() default {};
	String[] consumes() default {};
	String[] produces() default {};
æŒ‡å®šhttpè«‹æ±‚çš„é¡å‹ä½¿ç”¨
public enum RequestMethod {
	GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE
}
ç¯„ä¾‹ï¼š
	@RequestMapping("/")
	public String hello() {
		return "Hey, Spring Boot çš„ Hello World !";
	}


@Required

@ResponseBody		// å‘Šè¨´Spring MVCä¸æ˜¯æ¸²æŸ“æ¨¡å‹åˆ°è¦–åœ–ï¼Œè€Œæ˜¯è¿”å›çš„å°è±¡å¯«å…¥éŸ¿æ‡‰ä¸»é«”ã€‚å®ƒæ˜¯é€šéä½¿ç”¨Springçš„æ¶ˆæ¯è½‰æ›å™¨ä¹‹ä¸€ä¾†å¯¦ç¾çš„ã€‚å› ç‚ºJackson 2åœ¨é¡è·¯å¾‘ä¸­ï¼ŒMappingJackson2HttpMessageConverteræ‰€ä»¥Greetingå¦‚			// æœè«‹æ±‚çš„Acceptæ¨™é ­æŒ‡å®šæ‡‰è¿”å›JSON ï¼Œå®ƒå°‡è™•ç†å°åƒåˆ°JSONçš„è½‰æ›ã€‚

@RestController		// è¡¨ç¤ºç•¶ä¸‹çš„javaæ˜¯ä¸€å€‹æ§åˆ¶å™¨(Controller)ã€‚@RestController is used for creating restful controllers, which do not use a view technology. The methods typically return XML, JSON, or plain text.

@RestControllerEndpoint
@Service


@SpringBootApplication	// Spring Bootæ‡‰ç”¨æ¨™è¨»åœ¨æŸå€‹é¡ä¸Šèªªæ˜é€™å€‹é¡æ˜¯SpringBootçš„ä¸»è¨­å®šé¡ï¼ŒSpringBoot å°±æ‡‰è©²åŸ·è¡Œé€™å€‹é¡çš„mainæ–¹æ³•ä¾†å•Ÿå‹•SpringBootæ‡‰ç”¨ã€‚
ç›¸é—œè¨­å®šå•Ÿå‹•éƒ½æ˜¯ç”±è©²è¨»è§£ä¾†å¹«æˆ‘å€‘å®Œæˆçš„ï¼Œé»é€²å»äº†è§£ä¸€ä¸‹
æºç¢¼ï¼š
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = {
		@Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)})
public @interface SpringBootApplication {
}
é»é€²å»æœƒç™¼ç¾ä»–çš„è¨»è§£é¡ç•¶ä¸­é‚„æœ‰å¾ˆå¤šè¨»è§£ï¼Œå°±æ˜¯ä¸€å€‹è‡ªå®šç¾©çµ„åˆè¨»è§£ã€‚
ä¸ä½¿ç”¨é€™å€‹è¨»è§£èƒ½å¦å•Ÿå‹•å°ˆæ¡ˆï¼Ÿ
æŠŠ@SpringBootApplicationæ›æˆä»¥ä¸‹ä¸‰å€‹è¨»è§£ï¼Œç…§æ¨£å¯ä»¥æ­£å¸¸å•Ÿå‹•ã€‚
@Configuration
@EnableAutoConfiguration
@ComponentScan




@Value
1.The @Value annotation works directly on fieldsâ€¦â€‹

2.Or on constructor arguments.

go through your (hierarchical) environment and look for the appropriate property - or throw an error message if such a property does not exist.
environment
property






ç”¨åœ¨å…¶ä»–Annotationä¸Šçš„Annotationï¼š

@Retention		// ç¢ºå®šæ¨™è¨»çš„ç”Ÿå‘½é€±æœŸï¼Œç”¨Enumçš„RetentionPolicyè¨­å®šã€‚
è¨»è§£æŒ‰ç”Ÿå‘½é€±æœŸä¾†åŠƒåˆ†å¯åˆ†ç‚º3é¡ï¼š
RetentionPolicy.SOURCE: è¨»è§£åªä¿ç•™åœ¨åŸå§‹æª”ï¼Œç•¶Javaæª”æ¡ˆç·¨è­¯æˆclassæª”æ¡ˆçš„æ™‚å€™ï¼Œè¨»è§£è¢«éºæ£„
RetentionPolicy.CLASS: è¨»è§£è¢«ä¿ç•™åˆ°classæª”æ¡ˆï¼Œä½†jvmè¼‰å…¥classæª”æ¡ˆæ™‚å€™è¢«éºæ£„ï¼Œé€™æ˜¯é è¨­çš„ç”Ÿå‘½é€±æœŸ
RetentionPolicy.RUNTIME: è¨»è§£ä¸åƒ…è¢«å„²å­˜åˆ°classæª”æ¡ˆä¸­ï¼Œjvmè¼‰å…¥classæª”æ¡ˆä¹‹å¾Œï¼Œä»ç„¶å­˜åœ¨

@Documented		// é€™å€‹è¨»è§£åªæ˜¯ç”¨ä¾†æ¨™è¨»ç”Ÿæˆjavadocçš„æ™‚å€™æ˜¯å¦æœƒè¢«è¨˜éŒ„ã€‚
åœ¨è‡ªå®šç¾©è¨»è§£çš„æ™‚å€™å¯ä»¥ä½¿ç”¨@Documentedä¾†é€²è¡Œæ¨™è¨»ï¼Œå¦‚æœä½¿ç”¨@Documentedæ¨™è¨»äº†ï¼Œåœ¨ç”Ÿæˆjavadocçš„æ™‚å€™å°±æœƒæŠŠ@Documentedè¨»è§£çµ¦é¡¯ç¤ºå‡ºä¾†


@Target			// èªªæ˜äº†Annotationï¼ˆè¨»è§£ï¼‰æ‰€ä¿®é£¾çš„ç‰©ä»¶ç¯„åœã€‚ç”¨Enumçš„ElementTypeè¨­å®šã€‚
æœ‰ï¼š
CONSTRUCTOR
FIELD
LOCAL_VARIABLE
METHOD
PACKAGE
PARAMETER
TYPE

@Inherited		// @Inheritedæ˜¯ä¸€å€‹æ¨™è­˜ï¼Œç”¨ä¾†ä¿®é£¾è¨»è§£ï¼Œè‡ªå®šç¾©è¨»è§£ç•¶ä¸­æœƒç”¨åˆ°ã€‚
é¦–å…ˆæ˜¯è‡ªå®šç¾©ä¸€å€‹è¨»è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Inherited
public @interface ATable {
	public String name() default "";
}
ä»¥ä¸‹æ˜¯åœ¨ä½¿ç”¨è‡ªå®šç¾©è¨»è§£çš„ä¸€å€‹å ´æ™¯
é¡ç¹¼æ‰¿é—œä¿‚ä¸­@Inheritedçš„ä½œç”¨
é¡ç¹¼æ‰¿é—œä¿‚ä¸­ï¼Œå­é¡æœƒç¹¼æ‰¿çˆ¶é¡åˆ¥ä½¿ç”¨çš„è¨»è§£ä¸­è¢«@Inheritedä¿®é£¾çš„è¨»è§£
@ATable
public class InheritedBase {
}
public class MyInheritedClass extends InheritedBase {
}

ä»‹é¢ç¹¼æ‰¿é—œä¿‚ä¸­@Inheritedçš„ä½œç”¨
ä»‹é¢ç¹¼æ‰¿é—œä¿‚ä¸­ï¼Œå­ä»‹é¢ä¸æœƒç¹¼æ‰¿çˆ¶ä»‹é¢ä¸­çš„ä»»ä½•è¨»è§£ï¼Œä¸ç®¡çˆ¶ä»‹é¢ä¸­ä½¿ç”¨çš„è¨»è§£æœ‰æ²’æœ‰è¢«@Inheritedä¿®é£¾
@ATable
public interface IInheritedInterface {
}
public interface IInheritedInterfaceChild extends IInheritedInterface {
}

é¡å¯¦ç¾ä»‹é¢é—œä¿‚ä¸­@Inheritedçš„ä½œç”¨
é¡å¯¦ç¾ä»‹é¢æ™‚ä¸æœƒç¹¼æ‰¿ä»»ä½•ä»‹é¢ä¸­å®šç¾©çš„è¨»è§£
@ATable
public interface IInheritedInterface {
}
public class MyInheritedClassUseInterface implements IInheritedInterface {
}

@SpringBootConfiguration				// æ¨™è¨»åœ¨æŸå€‹é¡ä¸Šï¼Œè¡¨ç¤ºé€™æ˜¯ä¸€å€‹Spring Bootçš„è¨­å®šé¡ã€‚é»é€²å»æœƒç™¼ç¾ï¼Œä»–å…¶å¯¦ä¹Ÿæ˜¯ä¸€å€‹è‡ªå®šç¾©è¨»è§£ã€‚
@Configurationå­¸springçš„æ‡‰è©²å°ä»–ä¸é™Œç”Ÿ
ä½œç”¨ï¼šæŒ‡å®šç•¶å‰é¡æ˜¯ä¸€å€‹è¨­å®šé¡ï¼Œåœ¨ä½¿ç”¨springçš„æ™‚å€™å‰›é–‹å§‹éƒ½æ˜¯xmlè¨­å®šï¼Œä¹Ÿæ­£æ˜¯é€™å€‹è¨»è§£ï¼Œé–‹å•Ÿäº†é¡è¨­å®šæ–¹å¼ã€‚
æºç¢¼ï¼š
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Configuration
public @interface SpringBootConfiguration {
}


@EnableAutoConfiguration				// ä»¥å‰æˆ‘å€‘éœ€è¦è¨­å®šçš„æ±è¥¿ï¼ŒSpring Bootæœƒå¹«æˆ‘å€‘è‡ªå‹•è¨­å®šï¼›@EnableAutoConfigurationå‘Šè¨´SpringBooté–‹å•Ÿè‡ªå‹•è¨­å®šåŠŸèƒ½ï¼Œé€™æ¨£è‡ªå‹•è¨­å®šæ‰èƒ½ç”Ÿæ•ˆã€‚
é»é€²å»æœƒç™¼ç¾@Importï¼Œèªªç™½äº†ä»–å°±æ˜¯è—‰åŠ©@Importçš„æ”¯æ´ï¼Œæ”¶é›†å’Œè¨»å†Šç‰¹å®šå ´æ™¯ç›¸é—œçš„beanå®šç¾©ã€‚
@SuppressWarnings("deprecation")
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import(EnableAutoConfigurationImportSelector.class)	// EnableAutoConfigurationImportSelectorï¼šåŒ¯å…¥å“ªäº›å…ƒä»¶çš„é¸æ“‡å™¨ã€‚
public @interface EnableAutoConfiguration {
}
æœƒçµ¦å®¹å™¨ä¸­åŒ¯å…¥éå¸¸å¤šçš„è‡ªå‹•è¨­å®šé¡ï¼ˆxxxAutoConfigurationï¼‰ã€‚
å¤§æ¦‚çš„æµç¨‹å°±æ˜¯ï¼š
Spring Bootåœ¨å•Ÿå‹•çš„æ™‚å€™ï¼Œé€šéEnableAutoConfigurationImportSelectoré¡ï¼Œå¾é¡è·¯å¾‘ä¸‹çš„META-INF/spring.factoriesä¸­ç²å–EnableAutoConfigurationæŒ‡å®šçš„å€¼ï¼ˆå°±æ˜¯ä¸Šæ–¹æˆªåœ–ï¼‰ï¼Œ
ä»¥å…¨é¡ååå°„çš„å»ºç«‹æ–¹å¼ï¼Œå°‡é€™äº›å€¼ä½œç‚ºè‡ªå‹•è¨­å®šé¡åŒ¯å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªå‹•è¨­å®šé¡å°±ç”Ÿæ•ˆï¼Œå¹«æˆ‘å€‘é€²è¡Œè‡ªå‹•è¨­å®šå·¥ä½œã€‚

ä»¥å‰æˆ‘å€‘éœ€è¦è‡ªå·±è¨­å®šçš„æ±è¥¿ï¼Œè‡ªå‹•è¨­å®šé¡éƒ½å¹«æˆ‘å€‘è¨­å®šå¥½äº†ï¼Œé€™ä¹Ÿå°±æ˜¯ä½¿ç”¨springbootåœ¨ä½¿ç”¨springï¼Œspringmvcä¸ç”¨è¨­å®šã€Œæª¢è¦–è§£æå™¨ã€ã€ã€Œè³‡æ–™åº«é€£ç·šæ± ã€ã€ã€Œäº‹å‹™ã€ç­‰è¨­å®šçš„åŸå› ã€‚ç›´æ¥é–‹ç®±å³ç”¨ã€‚
ç•¶ç„¶springbootä¹Ÿçµ¦æˆ‘æä¾›äº†ä¿®æ”¹è¨­å®šçš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯é€šéymlæˆ–è€…propertieæª”æ¡ˆä¾†é€²è¡Œä¿®æ”¹springbootç‚ºæˆ‘å€‘è¨­å®šå¥½çš„è¨­å®šé è¨­å€¼ã€‚


@ComponentScan		// ç”¨æ–¼é€šéè¨»è§£æŒ‡å®šspringåœ¨å»ºç«‹å®¹å™¨æ™‚è¦æƒæçš„åŒ…ã€‚
æˆ‘å€‘å¯ä»¥é€šébasePackagesç­‰å±¬æ€§ä¾†ç´°ç²’åº¦çš„å®¢è£½åŒ–@ComponentScanè‡ªå‹•æƒæçš„ç¯„åœï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå‰‡é è¨­Springæ¡†æ¶å¯¦ç¾æœƒå¾å®£å‘Š@ComponentScanæ‰€åœ¨é¡çš„packageé€²è¡Œæƒæã€‚
@ComponentScan("com.gzl")
é€™ä¹Ÿå°±æ˜¯springbootå•Ÿå‹•é¡ç‚ºä»€éº¼æ”¾åœ¨åŒ…å¤–çš„åŸå› ã€‚

@Import			// ç”¨æ–¼åŒ¯å…¥å…¶ä»–çš„è¨­å®šé¡ã€‚è€Œ@EnableAutoConfigurationä¹Ÿæ˜¯è—‰åŠ©@Importçš„å¹«åŠ©ï¼Œå°‡æ‰€æœ‰ç¬¦åˆè‡ªå‹•è¨­å®šæ¢ä»¶çš„beanå®šç¾©è¼‰å…¥åˆ°IoCå®¹å™¨ï¼Œåƒ…æ­¤è€Œå·²ï¼
@SessionScope



@Inject
	é‡å°è³‡æ–™çš„æ¨™è¨»ï¼Œ@JsonPropertyæ”¹è®ŠJSONåç¨±
public class Name {
	@JsonProperty("firstName")
	public String _first_name;
}
	è‡ªè¨‚æ¨™è¨»å‰‡éœ€è¦ç”¨åˆ°@interface
public @interface Test {

}


___________________________________________________________________________________________________________________________________________________________________________________________________________________


è³‡æ–™åº«å¢åŠ æ–°ç”¨æˆ¶
grant select,insert,update,delete on *.* to user1@localhost Identified by "password1"

import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;

public class SpringMailSender {
	@Autowired
	private JavaMailSender mailSender;

	public void sendInvoice(User user, File pdf) throws Exception {
		MimeMessage mimeMessage = mailSender.createMimeMessage();

		MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true);

		helper.setTo("john@rambo.com");
		helper.setText("Check out your new invoice!");
		FileSystemResource file = new FIleSystemResource(pdf);
		helper.addAttachment("invoice.pdf", file);

		mailSender.send(mimeMessage);
	}
}
XMLã€Java Configã€Annotations(component-scanning)ä¸è¦åœ¨åŒå€‹å°ˆæ¡ˆæ··å’Œç”¨ï¼Œä»¥æ¨™è¨»ç‚ºä¸»æµã€‚

create*()ã€getInstance()ä½¿å¾—ä¸éœ€è¦importå°±èƒ½ç”Ÿæˆä¸€å€‹é¡ï¼Œé‚„å¯ä»¥åœ¨æ–¹æ³•å…§æ·»åŠ é¡å¤–æ±è¥¿è€Œå‘¼å«è€…çœ‹ä¸åˆ°ï¼ŒåŸæœ¬çš„ç”¨æ„æ˜¯ä¸è®“åˆ¥äººä»¥newå‘¼å«å»ºæ§‹å¼(private)ä¸”èª¿ç”¨å¤šæ¬¡è¿”å›åŒä¸€å€‹å°è±¡ã€‚ç®—æ˜¯ä¾è³´æ³¨å…¥ã€‚

ä½¿ç”¨cloneï¼ˆï¼‰cloneï¼ˆï¼‰å¯ç”¨æ–¼å‰µå»ºç¾æœ‰å°è±¡çš„å‰¯æœ¬ã€‚
1.MyObject object = new MyObjectï¼ˆï¼‰;
2.MyObject anotherObject = new MyObjectï¼ˆï¼‰; MyObjectå°è±¡= anotherObject.cloneï¼ˆï¼‰;
3.MyObject object =ï¼ˆMyObjectï¼‰ Class.forNameï¼ˆã€Œsubin.rnd.MyObjectã€ï¼‰ã€‚newInstanceï¼ˆï¼‰;
4.ObjectInputStream inStream = new ObjectInputStreamï¼ˆanInputStreamï¼‰; MyObject object =ï¼ˆMyObjectï¼‰inStream.readObjectï¼ˆï¼‰;
___________________________________________________________________________________________________________________________________________________________________________________________________________________ï¼ˆ@RestController == @ResponseBody + @Controllerï¼‰
1.å¦‚æœåªæ˜¯ä½¿ç”¨ @RestController è¨»è§£ Controllerï¼ŒController ä¸­çš„æ–¹æ³•ç„¡æ³•è¿”å› jspã€htmlï¼Œé…ç½®çš„è¦–åœ–è§£æå™¨ InternalResourceViewResolver ä¸èµ·ä½œç”¨ï¼Œè¿”å›çš„å…§å®¹å°±æ˜¯ return è£¡çš„å…§å®¹ã€‚
2.å¦‚æœéœ€è¦è¿”å›æŒ‡å®šé é¢ï¼Œéœ€è¦ä½¿ç”¨@Controlleré…åˆè¦–åœ–è§£æå™¨InternalResourceViewResolverã€‚
	å¦‚æœéœ€è¦è¿”å›JSONã€XMLã€æˆ–è‡ªå®šç¾©mediaTypeå…§å®¹åˆ°é é¢ï¼Œå‰‡éœ€è¦åœ¨å°æ‡‰çš„æ–¹æ³•ä¸ŠåŠ ä¸Š@ResponseBodyã€‚
1. ä½¿ç”¨ @Controllerï¼Œåœ¨å°æ‡‰çš„æ–¹æ³•ä¸Šï¼Œè¦–åœ–è§£æå™¨å¯ä»¥è§£æ return çš„ jspã€htmlï¼Œä¸¦ä¸”è·³è½‰åˆ°ç›¸æ‡‰é é¢ã€‚
è‹¥è¿”å› json ç­‰å…§å®¹åˆ°é é¢ï¼Œå‰‡éœ€è¦åŠ  @ResponseBodyã€‚

@CrossOrigin
@Controller
public class FileUploadController {
	// è·³è½‰åˆ°ä¸Šå‚³æ–‡ä»¶çš„é é¢
	@RequestMapping(value="/gouploading", method = RequestMethod.GET)
	public String goUploading() {
		//è·³è½‰åˆ°templatesç›®éŒ„ä¸‹çš„uploading.html
		return "uploading";
	}
	// è™•ç†æ–‡ä»¶ä¸Šå‚³
	@RequestMapping(value = "/testuploading", method = RequestMethod.POST)
	public @ResponseBody String uploading(@RequestParam("file") MultipartFile file, HttpServletRequest request) {
		System.out.println("èª¿ç”¨æ–‡ä»¶ä¸Šå‚³æ–¹æ³•");
		String contentType = file.getContentType();
		String fileName = file.getOriginalFilename();
	}
}
2. @RestControllerï¼Œè¿”å› json æ•¸æ“šä¸éœ€è¦åœ¨æ–¹æ³•å‰é¢åŠ  @ResponseBodyï¼Œä½†ä½¿ç”¨ @RestController å°±ä¸èƒ½è¿”å› jspã€html é é¢ï¼Œè¦–åœ–è§£æå™¨ç„¡æ³•è§£æ jspã€html é é¢ã€‚

@CrossOrigin
@RestController	// @Controller + @ResponseBody
public class HospitalController {
	@Autowired
	private HospitalService hospitalService;
	/**
	 *  æŸ¥è©¢æ‰€æœ‰é†«é™¢ä¿¡æ¯(æœªåˆ†é )
	 */

	@RequestMapping(value = "findAllHospital", method = RequestMethod.GET)
	public List<Hospital> findAllHospital() {
		List<Hospital> hospitalList = hospitalService.findAllHospital();
		return hospitalList;
	}
}
___________________________________________________________________________________________________________________________________________________________________________________________________________________
public class MyControllerTest {
	private MockMvc mockMvc

	@Before
	public void setup() {
		this.mockMvc = MockMvcBuilders.standaloneSetup(new MyController()).build();
	}

	@Test
	puublic void testHomePage() throws Exception {
		this.mockMvc.perform(get("/")).andExpect(status().isOk())
					.andExpect(content().string("This is Home Page"));
	}

	@Test
	public void testHelloPage() throws Exception {
		this.mockMvc.perform(get("/hello")).andExpect(status().isOk())
					.andExpect(content().string("Hello there!"));
	}
}
MyControllerTest tests the two pages.
$ curl localhost:8080
This is Home Page
$ curl localhost:8080/hello
Hello there!

___________________________________________________________________________________________________________________________________________________________________________________________________________________
é—œæ–¼ spring bean ä½œç”¨åŸŸï¼ŒåŸºæ–¼ä¸åŒçš„å®¹å™¨ï¼Œæœƒæœ‰æ‰€ä¸åŒï¼Œå¦‚ BeanFactory å’Œ ApplicationContext å®¹å™¨å°±æœ‰æ‰€ä¸åŒï¼Œé€™é‚Šä¸»è¦ä»‹ç´¹ ApplicationContext å®¹å™¨çš„ bean ä½œç”¨åŸŸã€‚
åœ¨springä¸­ä¸»è¦åŒ…æ‹¬singletonã€prototypeã€sessionã€requestã€globalé€™é‚Šä¸»è¦è¬›è§£å¸¸ç”¨çš„å…©ç¨®ï¼ŒSingletonã€Prototypeã€‚
public class UserDao {
	public UserDao() {
		System.out.println("UserDaoç„¡åƒæ§‹é€ å‡½æ•¸è¢«èª¿ç”¨");
	}
	public String getUserName() {
		return "RsosoR"
	}
}

applicationContext.xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean class="com.demo.dao.UserDao" id="userDao" scope="singleton"/>
</beans>

textï¼š
public class MyTest {
	@Test
	public void test() {
		ApplicationContext applicationContext = new ClassPathXmlApplicationContext("applicationContext.xml");		// åŠ è¼‰beanï¼ŒSingletonæ¨¡å¼å¯¦ä¾‹åŒ–bean

		UserDao userDao = applicationContext.getBean(UserDao.class);						//	     Prototypeæ¨¡å¼å¯¦ä¾‹åŒ–bean
		System.out.println(userDao.getUserName());

		UserDao userDao2 = (UserDao) applicationContext.getBean("userDao");
		System.out.println(userDao2.getUserName());
		System.out.println("ç¬¬ä¸€å€‹å¯¦ä¾‹: "+userDao+"\n"+"ç¬¬äºŒå€‹å¯¦ä¾‹: "+userDao2);
	}
}
Singletonæ¨¡å¼çš„beanï¼Œåœ¨ApplicationContextåŠ è¼‰beanæ™‚ï¼Œå°±å¯¦ä¾‹åŒ–äº†bean			// å³å–®ä¾‹æ¨¡å¼ï¼Œåœ¨å®¹å™¨ä¸­ï¼Œåªå¯¦ä¾‹åŒ–ä¸€æ¬¡(åšä¸€æ¬¡æ§‹é€ å‡½æ•¸)ã€‚
Prototypeæ¨¡å¼çš„beanï¼Œè¦å®ŒæˆgetBean()æ‰æœƒå¯¦ä¾‹åŒ–bean					// å³åŸå‹æ¨¡å¼ï¼Œåœ¨å®¹å™¨ä¸­ï¼Œèª¿ç”¨å¤šå°‘æ¬¡beanï¼Œå°±å¯¦ä¾‹åŒ–å¤šå°‘æ¬¡ã€‚
singletonæ¯”prototypeæ¶ˆè€—æ€§èƒ½ï¼Œwebé–‹ç™¼æ¨è–¦ä½¿ç”¨singletonï¼›appé–‹ç™¼æ¨è–¦ä½¿ç”¨prototypeã€‚
___________________________________________________________________________________________________________________________________________________________________________________________________________________
å†æ–°å»º class æ–‡ä»¶ UserControllerï¼Œå¯«å…¥ getUserList()ï¼Œé»æ“Šé‹è¡Œï¼Œä¸¦åœ¨ç€è¦½å™¨ä¸­è¼¸å…¥ URL:http://localhost:8080/getuserlist æ¸¬è©¦ä¸€ä¸‹ã€‚
@RestController
public class UserController {
	@RequestMapping("/getuserlist")
	public String getUserList() {
		return "ç²å–æˆåŠŸ";
	}
}
å†æ–°å»º ApiResult è¿”å›é€šç”¨çš„çµæœã€‚codeç‚ºéŒ¯èª¤ç¢¼ã€statusç‚ºç‹€æ…‹ç¢¼ã€dataç‚ºéœ€è¦è¿”å›çš„è¨Šæ¯ï¼Œæ‰€ä»¥é¡å‹ç‚ºObjectã€messageç‚ºç›¸é—œä¿¡æ¯ã€‚
public class ApiResult {
	private int code;
	private String status;
	private Object data;
	private String message;
	public void setCode(int code) {
		this.code = code;
	}
	public int getCode() {
		return code;
	}

	public void setStatus(String status) {
		this.status = status;
	}
	public String getStatus() {
		return status;
	}

	public void setData(Object data) {
		this.data = data;
	}
	public Object getData() {
		return data;
	}

	public void setMessage(String message) {
		this.message = message;
	}
	public String getMessage() {
		return message;
	}
}
æœ€å¾Œå›åˆ° UserControllerï¼Œä¿®æ”¹ getUserList()ã€‚
@RestController
public class UserController {
	@RequestMapping("/getuserlist")
	public ApiResult getUserList() {
		// è¿”å›çµæœ
		ApiResult apiResult = new ApiResult();
		apiResult.setCode(300);
		apiResult.setStatus("Success");
		apiResult.setData("123456");

		return apiResult;
	}
}
ä½†æˆ‘å€‘æƒ³è¦çš„æ˜¯SQLæ•¸æ“šåº«ä¸­å­˜å„²çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ã€‚
æ‰€ä»¥å°±åˆ° SQL çš„è™•ç†äº†
å…ˆåœ¨ resources æ–‡ä»¶å¤¾ä¸‹çš„ application.properties ä¸­é…ç½® SQL çš„ä¿¡æ¯ã€‚
XXX ç‚º SQL çš„åœ°å€ï¼Œæœ¬åœ°å‰‡ç‚º localhostï¼Œé˜¿é‡Œé›²å‰‡ç‚ºå¤–ç¶² ipã€‚demoapp ç‚ºæ•¸æ“šåº«åï¼Œyyy ç‚ºæ•¸æ“šåº«çš„å¯†ç¢¼ã€‚
serverTimezone=UTC ç”¨æ–¼è¨­å®šæ™‚å€ï¼Œå¦‚æœåˆªé™¤å¯èƒ½æœƒå‡ºç¾You must configure either the server or JDBC driver to use a more specific time zone value if you want to utilize time zone supportçš„å ±éŒ¯ã€‚
# é…ç½®sql
# ?serverTimezone=UTC ç‚ºè¨­å®šæ™‚å€
spring.datasource.url=jdbc:mysql://XXX:3306/demoapp?serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=yyy
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
ç„¶å¾Œå†æ·»åŠ æ•¸æ“šæºï¼Œåœ¨å³å´çš„Databaseä¸­é»æ“Š+è™ŸData Sourceâ†’MySQLï¼Œå¡«ä¸Šæ•¸æ“šåº«çš„ä¿¡æ¯ã€‚Test Connectionå‡ºç¾Successfulå°±OKäº†(å¦‚æœTest Connectionç‚ºç°è‰²ä¸å¯é»æ“Šï¼Œé»æ“Šä¸‹æ–¹çš„æç¤ºï¼Œä¸‹è¼‰driverå³å¯)ï¼Œä¹‹å¾Œå°±å¯ä»¥IDEAçš„Databaseä¸­æ”¯æŒæŸ¥çœ‹æ­¤æ•¸æ“šåº«ã€‚

å°æ•¸æ“šåº«çš„æ“ä½œæœ‰JDBCå’ŒJPAå…©ç¨®æ–¹æ³•ï¼Œå…¶ä¸­JPAç‚ºSpringBootæ¨è–¦çš„ä½¿ç”¨æ–¹æ³•ï¼Œé€™è£¡å…ˆä½¿ç”¨JPAã€‚
é¦–å…ˆæ·»åŠ JPAçš„ä¾è³´
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-data-jpa<artifactId>
</dependency>
ç„¶å¾Œä¿®æ”¹application.propertiesï¼Œæ–°å¢JPAçš„é…ç½®ã€‚æ³¨æ„: å¦‚æœè¡¨æ ¼æœ‰æ•¸æ“šï¼Œä¸è¦ä½¿ç”¨createæ¨¡å¼ï¼ŒåŒåè¡¨æ ¼æœƒè¢«è¦†è“‹ã€‚
# åœ¨å»ºè¡¨çš„æ™‚å€™ï¼Œå°‡é»˜èªçš„å­˜å„²å¼•æ“åˆ‡æ›ç‚ºInnoDB
spring.jpa.database-platform=org.hibernate.dialect.MySQLInnoDBDialect
# ç¨‹åºå•Ÿå‹•æ™‚åˆªé™¤ä¸¦ä¸”å‰µå»ºå¯¦é«”é¡å°æ‡‰çš„è¡¨(æ³¨æ„: é…ç½®äº†é€™å€‹ä¹‹å¾Œï¼Œå¦‚æœæœ‰åŒåçš„è¡¨ï¼Œæœƒè¢«åˆªé™¤è¦†è“‹ï¼Œæ…ç”¨)
# spring.jpa.hibernate.ddl-auto=create

ä¹‹å¾Œæ–°å»ºå…©å€‹classæ–‡ä»¶ï¼Œå¯¦é«”å°è±¡UserDAO.javaå’Œæ•¸æ“šåº«è¨ªå•å±¤UserRepository.java(å¦‚æœä¸Šé¢æ²’æœ‰ä½¿ç”¨createæ¨¡å¼ï¼Œè¦åˆ°MySQL Workbenchä¸­æ–°å»ºuser_infoè¡¨æ ¼
UserDAO: å¯¦é«”é¡éœ€è¦ä½¿ç”¨@Entityè¨»è§£æ¨™è¨»ã€‚ä¸¦ä¸”å¯¦é«”é¡çš„å±¬æ€§ä¹Ÿè¦é€²è¡Œæ¨™è¨»ï¼Œä½¿ç”¨@Idæ¨™è¨»ä¸»éµï¼Œä½¿ç”¨@Columnæ¨™è¨»éä¸»éµï¼š
import javax.persistence.*;

/**
 *  USERè¡¨æ ¼
 */

@Entity
@Table(name="user_info")	// æŒ‡å®šè¡¨å
public class UserDao {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Integer userId;

	@Column(name = "user_name")
	private String userName;

	@Column(name = "user_password")
	private String userPassword;

	@Column(name = "user_mailbox")
	private String userMailbox;

	@Column(name = "user_phone")
	private String userPhone;

	@Column(name = "user_token")
	private String userToken;

	@Column(name = "user_repository_time")
	private String userRepositoryTime;

	@Column(name = "user_login_last_time")
	private String userLoginLastTime;

	public void setUserId(Integer userId) {
		this.userId = userId;
	}
	public Integer getUserId() {
		return userId;
	}

	public void setUserName(String userName) {
		this.userName = userName;
	}
	public String getUserName() {
		return userName;
	}

	public void setUserPassword(String userPassword) {
		this.userPassword = userPassword;
	}
	public String getUserPassword() {
		return userPassword;
	}

	public void setUserMailbox(String userMailbox) {
		this.userMailbox = userMailbox;
	}
	public String getUserMailbox() {
		return userMailbox;
	}

	public void setUserPhone(String userPhone) {
		this.userPhone = userPhone;
	}
	public String getUserPhone() {
		return userPhone;
	}

	public void setUserToken(String userToken) {
		this.userToken = userToken;
	}
	public String getUserToken() {
		return userToken;
	}

	public void setUserRepositoryTime(String userRepositoryTime) {
		this.userRepositoryTime = userRepositoryTime;
	}
	public String getUserRepositoryTime() {
		return userRepositoryTime;
	}

	public void setUserLoginLastTime(String userLoginLastTime) {
		this.userLoginLastTime = userLoginLastTime;
	}
	public String getUserLoginLastTime() {
		return userLoginLastTime;
	}
}

UserRepository.java: Repositoryç‚ºæ•¸æ“šåº«è¨ªå•å±¤ï¼Œå®ƒåœ¨å…§éƒ¨å°è£äº†æ•¸æ“šæŸ¥è©¢å’Œå­˜å„²çš„é‚è¼¯ï¼Œä¹Ÿå¯ä»¥åœ¨é€™è£¡è‡ªå®šç¾© DAO çš„å¯¦ç¾æ–¹æ³•ã€‚
@Repository
public interface UserRepository extends JpaRepository<UserDao, Integer> {

}

æœ€å¾Œ JPA å¢åˆªæŸ¥æ”¹ çš„åŸºæœ¬ä½¿ç”¨ï¼š

å¢åŠ Userï¼š ä½¿ç”¨Repository.save()
@Autowired
private UserRepository userRepository;
public void addUser(UserDao userInfo) {
	UserDao userDao = new UserDao();
	userDao.setUserName(userInfo.getUserName());
	userRepository.save(userDao);
}

åˆªé™¤Userï¼šä½¿ç”¨Repository.delete()
@After
public void after() {
	userRepository.deleteById(1);
}

æŸ¥æ‰¾Userï¼šä½¿ç”¨Repository.findByXXXæˆ–è€…Repository.findAll;
é»˜èªåªæä¾›Repository.findById()ï¼Œå¦‚æœè¦æ ¹æ“šUserNameæŸ¥è©¢ï¼Œéœ€è¦åœ¨UserRepositoryä¸­è‡ªå®šç¾©ï¼ŒUserRepositoryä¸­æ–¹æ³•çš„å‘½åæœ‰ä¸€å®šçš„è¦å‰‡ã€‚å¦‚æœè¡¨ä¸­ç‚ºidå‰‡ç‚ºfindByIdã€‚å¦‚æœè¡¨ä¸­ç‚ºuser_nameå‰‡ç‚ºfindByUserNameã€‚
è‡ªå®šç¾©æ–¹æ³•ï¼š
@Repository
public interface UserRepository extends JpaRepository<UserDao, Integer> {
	public List<UserDao> findByUserName(String userName);
	public List<UserDao> findByUserMailbox(String userMailbox);
	public List<UserDao> findByUserToken(String token);
}

æŸ¥è©¢æ–¹æ³•ï¼š
public List<UserDao> getUser(String name) {
	List<UserDao> userInfos = userRepository.findByUserName(name);
	return userInfos;
}

æ›´æ–°æ–¹æ³•ï¼š
JPAæ²’æœ‰é»˜èªçš„æ›´æ–°æ–¹æ³•ï¼Œéœ€è¦åœ¨UserRepositoryä¸­è‡ªå®šç¾©æ›´æ–°æ–¹æ³•ã€‚æˆ–è€…ä½¿ç”¨saveæ–¹æ³•ä»£æ›¿ã€‚
å…¶ä¸­è‡ªå®šç¾©æ›´æ–°æ–¹æ³•@Queryä¸­valueç‚ºSQLèªæ³•ï¼ŒnativeQueryç‚ºæ˜¯å¦åŸç”Ÿçš„SQLèªå¥
// æ›´æ–°æŒ‡å®šUserNameçš„userLoginLastTime
@Query(value = "update " + TableInfo.userTable + " set " + TableInfo.userTable_loginLastTime + "=?2 where " + TableInfo.userTable_name + "=?1 ", nativeQuery = true)
@Transactional
@Modifying
public void updateLoginLastTime(String name, String userLoginLastTime);

æœ€å¾Œé‚„æ˜¯å›åˆ°UserControllerï¼Œä¿®æ”¹getUserListæ–¹æ³•ã€‚
@Autowired
private UserRepository userRepository;

@RestController
public class UserController {
	@RequestMapping("/getuserlist")
	public ApiResult getUserList() {
		int code = 0;
		String status = "unknown error";
		UserDao data = new UserDao();
		try {
			data = userRepository.findByUserName();
			code = 300;
		} catch (Exception e) {
			status = String.valueOf(e);	// æŠŠ Exception ä¸Ÿé€² String.valueOf()ï¼Œè½‰æˆæ–‡å­—ã€‚
		}
		// è¿”å›çµæœ
		ApiResult apiResult = new ApiResult();
		apiResult.setCode(code);
		apiResult.setStatus(status);
		apiResult.setData("123456");

		return apiResult;
	}
}
é‡æ–°é»æ“Šé‹è¡Œï¼Œä¸¦åœ¨ç€è¦½å™¨ä¸­è¼¸å…¥ URL:http://localhost:8080/getuserlist æ¸¬è©¦èƒ½å¦ç²å–è¿”å›æˆåŠŸã€‚

æŠŠå¾Œè‡ºéƒ¨ç½²åˆ°é˜¿é‡Œé›²æœå‹™å™¨
ä¸Šé¢åªæ˜¯åœ¨æœ¬åœ°è·‘é€šäº†ï¼Œä½†å¾Œè‡ºæ˜¯è¦éƒ¨ç½²åˆ°ä¼ºæœå™¨ä¸Šæ‰èƒ½çœŸæ­£ç™¼æ®å®ƒçš„ä½œç”¨ã€‚æ‰€ä»¥ä½ éœ€è¦ä¸€å€‹é˜¿é‡Œé›²æœå‹™å™¨(æ²’ä½¿ç”¨éå¯ä»¥åƒè€ƒ æ‰‹éŠSDK-Mavenç§æœ‰å€‰åº«çš„æ­å»º ä¸­çš„é˜¿é‡Œé›²æœå‹™å™¨éƒ¨åˆ†)

é¦–å…ˆåœ¨é˜¿é‡Œé›²ä¸Šå®‰è£MySQLã€‚
é…ç½®è¨ªå•æ¬Šé™ï¼Œä¸é…ç½®è¨ªå•æ¬Šé™ä½ æ˜¯é€£æ¥ä¸ä¸Šçš„ã€‚

æ‰“é–‹cmdé€²å…¥åˆ°MySQLå®‰è£ç›®éŒ„çš„binæ–‡ä»¶å¤¾ä¸‹
è¼¸å…¥mysqlå‘½ä»¤å’Œå¸³è™Ÿå¯†ç¢¼
mysql -u root -p
åˆ‡æ›åˆ°mysqlåº«
use mysql;
æŸ¥çœ‹ç•¶å‰ç”¨æˆ¶è¡¨ï¼Œç•¶å‰çš„host(root)é‚„æ˜¯localhost
select host, user from user;
æˆ‘å€‘éœ€è¦æ›´æ–°userç”¨æˆ¶è¡¨ï¼ŒæŠŠrootè®Šç‚ºå…è¨±å¤–ç¶²ipè¨ªå•ã€‚å¦‚æœåªéœ€è¦æŒ‡å®šipæ‰èƒ½è¨ªå•ï¼Œé‚£æŠŠ%é‚„æˆæŒ‡å®šipå³å¯
update user set host = '%' where user = 'root' LIMIT 1;
åˆ†é…è¨ªå•æ¬Šé™(å¦‚å·²åˆ†é…éäº†ï¼Œå¯è·³é)
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'rootå¯†ç¢¼' WITH GRANT OPTION;
æœ€å¾Œå¼·åˆ¶åˆ·æ–°æ¬Šé™
flush privileges;
å†æ¬¡æŸ¥è©¢ç”¨æˆ¶è¡¨ï¼Œæ­¤æ™‚çš„rootçš„hostå·²æ›´æ”¹ç‚º%(æˆ–è€…æŒ‡å®šçš„ip)
select host,user from user;
ä¿®æ”¹å®Œè¨ªå•æ¬Šé™ï¼Œé‚„éœ€è¦é…ç½®é˜¿é‡Œé›²çš„å®‰å…¨çµ„è¦å‰‡ã€‚
é˜¿é‡Œé›²çš„å®‰å…¨çµ„è¦å‰‡çš„é…ç½®ï¼š
ç™»å…¥é˜¿é‡Œé›²æ§åˆ¶å°ï¼Œç¶²çµ¡èˆ‡å®‰å…¨â†’å®‰å…¨çµ„â†’é…ç½®è¦å‰‡â†’æ·»åŠ å®‰å…¨çµ„è¦å‰‡ï¼Œé–‹æ”¾MySQLçš„3306ç«¯å£ã€‚

æ‰“é–‹æœ¬åœ°çš„MySQL Workbenchæ–°å»ºé˜¿é‡Œé›²MySQLçš„é€£æ¥(æŠŠåŸæœ¬çš„localhostä¹Ÿå°±æ˜¯åœ–ä¸­çš„xxxxxä¿®æ”¹ç‚ºé˜¿é‡Œé›²çš„å…¬æœ‰ip)ã€‚æ­¤æ™‚å°±èƒ½æ‰“é–‹é˜¿é‡Œé›²MySQLäº†ã€‚

ç„¶å¾Œå›åˆ°å·¥ç¨‹ï¼ŒæŠŠapplication.propertieså’ŒDatabaseä¸­çš„localhostä¿®æ”¹ç‚ºé˜¿é‡Œé›²çš„å…¬ç¶²ipï¼Œé‡æ–°é‹è¡Œï¼Œæ¸¬è©¦OKå°±å¯ä»¥æ‰“åŒ…äº†ã€‚
æœ€å¾Œåœ¨IDEAçš„Terminalçª—å£ä¸­ä½¿ç”¨mvn clean packageå‘½ä»¤é€²è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…å®Œæˆå¾Œæœƒåœ¨targetç›®éŒ„ä¸‹ç”ŸæˆjaråŒ…ã€‚ç„¶å¾ŒæŠŠç”Ÿæˆxxx-xx-SNAPSHOT.jarè¤‡è£½åˆ°é˜¿é‡Œé›²æœå‹™å™¨ä¸Šï¼Œæ‰“é–‹cmdé‹è¡Œã€‚
java -jar xxx-xx-SNAPSHOT.jar

æ‰“é–‹ç€è¦½å™¨ï¼Œè¼¸å…¥http://é˜¿é‡Œé›²å…¬ç¶²ip:8091/getuserlistï¼Œ8091ç‚ºç«¯å£è™Ÿï¼Œå› ç‚ºä¸€èˆ¬ä¸ä½¿ç”¨8080ç«¯å£è™Ÿã€‚ç«¯å£è™Ÿçš„è¨­ç½®å¯ä»¥åœ¨application.propertiesä¸­server.port=8091è¨­å®šã€‚çœ‹çœ‹æ¸¬è©¦çµæœã€‚

ä½ æœ‰å¯èƒ½è¸©åˆ°çš„å‘ï¼š
1. Could not create connection to database serverã€‚
æ˜¯å› ç‚º MySQL çš„ç‰ˆæœ¬èˆ‡å·¥ç¨‹ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ä¸ä¸€è‡´ã€‚å¯ä»¥ä¿®æ”¹ pom.xml ä¸­ mysql çš„ç‰ˆæœ¬
2. é‹è¡Œæ™‚å‡ºç¾ org.springframework.orm.jpa.JpaSystemException: could not execute statement; nested exception is org.hibernate.exception.GenericJDBCException: could not execute statement
æ•¸æ“šè¡¨çš„ä¸»éµæ²’æœ‰è¨­ç½®ï¼Œå¯ä»¥æŠŠå…¶è¨­ç½®ç‚ºè‡ªå¢ã€‚
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆIOC - Inversion of Controlï¼‰æ§åˆ¶åè½‰
å€’è½‰çš„æ˜¯å¯¦ä¾‹ä¾è³´ç‰©ä»¶çš„ã€Œæ§åˆ¶æµç¨‹ã€

æ§åˆ¶åè½‰ (Inversion of Control)èˆ‡ä¾è³´åè½‰ (Dependency Inversion)å…©è€…ä¸ç›¸ç­‰å»æœ‰å¤§é—œä¿‚ã€‚

ä¾è³´å€’ç½®åŸå‰‡ (Dependency Inversion Principle, DIP) ï¼š
é«˜éšæ¨¡çµ„ä¸æ‡‰è©²ä¾è³´æ–¼ä½éšæ¨¡çµ„â†’é«˜ã€ä½éšæ¨¡çµ„éƒ½ä¾è³´æŠ½è±¡ã€æŠ½è±¡ä¸æ‡‰è©²ä¾è³´æ–¼å…·é«”å¯¦ä½œæ–¹å¼â†’å…·é«”å¯¦ä½œæ–¹å¼ä¾è³´æŠ½è±¡
å€’è½‰çš„æ˜¯ã€Œä¾è³´é—œä¿‚ã€

èˆ‰ä¾‹ä¾†èªªï¼Œæ­¤ç¨‹å¼é•åäº†ä¾è³´å€’ç½®(DIP)åŸå‰‡
å®ƒä½¿é«˜éšæ¨¡çµ„(Computer)ä¾è³´ ä½éšæ¨¡çµ„(è‹±é›„è¯ç›Ÿ)
class Computer {
	// ä¾è³´æ–¼ä½éšæ¨¡çµ„: å…·é«”çš„è‹±é›„è¯ç›Ÿï¼Œè€ŒéæŠ½è±¡çš„éŠæˆ²
	private è‹±é›„è¯ç›Ÿ lol;

	public Computer() {
		lol = new è‹±é›„è¯ç›Ÿ();
	}

	public Computer(è‹±é›„è¯ç›Ÿ lol) {
		this.lol = lol;
	}

	public void playGame() {
		if (lol != null)
			lol.play();
	}
}

class è‹±é›„è¯ç›Ÿ {
	public void play() {
		System.out.println("å¾·ç‘ªè¥¿é›…~");
	}
}
ç„¶è€Œï¼Œå®ƒé‚„æ˜¯èƒ½é€éIoC/DIè¢«å‹•å–å¾—é¡åˆ¥è‹±é›„è¯ç›Ÿçš„å¯¦ä¾‹lol
è§£é™¤äº†é«˜éšæ¨¡çµ„(Computer)ä¸»å‹•å°ä½éšå…ƒä»¶(è‹±é›„è¯ç›Ÿ)çš„å¯¦ä¾‹æ–¹å¼ï¼Œå»è§£é™¤ä¸äº†é«˜éšæ¨¡çµ„å°ä½éšæ¨¡çµ„çš„ä¾è³´é—œä¿‚ã€‚
å› ç‚ºé«˜éšæ¨¡çµ„ä¾è³´çš„æ˜¯å…·é«”å¯¦ä½œ(è‹±é›„è¯ç›Ÿ)ï¼Œè€ŒéæŠ½è±¡ï¼ˆä»‹é¢ || æŠ½è±¡é¡åˆ¥)ã€‚

é‚„è¨˜å¾— ä¾è³´å€’ç½®åŸå‰‡ (Dependency Inversion Principle, DIP) çš„çµå°¾å—ï¼Ÿ
åƒ…åƒ…å°‡ã€ é«˜éšæ¨¡çµ„çš„ä¾è³´å°è±¡ï¼Œç”±å…·é«”æ”¹ç‚ºæŠ½è±¡ ã€ï¼Œæ˜¯ ä¸å¤  çš„ï¼Œ
å› ç‚ºé«˜éšæ¨¡çµ„ æ¬²ä½¿ç”¨ ä½éšæ¨¡çµ„çš„ç‰©ä»¶æ™‚ï¼Œé‚„æ˜¯ éœ€è¦è‡ªå·± new å…·é«”å¯¦ä½œé¡åˆ¥ã€‚

ä¾è³´ä¸¦æœªè§£é™¤

æƒ³è§£é™¤é€™ç¨®ä¾è³´ï¼Œå³å¯é€é IoC/DI ï¼Œ
ç›´æ¥å°‡ æ‰€éœ€ä½éšå…ƒä»¶ å‚³éçµ¦ é«˜éšæ¨¡çµ„ä½¿ç”¨ï¼Œ
é«˜éšæ¨¡çµ„ å•¥éƒ½æ²’å¹¹ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ ä½éšæ¨¡çµ„ã€‚


å…©è€…çµåˆå¾Œä¹Ÿå°±æ˜¯:

é«˜éšæ¨¡çµ„ï¼Œä¾è³´æ–¼æŠ½è±¡ï¼Œè€Œéä½éšæ¨¡çµ„ã€‚
ä½† è¦ä½¿ç”¨ è©²æŠ½è±¡çš„ å…·é«”ç”¢å“ (ä½éšæ¨¡çµ„) æ™‚ï¼Œ

1. ä¸ç”¨ä¹Ÿä¸éœ€è¦çŸ¥é“æ˜¯å“ªç¨® å…·é«”ç”¢å“
2. ä¸å†è‡ªå·±å¯¦ä¾‹ å…·é«”ç”¢å“ï¼Œè€Œæ˜¯ æœå‹™å®¹å™¨ æœƒæä¾›çµ¦ä»– ã€‚

é«˜éšæ¨¡çµ„ ä¸å†å» "æ‰¾å°‹" æ’ä»¶ï¼Œ
è€Œæ˜¯æ’ä»¶æœƒè‡ªå·±æ³¨å…¥åˆ° é«˜éšæ¨¡çµ„ä¸­ã€‚
é€™å°±æ˜¯ å¥½èŠå¡¢åŸå‰‡ (Hollywood Principle):

IoC/DI ï¼Œä¸¦éå¯¦ç¾ "DIP" çš„å”¯ä¸€è§£ï¼Œ
é‚„æœ‰ å·¥å» æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)ã€æœå‹™å®šä½æ¨¡å¼ (Service Locator Pattern)ï¼Œ
ä»¥åŠå„ç¨®çš„ å»ºç«‹å‹æ¨¡å¼ (Creational Pattern)â€¦ï¼Œçš†å¯ä»¥æ¶ˆé™¤ å¯¦ä¾‹å…·é«”ç”¢å“ (æ’ä»¶ Plugin) çš„ä¾è³´é—œä¿‚ã€‚


ï¼ˆDI - Dependency Injectionï¼‰ä¾è³´æ³¨å…¥
å°‡æ‰€éœ€çš„ ä¾è³´å¯¦ä¾‹ï¼Œæ³¨å…¥åˆ°é«˜éšæ¨¡çµ„ä¸­ã€‚
æœ‰ä»¥ä¸‹ä¸‰ç¨®å½¢å¼ï¼š

å»ºæ§‹å…ƒæ³¨å…¥ (Constructor Injection)
è¨­å€¼æ–¹æ³•æ³¨å…¥ (Setter Injection)
ä»‹é¢æ³¨å…¥ (Interface Injection)

é€™è£¡æˆ‘ä»¥ â€œç¶²å’–â€ åšç‚ºèˆ‰ä¾‹ï¼Œ
é«˜éšæ¨¡çµ„ (Computer) ä¾è³´ æŠ½è±¡ä»‹é¢ (Game)ï¼Œ
ä¸”æœ‰è¨±å¤š å…·é«”ç”¢å“ (Plugin) å¯¦ä½œæ­¤ æŠ½è±¡ä»‹é¢ (Game):
class Computer implements GameInjector {
	private Game game;	// ä¾è³´ æŠ½è±¡ è€Œé å…·é«”

	// å»ºæ§‹å…ƒæ³¨å…¥
	public Computer(Game game) {
		this.game = game;
	}

	// è¨­å€¼æ–¹æ³•æ³¨å…¥
	public void setGame(Game game) {
		this.game = game;
	}

	// ä»‹é¢æ³¨å…¥
	@Override
	public void injectGame(Game game) {
		this.game = game;
	}

	public void playGame() {
		if (game != null) {
			game.play();
		}
	}
}
// éŠæˆ²æ³¨å…¥è€…
// å¯ä»¥è¦ç¯„: ä»»ä½•éœ€è¦ éŠæˆ² çš„æ¨¡çµ„ éƒ½å¿…é ˆå¯¦ä½œæ­¤ä»‹é¢
interface GameInjector {
	void injectGame(Game game);
}
		(C)çˆ†çˆ†ç‹	(C)ä¸–ç´€å¸åœ‹	(C)è‹±é›„è¯ç›Ÿ
		play()		play()		play()
			\	     |	       /
(C)Computer			(I)IGame
				play()

å¯ä»¥çœ‹åˆ°ç¨‹å¼ä¸­ï¼Œæ²’æœ‰ä»»ä½• â€œå…·é«”å¯¦ä½œé¡åˆ¥â€ çš„åç¨±ï¼Œ
è€Œæ˜¯ç”± ä¾è³´æ³¨å…¥ å–å¾— æ’ä»¶å¯¦ä¾‹ï¼Œ
é«˜éšæ¨¡çµ„ï¼Œå®Œå…¨æ²’æœ‰èˆ‡å…·é«”å¯¦ä½œ è€¦åˆï¼Œ
å¯¦ç¾äº† ä¾è³´å€’ç½®åŸå‰‡ (Dependency Inversion Principle, DIP) ï¼

å»ºæ§‹å…ƒæ³¨å…¥ (Constructor Injection) vs è¨­å€¼æ–¹æ³•æ³¨å…¥ (Setter Injection)
Itâ€™s important to support both mechanisms, even if thereâ€™s a preference for one of them.
â€”â€” Martin Fowler
å³ä½¿ä½ æœ‰è¼ƒåå¥½çš„é¸æ“‡ï¼ŒåŒæ™‚æ”¯æŒé€™å…©ç¨®æ©Ÿåˆ¶éƒ½æ˜¯å¿…è¦çš„ã€‚

IoC/DI vs å·¥å» æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)
å·¥å» åªè² è²¬ã€ç”Ÿç”¢ã€ï¼Œä¸ç‰½æ¶‰åˆ° å¯¦ä¾‹ä¾è³´ç‰©ä»¶çš„ ã€æ§åˆ¶æµç¨‹ã€ã€‚
é«˜éšæ¨¡çµ„æ˜¯å¦ä¾è³´æ–¼å·¥å» ï¼Œå…¨æ†‘ä½ æ€éº¼ä½¿ç”¨å®ƒã€åœ¨å“ªä½¿ç”¨å®ƒã€‚

èˆ‰å¹¾å€‹ç°¡å–®çš„ä¾‹å­:
1. å‚³çµ±æ§åˆ¶æµç¨‹çš„ ã€ä½¿ç”¨å·¥å»  å¯¦ä¾‹æ’ä»¶ã€:
class Computer {
	private Game game;					// ä¾è³´Gameã€GameFactoryã€ImplGameFactory

	public Computer() {
		GameFactory factory = new ImplGameFactory();	// å¯¦ä¾‹ éŠæˆ²å·¥å» (æ³¨æ„å¤šå‹)
		this.game = factory.createGame();		// é€éå·¥å» ï¼Œå–å¾—éŠæˆ²
	}
	...
}
2. æ§åˆ¶åè½‰ çš„ ã€ä½¿ç”¨å·¥å»  å¯¦ä¾‹æ’ä»¶ã€ â€” [å‹ä¸€] æ’ä»¶æ³¨å…¥ï¼š
public class Main {
	public static void main(String[] args) {
		GameFactory factory = new ImplGameFactory();	// å¯¦ä¾‹ éŠæˆ²å·¥å» (æ³¨æ„å¤šå‹)
		Game game = factory.createGame();		// é€éå·¥å» ï¼Œå–å¾—éŠæˆ²
		Computer computer = new Computer(game);	// game ä¾è³´æ³¨å…¥
	}
}

class Computer {
	private Game game;					// åªä¾è³´Game
	// å»ºæ§‹å…ƒæ³¨å…¥
	public Computer(Game game) {
		this.game = game;
	}
	...
}
3. æ§åˆ¶åè½‰ çš„ ã€ä½¿ç”¨å·¥å»  å¯¦ä¾‹æ’ä»¶ã€ â€” [å‹äºŒ] å·¥å» æ³¨å…¥ï¼š
public class Main {
	public static void main(String[] args) {
		GameFactory factory = new ImplGameFactory();	// å¯¦ä¾‹ éŠæˆ²å·¥å» (æ³¨æ„å¤šå‹)
		Computer computer = new Computer(factory);	// factory ä¾è³´æ³¨å…¥
	}
}

class Computer {
	private Game game;					// ä¾è³´Gameã€GameFactory
	// å»ºæ§‹å…ƒæ³¨å…¥
	public Computer(GameFactory factory) {
		this.game = factory.createGame();		// é€éå·¥å» ï¼Œå–å¾—éŠæˆ²
	}
	...
}

å¯ä»¥çœ‹åˆ°
ç¬¬ä¸€ç¨®ã€å‚³çµ±æ§åˆ¶æµç¨‹çš„ ã€ä½¿ç”¨å·¥å»  å¯¦ä¾‹æ’ä»¶ã€ï¼š
é«˜éšæ¨¡çµ„ (Computer) ä¸ä¾è³´æ–¼ ä½éšæ¨¡çµ„ï¼Œè€Œæ˜¯ä¾è³´æ–¼æŠ½è±¡ (Game)ã€‚ (Good)
é«˜éšæ¨¡çµ„ (Computer) ä¾è³´æ–¼ æŠ½è±¡ (GameFactory)ã€‚ (Good)
é«˜éšæ¨¡çµ„ (Computer) ä¾è³´æ–¼ å…·é«”å¯¦ä½œå·¥å»  (ImplGameFactory)ã€‚ (Bad)

ç¬¬äºŒç¨® åŠ ç¬¬ä¸‰ç¨® çš„æ–¹å¼ï¼Œä¸€æ¨£ä½¿ç”¨äº†å·¥å» ï¼Œå»å¯è§£é™¤ é«˜éšæ¨¡çµ„ èˆ‡ å…·é«”å·¥å»  çš„ä¾è³´é—œä¿‚ï¼


IoCå®¹å™¨(IoC Container)
IoC å®¹å™¨ (åˆç¨±ï¼š æœå‹™å®¹å™¨ Service Container)ï¼Œæ˜¯ çµ„è£ & é…ç½®å…ƒä»¶ï¼Œé€é ä¾è³´æ³¨å…¥ (Dependency Injection)ï¼Œæä¾›æ‰€éœ€æœå‹™çµ¦æ¨¡çµ„çš„åœ°æ–¹ã€‚

å»£ç¾©ä¸Šä¾†èªªï¼Œ IoC å®¹å™¨ï¼Œå°±æ˜¯æœ‰é€²è¡Œ ä¾è³´æ³¨å…¥ çš„åœ°æ–¹ï¼Œä½ éš¨ä¾¿å¯«ä¸€å€‹é¡åˆ¥ï¼Œé€éå®ƒå°‡æ‰€éœ€å…ƒä»¶æ³¨å…¥çµ¦ é«˜éšæ¨¡çµ„ï¼Œä¾¿å¯èªªæ˜¯å®¹å™¨ã€‚

ä½†ç¾åœ¨æ‰€èªªçš„ ã€å®¹å™¨ã€ï¼Œå¾€å¾€æ˜¯æ³›æŒ‡é‚£äº›å¼·å¤§ã€æ¡†æ¶ã€çš„å®¹å™¨ï¼š
æ ¹æ“šè¨­å®šã€è‡ªå‹•ç”Ÿç”¢ã€ç‰©ä»¶ (éå–®ä¸€ç”¢å“)ï¼Œå°‡å…¶æä¾›çµ¦æ‰€éœ€æ¨¡çµ„ï¼Œä¸¦ç®¡ç†è©²ç‰©ä»¶æ•´å€‹ç”Ÿå‘½é€±æœŸçš„ è¶…ç´šè‡ªå‹•åŒ–å·¥å» ã€‚

å¤§éƒ¨åˆ†æ¡†æ¶çš„ IoC å®¹å™¨ï¼Œå¹¾ä¹éƒ½é€é ã€åå°„ (Reflection) æ©Ÿåˆ¶ã€ï¼Œ
ä¾† å‹•æ…‹ç”Ÿæˆå¯¦ä¾‹ã€æˆ–ç”±é…ç½®æ–‡ä»¶ (e.g., jsonã€xmlã€propertiesã€iniã€php) å°‹æ‰¾ä¾è³´é—œä¿‚ï¼Œ
æè¿°è©²å¦‚ä½•å»ºæ§‹å¯¦ä¾‹ã€æˆ–æª¢æŸ¥æ˜¯å¦è©²ç‚ºç•¶å‰æ¨¡çµ„æ³¨å…¥ä¾è³´ â€¦ã€‚
 
å› æ­¤å®¹å™¨ï¼Œé€šå¸¸æœƒæœ‰å€‹ bind (æˆ– registerã€config â€¦etc.) çš„å‡½æ•¸ï¼Œ
ä¾› è¨»å†Šä¾è³´é—œä¿‚ã€æˆ–å‘Šè¨´å®¹å™¨: ä½•ç¨®æƒ…å¢ƒéœ€è¦è©²å¯¦ä¾‹ã€‚
 
å†ä¾†ï¼Œé€šå¸¸ä¹Ÿæœƒæœ‰æœ‰å€‹ make (æˆ– createã€resolve â€¦etc.)ï¼Œ
è®“å®¹å™¨ è§£æç‰©ä»¶ï¼Œæˆ–å¯¦ä¾‹å·²ç¶å®šä¹‹ç‰©ä»¶ã€‚


ç¶²å’–å®¹å™¨ç¯„ä¾‹		// å¯¦éš›çš„å®¹å™¨ï¼Œéœ€è¦å…¼é¡§å¾ˆå¤šç´°ç¯€ï¼Œä¸¦ä¸”æ ¹æ“šä¸åŒ èªè¨€ã€åŠŸèƒ½ã€ç”¨é€”ï¼Œå®¹å™¨çš„å¯«æ³•ä¹Ÿä¸ç›¡ç›¸åŒï¼Œå¤§éƒ¨åˆ†æ¡†æ¶éƒ½å¯«å¾—å¾ˆæ£’ï¼Œè«‹åˆ¥é‡é€ è¼ªå­äº†ã€‚
å¯¦éš›ä¸Šçš„ä½¿ç”¨ï¼š
public class Main {
	public static void main(String[] args) {
		ServiceContainer container = new ServiceContainer();		// å¯¦ä¾‹ å®¹å™¨
		// è¨»å†Šä¾è³´é—œä¿‚: ç•¶é‡åˆ°ã€ŒGameã€ï¼Œè®“å®¹å™¨çµ¦æˆ‘ã€Œçˆ†çˆ†ç‹ã€
		container.bind(Game.class, çˆ†çˆ†ç‹.class);

		// è¨»å†Šä¾è³´é—œä¿‚: ç•¶é‡åˆ°ã€ŒComputerã€ï¼Œè®“å®¹å™¨çµ¦æˆ‘ã€ŒComputer(Game, 100)ã€
		// ä¸¦ä¸” å› ç‚ºä¸Šé¢å·²è¨»å†ŠéGameï¼Œå®¹å™¨æœƒç›´æ¥å‚³å›ã€Œçˆ†çˆ†ç‹ã€çµ¦æˆ‘
		container.bind(Computer.class, Game.class, 100);

		Computer computer = (Computer) container.make(Computer.class);	// è®“å®¹å™¨è£½ä½œ Computer
		computer.playGame();	// ä½¿ç”¨å·²è¢«æ³¨å…¥ä¾è³´çš„Computerç‰©ä»¶
	}
}

// Result: 
/*
 * é–‹å§‹å¯¦ä¾‹ç‰©ä»¶: Computer
 * å»ºæ§‹å…ƒæ•¸é‡ç‚º4
 *
 * å°‹è¨ª 0 åƒæ•¸ å»ºæ§‹å…ƒ
 * æœªç¶å®š0 åƒæ•¸
 *
 * å°‹è¨ª 1 åƒæ•¸ å»ºæ§‹å…ƒ
 * æœªç¶å®š1 åƒæ•¸
 *
 * å°‹è¨ª 2 åƒæ•¸ å»ºæ§‹å…ƒ
 * å°‹è¨ª è¢«ç¶å®šåƒæ•¸ list
 * åƒæ•¸å‹æ…‹: Game
 * é€²å…¥ make éè¿´ å¯¦ä¾‹åƒæ•¸
 * é–‹å§‹å¯¦ä¾‹ç‰©ä»¶: Game
 * å»ºæ§‹å…ƒæ•¸é‡ç‚º0
 *
 * çˆ†çˆ†ç‹ ç‚º Game çš„å­é¡ï¼
 * ====å¯¦ä¾‹ç‰©ä»¶====
 * çˆ†çˆ†ç‹
 * ===============
 *
 * å¯¦ä¾‹ Game æˆåŠŸ
 *
 * boolean
 * Integer
 * ===============
 * å»ºæ§‹åƒæ•¸ èˆ‡ ç¶å®š list æ•¸é‡ç›¸åŒï¼Œä½†å‹æ…‹ä¸åŒ (å¤šè¼‰)
 * ç•¥éæ­¤æ¬¡è¿´åœˆå°‹è¨ª
 * ===============
 *
 * å°‹è¨ª 2 åƒæ•¸ å»ºæ§‹å…ƒ
 * å°‹è¨ª è¢«ç¶å®šåƒæ•¸ list
 *
 * åƒæ•¸å‹æ…‹: Game
 * é€²å…¥ make éè¿´ å¯¦ä¾‹åƒæ•¸
 * é–‹å§‹å¯¦ä¾‹ç‰©ä»¶: Game
 * å»ºæ§‹å…ƒæ•¸é‡ç‚º0
 *
 * çˆ†çˆ†ç‹ ç‚º Game çš„å­é¡ï¼
 * ====å¯¦ä¾‹ç‰©ä»¶====
 * çˆ†çˆ†ç‹
 * ===============
 *
 * å¯¦ä¾‹ Game æˆåŠŸ
 *
 * æ­¤éŠæˆ²éœ€è¦ 100å…ƒ
 * å¯¦ä¾‹ Computer æˆåŠŸ
 *
 * æµ·ç›œèˆ¹ 14
 */

å¯ä»¥çœ‹åˆ°ä¸Šé¢ï¼Œç¯„ä¾‹ä¸­ï¼Œç¬¬ä¸€å€‹åƒæ•¸ï¼Œç‚ºè¦ç¶å®šçš„ã€æ¢ä»¶ã€ï¼ŒXXX.class ï¼Œæ˜¯æˆ‘åšçš„ç°¡æ˜“ã€å‹åˆ¥æç¤ºã€ï¼Œå…¶ä»–çš†æ˜¯ å»ºæ§‹å­çš„åƒæ•¸ã€‚

ä»¥ bind(Computer.class, Game.class,100) ç‚ºä¾‹ï¼Œç¬¬ä¸€å€‹åƒæ•¸ï¼Œç‚ºè¦ç¶å®šçš„ã€æ¢ä»¶ã€ï¼Œå¾Œé¢éƒ½æ˜¯å»ºæ§‹å…ƒ åƒæ•¸ã€‚
ä½†æ˜¯ï¼Œå¯¦éš›ä¸Šçš„å»ºæ§‹å­ï¼Œæ˜¯é•·é€™æ¨£:

public Computer(Game game, Integer money){...

éœ€å‚³å…¥çš„ï¼Œæ˜¯ Game å¯¦ä¾‹ï¼Œè€Œé Game.classï¼Œå®¹å™¨æœƒå»è§£æ Game.classï¼Œçœ‹æœ‰æ²’æœ‰ç›¸é—œçš„ å…·é«”å¯¦ä½œï¼Œå¹«ä½ ä¾è³´æ³¨å…¥ã€‚


å†èˆ‰å€‹ä¾‹ï¼š
public class Main {
	public static void main(String[] args) {
		ServiceContainer container = new ServiceContainer();		// å¯¦ä¾‹ å®¹å™¨

		// è¨»å†Šä¾è³´é—œä¿‚ï¼š ç•¶é‡åˆ° ã€ Game ã€ï¼Œè®“å®¹å™¨çµ¦æˆ‘ ã€ è‹±é›„è¯ç›Ÿ ã€
		container.bind(Game.class, è‹±é›„è¯ç›Ÿ.class);

		// è¨»å†Šä¾è³´é—œä¿‚ï¼š ç•¶é‡åˆ° ã€ Computer ã€ï¼Œè®“å®¹å™¨çµ¦æˆ‘ ã€ Computer(Game,true) ã€
		// ä¸¦ä¸” å› ç‚ºä¸Šé¢å·²è¨»å†Šé Game ï¼Œ å®¹å™¨æœƒç›´æ¥å‚³å›ã€è‹±é›„è¯ç›Ÿã€çµ¦æˆ‘
		container.bind(Computer.class, Game.class, true);

		Computer computer1 = (Computer) container.make(Computer.class);	// è®“å®¹å™¨è£½ä½œ Computer
		computer1.playGame();	// ä½¿ç”¨å·²è¢«æ³¨å…¥ä¾è³´çš„Computerå…ƒä»¶
	}
}

// Result:
/*
 * é–‹å§‹å¯¦ä¾‹ç‰©ä»¶: Computer
 * å»ºæ§‹å…ƒæ•¸é‡ç‚º4
 *
 * å°‹è¨ª 0 åƒæ•¸ å»ºæ§‹å…ƒ
 * æœªç¶å®š0 åƒæ•¸
 *
 * å°‹è¨ª 1 åƒæ•¸ å»ºæ§‹å…ƒ
 * æœªç¶å®š1 åƒæ•¸
 *
 * å°‹è¨ª 2 åƒæ•¸ å»ºæ§‹å…ƒ
 * å°‹è¨ª è¢«ç¶å®šåƒæ•¸ list
 *
 * åƒæ•¸å‹æ…‹: Game
 * é€²å…¥ make éè¿´ å¯¦ä¾‹åƒæ•¸
 * é–‹å§‹å¯¦ä¾‹ç‰©ä»¶: Game
 * å»ºæ§‹å…ƒæ•¸é‡ç‚º0
 *
 * è‹±é›„è¯ç›Ÿ ç‚º Game çš„å­é¡ï¼
 * ====å¯¦ä¾‹ç‰©ä»¶====
 * è‹±é›„è¯ç›Ÿ
 * ===============
 *
 * å¯¦ä¾‹ Game æˆåŠŸ
 *
 * é€™æ˜¯ç·šä¸ŠéŠæˆ²
 * å¯¦ä¾‹ Computer æˆåŠŸ
 *
 * å¾·ç‘ªè¥¿é›…~
 */

ç¸½çµï¼š

æˆ‘åªæ˜¯è¦é–‹ç™¼å€‹ å°ç³»çµ±ï¼Œåˆä¸æƒ³å­¸é€™å€‹æ¡†æ¶ï¼Œ
é›£é“è¦è‡ªåˆ»ä¸€å€‹å®¹å™¨ï¼Œæ‰èƒ½ä½¿ç”¨ IoC/DI å—ï¼Ÿ

æ²’ç”¨æ¡†æ¶ä¹Ÿæ²’å·®ï¼Œ
è¦è¨˜å¾— ã€æ§åˆ¶åè½‰ ã€æŒ‡çš„æ˜¯:
åè½‰ã€å¯¦ä¾‹ç‰©ä»¶çš„æ§åˆ¶æµç¨‹ã€ï¼Œ
ä¸¦éä¸€å®šè¦æœ‰æ¡†æ¶èˆ¬çš„å¼·å¤§å®¹å™¨ï¼Œæ‰åšå¾—åˆ°ï¼Œé€™æ˜¯å€‹éŒ¯èª¤çš„è¿·æ€ï½ ğŸ˜®ã€‚
 
ç°¡å–®åŠ å…¥ä¸€å€‹ ã€ç¬¬ä¸‰æ–¹é¡åˆ¥ã€é€²è¡Œå¯¦ä¾‹å…ƒä»¶ã€ä¾è³´æ³¨å…¥ï¼Œå°±å¯ä»¥é”åˆ°ã€‚
é€™æ™‚ å·¥å» æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)ï¼Œå°±éå¸¸å¥½ç”¨ã€‚
(å†æ¬¡å¼·èª¿ï¼Œå·¥å»  èˆ‡ IoC/DI ä¸¦éäº’æ–¥ï¼Œç”šè‡³æ™‚å¸¸é€é å·¥å»  å¯¦ç¾ IoC/DI)
 
å¦‚æœç†Ÿæ‚‰äº† IoC/DI çš„æ¦‚å¿µï¼Œ
å°±çŸ¥é“äº†ï¼Œå­¸ç¿’æ¡†æ¶ï¼Œé™¤äº†å­¸ç¿’ä»–çš„é‹ä½œæµç¨‹ã€æä¾›çš„æ–¹æ³•â€¦ï¼Œ
å†ä¾†å°±æ˜¯å­¸ç¿’ï¼Œå¦‚ä½•è®“å®ƒ è‡ªå‹• èª¿ç”¨ä½ å¯«çš„é¡åˆ¥ï¼Œ
é€™ä¹Ÿæ˜¯ æ¡†æ¶ (Framework) èˆ‡ å‡½å¼åº« (Library) æœ€å¤§çš„å·®ç•°ä¹‹è™•ã€‚

ï¼ˆAOP - Aspect Oriented Programmingï¼‰
åˆ†é›¢ç‚ºæ¥­å‹™é‚è¼¯èˆ‡å…¶ä»–ä¸ç›¸å¹²çš„ä»£ç¢¼ã€‚
___________________________________________________________________________________________________________________________________________________________________________________________________________________
åœ¨ SpringBoot ä¹‹å‰ï¼Œå¯èƒ½åœ¨æ¥è§¸ Springã€SpringMVC ç­‰æ¡†æ¶çš„ web é …ç›®éƒ½æœƒæ¶‰åŠåˆ°ä¸€å€‹ web.xmlï¼Œç‚ºäº†å°‡æˆ‘å€‘çš„ DispatcherServlet è¨»å†Šé€²ä¾†ï¼Œæˆ‘å€‘æœƒåœ¨ web.xml è£¡æ·»åŠ ä¸€äº›æ±è¥¿å¦‚ä¸‹ï¼š
<servlet>
        <servlet-name>SpringMVC</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:spring-mvc.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
        <async-supported>true</async-supported>
    </servlet>
    <servlet-mapping>
        <servlet-name>SpringMVC</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>

è€Œä½¿ç”¨SpringBootçš„æˆ‘å€‘éƒ½çŸ¥é“ï¼Œæˆ‘å€‘ä¸¦æ²’æœ‰æ¥è§¸åˆ°web.xmlã€‚ä¹Ÿæ²’æœ‰æä¸€å€‹Tomcaté€²å»ï¼Œè€Œæ˜¯ç›´æ¥å°±èƒ½ä½¿ç”¨SpringMVCçš„è¨»è§£é€²è¡Œé …ç›®é–‹ç™¼ï¼Œé‚£SpringBootåˆ°åº•åšäº†ä»€éº¼äº‹æƒ…ï¼Ÿä¸‹é¢ä¾†æ¢è¨SpringBootå¦‚ä½•å…§ç½®tomcatä»¥åŠæ•´åˆSpringMVCçš„æ ¸å¿ƒè¨­è¨ˆã€‚

æ²’æœ‰web.xmlä¹Ÿå¯ä»¥å•Ÿå‹•SpringMVC
é€šå¸¸æˆ‘å€‘çš„DispatcherServletä½œç‚ºä¸€å€‹servletéœ€è¦åœ¨tomcatçš„web.xmlè£¡é¢è²æ˜ï¼Œä½†ç¾åœ¨æœ‰æ›´æ–°çš„æ–¹å¼å°±æ˜¯é€éJavaä»£ç¢¼é€²è¡Œè¨»å†Šï¼Œå¯¦ç¾å¾ˆç°¡å–®åªéœ€è¦å¯¦ç¾WebApplicationInitializeré€™å€‹æ¥å£ï¼Œä¸‹é¢æˆ‘å€‘é©—è­‰ä¸€ä¸‹é€™å€‹å•é¡Œï¼Œæˆ‘å€‘ç”¨ä¸€å€‹ç°¡å–®çš„webé …ç›®é€²è¡Œå¯¦ç¾ã€‚

package com.controller;

import org.springframework.web.WebApplicationInitializer;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;

public class MyWebApplicationInitializer implements WebApplicationInitializer {
	@Override
	public void onStartup(ServletContext servletContext) throws ServletException {
		System.out.println("-----WebApplicationInitializer-----");
	}
}
å¯ä»¥çœ‹åˆ°tomcatåœ¨å•Ÿå‹•çš„æ™‚å€™é€²å…¥äº†é€™å€‹æ–¹æ³•ï¼Œèªªæ˜é€™å€‹æ–¹æ³•åªè¦æˆ‘å€‘å¯¦ç¾å°±èƒ½åœ¨tomcatå•Ÿå‹•çš„æ™‚å€™åšä¸€äº›äº‹æƒ…ï¼Œè€Œé€™è£¡çš„åƒæ•¸servletContextæˆ‘å€‘å¯ä»¥çœ‹çœ‹å®ƒçš„APIã€‚
addFilter(String s, S... Dynamic
addFilter(String s, F... Dynamic
addFilter(String s, C... Dynamic
addListener(T t)	void
addListener(String s)	void
addListener(Class<? ext... void
addServlet(String s, ... Dynamic
addServlet(String s, ... Dynamic
addServlet(String s, ... Dynamic
å¯ä»¥çœ‹åˆ°å®ƒèƒ½å¤ æ·»åŠ æˆ‘å€‘çš„Servletï¼Œé‚£é€™å°±å¾ˆç°¡å–®äº†ï¼Œæˆ‘å€‘å¯ä»¥é€šéå¯¦ç¾é€™å€‹tomcatæä¾›çš„å¤–ç½®æ¥å£ä¾†åšæ‹“å±•ï¼Œå°‡æˆ‘å€‘çš„SpringMVCå°è£é€²å»ï¼Œé€™å°±è§£æ±ºäº†æˆ‘å€‘çš„å•é¡Œ "æ²’æœ‰web.xmlï¼Œæˆ‘å€‘ä¾èˆŠèƒ½å•Ÿå‹•SpringMVC"ã€‚

Tomcat å¦‚ä½•å…§ç½®ï¼Ÿ
åœ¨è§£é‡‹å¦‚ä½•å…§ç½®Tomcatçš„å•é¡Œä¸­ï¼Œæˆ‘å€‘å…ˆè§£é‡‹é€™å€‹å•é¡Œï¼Œåœ¨SpringBootä¹‹å‰æˆ‘å€‘æ‡‰è©²æœƒæ¥è§¸éç”¨Mavenæ’ä»¶å®‰è£Tomcatï¼Œç„¶å¾Œå•Ÿå‹•æ•´å€‹é …ç›®ï¼Œå¦‚ä¸‹ï¼š
<plugin>
	<groupId>org.apache.tomcat.maven</groupId>
	<artifactId>tomcat7-maven-plugin</artifactId>
	<version>2.2</version>
</plugin>
æˆ‘å€‘é»é–‹é€™å€‹æ’ä»¶å¯ä»¥çœ‹åˆ°
<dependencies>
	<dependency>
		<groupId>org.apache.tomcat.embed</groupId>
		<artifactId>tomcat-embed-core</artifactId>
		<version>${tomcat7Version}</version>
	</dependency>
	<dependency>
		<groupId>org.apache.tomcat</groupId>
		<artifactId>tomcat-util</artifactId>
		<version>${tomcat7Version}</version>
	</dependency>
å®ƒå…§éƒ¨ä¾è³´äº†å¾ˆå¤štomcatçš„åŒ…ï¼Œé€™è£¡æˆ‘å€‘çœ‹åˆ°ä¸€å€‹embedçš„åŒ…ï¼Œä¸‹é¢å°±ä¾†è§£é‡‹tomcatå¦‚ä½•å…§ç½®çš„å•é¡Œã€‚
é¦–å…ˆå°‡æˆ‘å€‘çš„Springæºç¢¼å·¥ç¨‹åŠ å…¥ä¸€äº›é…ç½®ï¼š
dependencies {
	compile(project(":spring-beans"))
	compile(project(":spring-core"))
	compile(project(":spring-webmvc"))
	compile(project(":spring-context"))	// for JCA, @EnableTransactionManagement
	compile(project(':spring-context-support'))
	// Tomcat ä¾è³´
	compile 'org.apache.tomcat.embed:tomcat-embed-core:8.5.5'
	compile 'org.apache.tomcat.embed:tomcat-embed-el:8.5.5'
	compile 'org.apache.tomcat.embed:tomcat-embed-jasper:8.5.5'

	testCompile group: 'junit', name: 'junit', version: '4.12'
ç„¶å¾Œæˆ‘å€‘åœ¨å¯«ä¸€å€‹testé¡
public static void main(String[] args) {
	Tomcat tom = new Tomcat();
	tom.setPort(8080);
		// tomcat å•Ÿå‹•
		tom.start();
		// é˜»å¡ï¼Œç­‰å¾…å‰ç«¯é€£æ¥ tom.getServer().await();
		tom.getServer().await();
	} catch (Exception e) {
		e.printStackTrace();
	}
}
tomcatä¹Ÿå¯ä»¥newå‡ºä¾†ï¼Œæ²’éŒ¯tomcatç‚ºä»€éº¼ç¨±ç‚ºå®¹å™¨é€™ä¹Ÿä¸æ˜¯æ²’æœ‰é“ç†ï¼Œå°±å¥½æ¯”æˆ‘å€‘ç¨±Springå®¹å™¨ç„¡éå°±æ˜¯Springå…§éƒ¨è£äº†å¾ˆå¤šBeanå°è±¡ï¼Œè€Œtomcatåªæ˜¯è£äº†å¾ˆå¤šservletè€Œå·²ï¼Œå®ƒä¾èˆŠèƒ½å¤ è¢«æˆ‘å€‘ç›´æ¥èª¿ç”¨ï¼Œç•¶ç„¶ç›®å‰æˆ‘å€‘å•Ÿå‹•çš„tomcatåªæ˜¯ä¸€å€‹ç©ºæ®¼å®¹å™¨ï¼Œä¸‹é¢æˆ‘å€‘å°±ä¾†æ¨¡æ“¬SpringBootå¦‚ä½•å…§ç½®tomcatä¸”æ•´åˆSpringçš„ã€‚

æ¨¡æ“¬SpringBootå…§ç½®tomcatä¸”æ•´åˆSpring
é¦–å…ˆå¯«ä¸€å€‹test
public class Test {
	public static void main(String[] args) {
		Tomcat tom = new Tomcat();
		tom.setPort(8080);
		try {
			File file = new File(System.getProperty("java.io.tmpdir"));
			// ç²å–é …ç›®ç·¨è­¯å¾Œçš„classè·¯å¾‘
			String path = Test.class.getResource("/").getPath();

			// ç²å– webapp æ–‡ä»¶
			String filePath = new File("src/main/webapp").getAbsolutePath();

			// ç„¶å¾Œå°‡webappä¸‹çš„é …ç›®æ·»åŠ è‡³tomcatçš„contextå®¹å™¨(contextå°æ‡‰ä¸€å€‹é‹è¡Œçš„é …ç›®)
			Context context = tom.addWebapp("/", filePath);	// åƒæ•¸1: ä¸€èˆ¬æ˜¯é …ç›®å å°æ‡‰è«‹æ±‚urlä¸­çš„é …ç›®å
			// webResourceRoot ç”¨æ–¼åŠ è¼‰é …ç›®çš„classæ–‡ä»¶
			WebResourceRoot webResource = new StandardRoot(context);
			webResource.addPreResources(new DirResourceSet(webResource, "/WEB-INF/classes", path, "/"));
			// tomcatå•Ÿå‹•
			tom.start();
			// é˜»å¡ï¼Œç­‰å¾…å‰ç«¯é€£æ¥ tom.getServer().await();
			tom.getServer().await();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}

ç„¶å¾Œå†å¯«ä¸€å€‹é…ç½®é¡
@Configuration
@ComponentScan("SpringMVC.**")
/* @EnableWebMvc */
public class AppConfig {

}

æ³¨æ„ComponentScançš„è·¯å¾‘ï¼Œå¯èƒ½å’Œæˆ‘çš„ä¸ä¸€æ¨£ï¼Œæœ€å¾Œå†å¯«ä¸€å€‹WebApplicationInitializer
public class MyWebApplicationInitializer implements WebApplicationInitializer {
	@Override
	public void onStartup(ServletContext servletCxt) {

		// Load Spring web application configuration
		AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();
		ac.register(AppConfig.class);
		ac.refresh();

		// Create and register the DispatcherServlet
		DispatcherServlet servlet = new DispatcherServlet(ac);
		ServletRegistration.Dynamic registration = servletCxt.addServlet("SpringMVC", servlet);
		registration.setLoadOnStartup(1);
		registration.addMapping("/*");
		System.out.println("WebApplicationInitializer");
	}
}

å¥½äº†æº–å‚™å·¥ä½œå®Œç•¢æˆ‘å€‘å¯«ä¸€å€‹æ¸¬è©¦é¡
@Controller			// å¯èƒ½è¼ƒæ—©çš„æ–‡ç« æ²’æœ‰ä½¿ç”¨RestController
public class UserController {
	@RequestMapping("/home")
	public String home() {
		System.out.println("---------------");
		return "home";
	}
}

é‹è¡Œæˆ‘å€‘çš„tomcatï¼Œé‹è¡Œå®Œç•¢å¾Œæˆ‘å€‘çœ‹åˆ°äº†æˆ‘å€‘çš„å›èª¿å‡½æ•¸å·²è¢«åŸ·è¡Œ

ä¸¦ä¸”å·²ç¶“åˆå§‹åŒ–äº†æˆ‘å€‘çš„SpringMVC

æˆ‘å€‘å†æ¸¬è©¦ä¸€ä¸‹æˆ‘å€‘çš„UserController
localhost:8080/home
---------------
å¯ä»¥çœ‹åˆ°æˆ‘å€‘å…§ç½®æˆåŠŸï¼Œè€ŒSpringBootæ˜¯é€™æ¨£åšçš„å—ï¼Ÿé€™è£¡å¯ä»¥èªªæ˜SpringBootä¸æ˜¯é€™æ¨£åšçš„ï¼Œæˆ‘å€‘å…ˆçœ‹åˆ°Testé¡çš„ Context context = tom.addWebapp("/", filePath); é€™æ®µä»£ç¢¼ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘åŸ·è¡Œäº†addWebappï¼Œå°±æ˜¯èªªæˆ‘å€‘å°‡é€™å€‹é …ç›®ç•¶æˆç‚ºäº†webé …ç›®ï¼Œé‚£éº¼ä»€éº¼æ˜¯webé …ç›®ï¼Ÿå€‹äººèªç‚ºwebé …ç›®å’Œæ™®é€šé …ç›®å€åˆ¥å°±æ˜¯æœ‰ä¸€å€‹åŒ…è·¯å¾‘å«webappï¼Œå› æ­¤å¦‚æœæˆ‘å€‘åŸ·è¡ŒaddWebappï¼Œé‚£éº¼tomcatå°±æœƒèªç‚ºæˆ‘å€‘çš„é …ç›®æ˜¯webé …ç›®ï¼Œæ–¼æ˜¯ä»–å°±æœƒå»åšå¾ˆå¤šå¾ˆå¤šçš„äº‹æƒ…åŒ…æ‹¬æˆ‘å€‘çš„WebApplicationInitializerï¼Œæˆ‘å€‘æ¸¬è©¦ä¸€ä¸‹å¦‚æœæˆ‘å€‘å»æ‰addWebapp
public class Test {
	public static void main(String[] args) {
		Tomcat tom = new Tomcat();
		tom.setPort(8080);
		try {
			File file = new File(System.getProperty("java.io.tmpdir"));
			// ç²å–é …ç›®ç·¨è­¯å¾Œçš„classè·¯å¾‘
			String path = Test.class.getResource("/").getPath();

			// ç²å– webapp æ–‡ä»¶
			String filePath = new File("src/main/webapp").getAbsolutePath();

			// ç„¶å¾Œå°‡webappä¸‹çš„é …ç›®æ·»åŠ è‡³tomcatçš„contextå®¹å™¨(contextå°æ‡‰ä¸€å€‹é‹è¡Œçš„é …ç›®)
			// Context context = tom.addWebapp("/", filePath);	// åƒæ•¸1: ä¸€èˆ¬æ˜¯é …ç›®å å°æ‡‰è«‹æ±‚urlä¸­çš„é …ç›®å
			Context context = tom.addContext("/", filePath);

			// webResourceRoot ç”¨æ–¼åŠ è¼‰é …ç›®çš„classæ–‡ä»¶
			WebResourceRoot webResource = new StandardRoot(context);
			webResource.addPreResources(new DirResourceSet(webResource, "/WEB-INF/classes", path, "/"));
			// tomcatå•Ÿå‹•
			tom.start();
			// é˜»å¡ï¼Œç­‰å¾…å‰ç«¯é€£æ¥ tom.getServer().await();
			tom.getServer().await();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}

è®“æˆ‘å€‘å°‡é …ç›®æ”¹æˆContext context = tom.addContext("/", filePath);

æˆ‘å€‘çš„æ—¥èªŒå°±ä¸æœƒæ‰“å°WebApplicationInitializerï¼Œä¸¦ä¸”ä¹Ÿä¸æœƒé¡¯ç¤ºæ‰¾ä¸åˆ°web.xmlé€™æ¢æ—¥èªŒï¼Œä¹Ÿå°±æ˜¯èªªSpringBootçš„ç›®çš„å°±æ˜¯æƒ³è¦å®Œå…¨è„«é›¢å‚³çµ±çš„webå·¥ç¨‹çš„æ¨¡å¼ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼SpringBooté©åˆç”¨ä¾†åšå‰å¾Œç«¯åˆ†é›¢çš„åŸå› ã€‚å¥½äº†å›åˆ°æˆ‘å€‘çš„ä¸»é¡Œï¼Œé‚£éº¼æ—¢ç„¶ä¸èƒ½å›èª¿æˆ‘å€‘çš„WebApplicationInitializeræ–¹æ³•ï¼Œé‚£éº¼SpringBootåˆå¦‚ä½•å»å•Ÿå‹•æˆ‘å€‘çš„Springå‘¢ï¼Ÿé€™ä¹Ÿå¾ˆç°¡å–®ï¼Œæˆ‘å€‘ç›´æ¥å°‡Springæ”¾å…¥æˆ‘å€‘çš„Mainå‡½æ•¸è£¡å¦‚ä¸‹ï¼š
public class Test {
	public static void main(String[] args) {
		Tomcat tom = new Tomcat();
		tom.setPort(8080);
		try {
			File file = new File(System.getProperty("java.io.tmpdir"));
			// ç²å–é …ç›®ç·¨è­¯å¾Œçš„classè·¯å¾‘
			String path = Test.class.getResource("/").getPath();

			// ç²å–webappæ–‡ä»¶
			String filePath = new File("src/main/webapp").getAbsolutePath();

			// ç„¶å¾Œå°‡webappä¸‹çš„é …ç›®æ·»åŠ è‡³tomcatçš„contextå®¹å™¨(contextå°æ‡‰ä¸€å€‹é‹è¡Œçš„é …ç›®)
			// Context context = tom.addWebapp("/", filePath);	// åƒæ•¸1: ä¸€èˆ¬æ˜¯é …ç›®åï¼Œå°æ‡‰è«‹æ±‚urlä¸­çš„é …ç›®å
			Context context = tom.addContext("/", filePath);

			// webResourceRoot ç”¨æ–¼åŠ è¼‰é …ç›®çš„classæ–‡ä»¶
			WebResourceRoot webResource = new StandardRoot(context);
			webResource.addPreResources(new DirResourceSet(webResource, "/WEB-INF/classes", path, "/"));

			AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();
			ac.register(AppConfig.class);
			ac.refresh();

			// Create and register the DispatcherServlet
			DispatcherServlet servlet = new DispatcherServlet(ac);
			tom.addServlet(context, "SpringMVC", servlet);
			context.addServletMapping("/*", "SpringMVC");
			// tomcatå•Ÿå‹•
			tom.start();
			// é˜»å¡ï¼Œç­‰å¾…å‰ç«¯é€£æ¥ tom.getServer().await();
			tom.getServer().await();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
}

ç„¶å¾Œæ¸¬è©¦åŒæ¨£æœƒæœ‰é€™æ¨£çš„æ•ˆæœ
---------------
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆJavaMailSenderï¼‰interface
1. pom.xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
</dependency>

2. application.properties (é€™è£¡æ¨¡æ“¬ gmail ä¿¡ç®±çµ¦ yahoo ä¿¡ç®±ç™¼é€éƒµä»¶)
spring.mail.host=smtp.gmail.com

spring.mail.username=ä¿¡ç®±ç”¨æˆ¶å so****@gmail.com

spring.mail.password=ä¿¡ç®±å¯†ç¢¼

spring.mail.default-encoding=UTF-8

3. å¯«ç™¼é€ä¿¡ç®±çš„æ¸¬è©¦é¡
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/mail")
public class MailController {
	private final Logger logger = LoggerFactory.getLogger(this.getClass());

	@Autowired
	private JavaMailSender mailSender;

	@GetMapping("/send")
	public void sendMail() {
		SimpleMailMessage message = new SimpleMailMessage();
		message.setFrom("so****@gmail.com");
		message.setTo("239****@yahoo.com.tw");
		message.setSubject("it is a test for spring boot");
		message.setText("ä½ å¥½ï¼Œæˆ‘æ˜¯å°å½±ï¼Œæˆ‘æ­£åœ¨æ¸¬è©¦ç™¼é€éƒµä»¶ã€‚");

		try {
			mailSender.send(message);
			logger.info("å°å½±çš„æ¸¬è©¦éƒµä»¶å·²ç™¼é€ã€‚");
		} catch (Exception e) {
			logger.error("å°å½±ç™¼é€éƒµä»¶æ™‚ç™¼ç”Ÿç•°å¸¸äº†ï¼", e);
		}
	}
}

4. é‹è¡Œå•Ÿå‹•é¡
import org.mybatis.spring.annotation.MapperScan;

import org.springframework.boot.SpringApplication;

import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;

@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
@EnableAutoConfiguration
@MapperScan("com.example.demo.dao")
public class DemoApplication {
	public static void main(String[] args) {
		SpringApplication.run(DemoApplication.class, args);
	}
}

5. ç€è¦½å™¨é‹è¡Œ http://localhost:8080/mail/send

6. ç™»é™¸ gmail ä¿¡ç®±ï¼Œåœ¨ç™¼é€ç®±è£¡æŸ¥çœ‹

7. ç™»é™¸ yahoo ä¿¡ç®±ï¼Œåœ¨æ”¶ä»¶ç®±è£¡æŸ¥çœ‹

å¯ä»¥çœ‹å‡ºSpring Bootçš„starteræ¨¡å—æä¾›äº†è‡ªåŠ¨åŒ–é…ç½®ï¼Œåœ¨å¼•å…¥äº†spring-boot-starter-mailä¾èµ–ä¹‹åï¼Œä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å»åˆ›å»ºJavaMailSenderå®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ç›´æ¥@Autowiredæ¥å¼•å…¥ JavaMailSender é‚®ä»¶å‘é€å¯¹è±¡ã€‚ 

å½“ç„¶åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¦æ±‚å¸¦ä¸Šé™„ä»¶ã€æˆ–ä½¿ç”¨é‚®ä»¶æ¨¡å—ç­‰ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨MimeMessageæ¥è®¾ç½®æ›´å¤æ‚çš„ä¿¡ä»¶å†…å®¹ï¼Œä¸‹é¢å°±æ¥çœ‹çœ‹æ€ä¹ˆå®ç°å®ƒã€‚

ï¼ˆç™¼é€å¸¶é™„ä»¶çš„éƒµä»¶ï¼‰
1. æ¸¬è©¦é¡
import java.io.File;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.core.io.FileSystemResource;

import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/mail")
public class AttachmentsMailController {
	private final Logger logger = LoggerFactory.getLogger(this.getClass());

	@Autowired
	private JavaMailSender mailSender;

	@GetMapping("/att")
	public void sendMail() throws MessagingException {
		MimeMessage mimeMessage = mailSender.createMimeMessage();;
		MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true);

		helper.setFrom("so****@gmail.com");
		helper.setTo(239****@yahoo.com.tw");
		helper.setSubject("ä¸»é¡Œ: ç™¼é€æœ‰é™„ä»¶çš„ä¿¡ä»¶");
		helper.setText("ä½ å¥½ï¼Œæˆ‘æ˜¯å°å½±ï¼Œæˆ‘æ­£åœ¨æ¸¬è©¦ç™¼é€ä¸€å°æœ‰é™„ä»¶çš„ä¿¡ä»¶ã€‚");

		FileSystemResource file1 = new FileSystemResource(new File("d:\\cat.jpg"));
		FileSystemResource file2 = new FileSystemResource(New File("d:\\java-1.jpg"));

		helper.addAttachment("é™„ä»¶-1.jpg", file1);
		helper.addAttachment("é™„ä»¶-2.jpg", file2);

		try {
			mailSender.send(mimeMessage);
			logger.info("å°å½±çš„æ¸¬è©¦å¸¶é™„ä»¶ä¿¡ä»¶å·²ç™¼é€ã€‚");
		} catch (Exception e) {
			logger.error("å°å½±ç™¼é€å¸¶é™„ä»¶ä¿¡ä»¶æ™‚ç™¼ç”Ÿç•°å¸¸äº†ï¼", e);
		}
	}
}






è§£æ±º JavaMailSender ç™¼é€å¸¶é™„ä»¶çš„éƒµä»¶æ™‚ï¼Œç•¶é™„ä»¶åè¶…é•·æœƒè¢«æˆªæ–·çš„å•é¡Œï¼š		è§£æ±ºæ–¹æ³•ï¼šSystem.getProperties().setProperty("mail.mime.splitlongparameters", "false");
	/**
	 *  ç™¼é€åŒ…å«é™„ä»¶çš„éƒµä»¶
	 */
	@Override
	public void sendAttachmentMail(String[] toMails, String subject, String htmlAttachText) {
		System.getProperties().setProperty("mail.mime.splitlongparameters", "false");
		MimeMessage mimeMessage = javaMailSender.createMimeMessage();
		try {
			// multipart æ¨¡å¼
			MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMessage, true, "utf-8");
			setMailInfo(toMails, subject, htmlAttachText, mimeMessageHelper);
			// è¨­ç½®é™„ä»¶
			FileSystemResource xlsx = new FileSystemResource(new File("D:/MailImage/è»Ÿä»¶é …ç›®éœ€æ±‚.xlsx"));
			mimeMessageHelper.addAttachment("è»Ÿä»¶é …ç›®éœ€æ±‚.xlsx", xlsx);
			// ç™¼é€éƒµä»¶
			javaMailSender.send(mimeMessage);
			log.info("^o^= éƒµä»¶å·²ç™¼é€");
		} catch (Exception e) {
			log.info("^o^= éƒµä»¶ç™¼é€å¤±æ•—{}: ", e);
		}
	}

2. éœ€è¦åœ¨ D ç›¤ä¸‹æº–å‚™å…©å¼µåœ–ç‰‡cat.jpg java-1.jpg

3. ç€è¦½å™¨é‹è¡Œ http://localhost:8080/mail/att

4. ç™»é™¸ gmail ä¿¡ç®±ï¼Œåœ¨ç™¼é€ç®±è£¡æŸ¥çœ‹

5. ç™»é™¸ yahoo ä¿¡ç®±ï¼Œåœ¨æ”¶ä»¶ç®±è£¡æŸ¥çœ‹

ï¼ˆåµŒå…¥éœæ…‹è³‡æºçš„ä¿¡ä»¶ï¼‰
é‚„æœ‰ä¸€ç¨®æ˜¯é€šéåµŒå…¥åœ–ç‰‡ç­‰éœæ…‹è³‡æºï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°åœ–ç‰‡ï¼Œè€Œä¸ç”¨å¾é™„ä»¶ä¸­æŸ¥çœ‹å…·é«”çš„åœ–ç‰‡ã€‚
1. æ¸¬è©¦é¡ï¼š
import java.io.File;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.core.io.FileSystemResource;

import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/mail")
public class StaticResourceMailController {
	private final Logger logger = LoggerFactory.getLogger(this.getClass());

	@Autowired
	private JavaMailSender mailSender;

	@GetMapping("/static")
	public void sendMail() throws MessagingException {
		MimeMessage mimeMessage = mailSender.createMimeMessage();
		MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true);

		helper.setFrom("so****@gmail.com");
		helper.setTo(239****@yahoo.com.tw");
		helper.setSubject("ä¸»é¡Œ: åµŒå…¥éœæ…‹è³‡æº");
		helper.setText("<html><body><img src=\"cid:hello\"></body></html>", true);

		// æ³¨æ„ addInline() ä¸­è³‡æºåç¨± hello å¿…é ˆèˆ‡ text æ­£æ–‡ä¸­ cid:hello å°æ‡‰èµ·ä¾†
		FileSystemResource file1 = new FileSystemResource(new File("d:\\cat.jpg"));
		helper.addInline("hello", file1);

		try {
			mailSender.send(mimeMessage);
			logger.info("å°å½±çš„æ¸¬è©¦åµŒå…¥éœæ…‹è³‡æºçš„ä¿¡ä»¶å·²ç™¼é€ã€‚");
		} catch (Exception e) {
			logger.error("å°å½±ç™¼é€åµŒå…¥éœæ…‹è³‡æºçš„ä¿¡ä»¶æ™‚ç™¼ç”Ÿç•°å¸¸äº†ï¼", e);
		}
	}
}

2. éœ€è¦åœ¨ D ç›¤ä¸‹æº–å‚™å…©å¼µåœ–ç‰‡cat.jpg

3. ç€è¦½å™¨é‹è¡Œ http://localhost:8080/mail/static

4. ç™»é™¸ gmail ä¿¡ç®±ï¼Œåœ¨ç™¼é€ç®±è£¡æŸ¥çœ‹

5. ç™»é™¸ yahoo ä¿¡ç®±ï¼Œåœ¨æ”¶ä»¶ç®±è£¡æŸ¥çœ‹
___________________________________________________________________________________________________________________________________________________________________________________________________________________
Spring æä¾›å° ThreadPoolExecutor å°è£çš„ç·šç¨‹æ±  ThreadPoolTaskExecutorï¼Œç›´æ¥ä½¿ç”¨è¨»è§£å•Ÿç”¨

å…ˆå‰µå»ºä¸€å€‹ç·šç¨‹æ± çš„é…ç½®ï¼Œè®“ Spring Boot åŠ è¼‰ï¼Œç”¨ä¾†å®šç¾©å¦‚ä½•å‰µå»ºä¸€å€‹ ThreadPoolTaskExecutorï¼Œè¦ä½¿ç”¨@Configurationã€@EnableAsyncã€‚
@Configuration
@EnableAsync
public class ExecutorConfig {
	private static final Logger logger = LoggerFactory.getLogger(ExecutorConfig.class);

	@Value("${async.executor.thread.core_pool_size}")
	private int corePoolSize;
	@Value("${async.executor.thread.max_pool_size}")
	private int maxPoolSize;
	@Value("${async.executor.thread.queue_capacity}")
	private int queueCapacity;
	@Value("${async.executor.thread.name.prefix}")
	private String namePrefix;

	@Bean(name = "asyncServiceExecutor")
	public Executor asyncServiceExecutor() {
		logger.info("start asyncServiceExecutor");
		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
		// é…ç½®æ ¸å¿ƒç·šç¨‹æ•¸
		executor.setCorePoolSize(corePoolSize);
		// é…ç½®æœ€å¤§ç·šç¨‹æ•¸
		executor.setMaxPoolSize(maxPoolSize);
		// é…ç½®éšŠåˆ—å¤§å°
		executor.setQueueCapacity(queueCapacity);
		// é…ç½®ç·šç¨‹æ± ä¸­çš„ç·šç¨‹çš„åç¨±å‰ç¼€
		executor.setThreadNamePrefix(namePrefix);

		// rejection-policy: ç•¶ pool å·²ç¶“é”åˆ° max size çš„æ™‚å€™ï¼Œå¦‚ä½•è™•ç†æ–°ä»»å‹™
		// CALLER_RUNS: ä¸åœ¨æ–°ç·šç¨‹ä¸­åŸ·è¡Œä»»å‹™ï¼Œè€Œæ˜¯ç”±èª¿ç”¨è€…æ‰€åœ¨çš„ç·šç¨‹ä¾†åŸ·è¡Œ
		executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
		// åŸ·è¡Œåˆå§‹åŒ–
		executor.initialize();
		return executor;
	}
}
@Value æ˜¯æˆ‘é…ç½®åœ¨ application.propertiesï¼Œå¯ä»¥åƒè€ƒé…ç½®ï¼Œè‡ªç”±å®šç¾©
async.executor.thread.core_pool_size = 5
async.executor.thread.max_pool_size = 5
async.executor.thread.queue_capacity = 99999
async.executor.thread.name.prefix = async-service-

å‰µä¸€å€‹ Service
å‰µä¸€å€‹ ServiceImpl

å°†Serviceå±‚çš„æœåŠ¡å¼‚æ­¥åŒ–(ç¢ºå®š?)ï¼Œåœ¨executeAsync()æ–¹æ³•ä¸Šå¢åŠ æ³¨è§£@Async("asyncServiceExecutor")ï¼ŒasyncServiceExecutoræ–¹æ³•æ˜¯å‰é¢ExecutorConfig.javaä¸­çš„æ–¹æ³•åï¼Œè¡¨æ˜executeAsyncæ–¹æ³•è¿›å…¥çš„çº¿ç¨‹æ± æ˜¯asyncServiceExecutoræ–¹æ³•åˆ›å»ºçš„
æ¥ä¸‹æ¥å°±æ˜¯åœ¨Controlleré‡Œæˆ–è€…æ˜¯å“ªé‡Œé€šè¿‡æ³¨è§£@Autowiredæ³¨å…¥è¿™ä¸ªService
@Autowired
private AsyncService asyncService;

@GetMapping("/async")
public void async() {
	asyncService.executeAsync();
}

é€šè¿‡ä»¥ä¸Šæ—¥å¿—å¯ä»¥å‘ç°ï¼Œ[async-service-]æ˜¯æœ‰å¤šä¸ªçº¿ç¨‹çš„ï¼Œæ˜¾ç„¶å·²ç»åœ¨æˆ‘ä»¬é…ç½®çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œäº†ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚ä¸­ï¼Œcontrollerçš„èµ·å§‹å’Œç»“æŸæ—¥å¿—éƒ½æ˜¯è¿ç»­æ‰“å°çš„ï¼Œè¡¨æ˜æ¯æ¬¡è¯·æ±‚éƒ½å¿«é€Ÿå“åº”äº†ï¼Œè€Œè€—æ—¶çš„æ“ä½œéƒ½ç•™ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å»å¼‚æ­¥æ‰§è¡Œï¼›

è™½ç„¶æˆ‘ä»¬å·²ç»ç”¨ä¸Šäº†çº¿ç¨‹æ± ï¼Œä½†æ˜¯è¿˜ä¸æ¸…æ¥šçº¿ç¨‹æ± å½“æ—¶çš„æƒ…å†µï¼Œæœ‰å¤šå°‘çº¿ç¨‹åœ¨æ‰§è¡Œï¼Œå¤šå°‘åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å‘¢ï¼Ÿè¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªThreadPoolTaskExecutorçš„å­ç±»ï¼Œåœ¨æ¯æ¬¡æäº¤çº¿ç¨‹çš„æ—¶å€™éƒ½ä¼šå°†å½“å‰çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶å†µæ‰“å°å‡ºæ¥

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.util.concurrent.ListenableFuture;

import java.util.concurrent.Callable;
import java.util.concurrent.Future;
import java.util.concurrent.ThreadPoolExecutor;

public class VisiableThreadPoolTaskExecutor extends ThreadPoolTaskExecutor {
	private static final Logger logger = LoggerFactory.getLogger(VisiableThreadPoolTaskExecutor.class);

	private void showThreadPoolInfo(String prefix) {
		ThreadPoolExecutor threadPoolExecutor = getThreadPoolExecutor();

		if (null == threadPoolExecutor) {
			return;
		}

		logger.info("{}, {}, taskCount [{}], completedTaskCount[{}], activeCount [{}], queueSize [{}]",
			this.getThreadNamePrefix(),
			prefix,
			threadPoolExecutor.getTaskCount(),
			threadPoolExecutor.getCompletedTaskCount(),
			threadPoolExecutor.getActiveCount(),
			threadPoolExecutor.getQueue().size());
	}

	@Override
	public void execute(Runnable task) {
		showThreadPoolInfo("1. do execute");
		super.execute(task);
	}

	@Override
	public void execute(Runnable task, long startTimeout) {
		showThreadPoolInfo("2. do execute");
		super.execute(task, startTimeout);
	}

	@Override
	public Future<?> submit(Runnable task) {
		showThreadPoolInfo("1. do submit");
		return super.submit(task);
	}

	@Override
	public <T> Future<T> submit(Callable<T> task) {
		showThreadPoolInfo("2. do submit");
		return super.submit(task);
	}

	@Override
	public ListenableFuture<?> submitListenable(Runnable task) {
		showThradPoolInfo("1. do submitListenable");
		return super.submitListenable(task);
	}

	@Override
	public <T> ListenableFuture<T> submitListenable(Callable<T> task) {
		showThreadPoolInfo("2. do submitListenable");
		return super.submitListenable(task);
	}
}
å¦‚ä¸Šæ‰€ç¤ºï¼ŒshowThreadPoolInfoæ–¹æ³•ä¸­å°†ä»»åŠ¡æ€»æ•°ã€å·²å®Œæˆæ•°ã€æ´»è·ƒçº¿ç¨‹æ•°ï¼Œé˜Ÿåˆ—å¤§å°éƒ½æ‰“å°å‡ºæ¥äº†ï¼Œç„¶åOverrideäº†çˆ¶ç±»çš„executeã€submitç­‰æ–¹æ³•ï¼Œåœ¨é‡Œé¢è°ƒç”¨showThreadPoolInfoæ–¹æ³•ï¼Œè¿™æ ·æ¯æ¬¡æœ‰ä»»åŠ¡è¢«æäº¤åˆ°çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†å½“å‰çº¿ç¨‹æ± çš„åŸºæœ¬æƒ…å†µæ‰“å°åˆ°æ—¥å¿—ä¸­ï¼›
ä¿®æ”¹ExecutorConfig.javaçš„asyncServiceExecutoræ–¹æ³•ï¼Œå°†ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor()æ”¹ä¸ºThreadPoolTaskExecutor executor = new VisiableThreadPoolTaskExecutor()
	@Bean(name = "asyncServiceExecutor")
	public Executor asyncServiceExecutor() {
		logger.info("start asyncServiceExecutor");

		ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
		// é…ç½®æ ¸å¿ƒç·šç¨‹æ•¸
		executor.setCorePoolSize(corePoolSize);
		// é…ç½®æœ€å¤§ç·šç¨‹æ•¸
		executor.setMaxPoolSize(maxPoolSize);
		// é…ç½®éšŠåˆ—å¤§å°
		executor.setQueueCapacity(queueCapacity);
		// é…ç½®ç·šç¨‹æ± ä¸­çš„ç·šç¨‹çš„åç¨±å‰ç¼€
		executor.setThreadNamePrefix(namePrefix);

		// rejection-policy: ç•¶ pool å·²ç¶“é”åˆ° max size çš„æ™‚å€™ï¼Œå¦‚ä½•è™•ç†æ–°ä»»å‹™
		// CALLER_RUNS: ä¸åœ¨æ–°ç·šç¨‹ä¸­åŸ·è¡Œä»»å‹™ï¼Œè€Œæ˜¯ç”±èª¿ç”¨è€…æ‰€åœ¨çš„ç·šç¨‹ä¾†åŸ·è¡Œ
		executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
		// åŸ·è¡Œåˆå§‹åŒ–
		executor.initialize();
		return executor;
	}
æ³¨æ„è¿™ä¸€è¡Œæ—¥å¿—ï¼š
2018-07-16 22:23:32.496  INFO 14088 --- [nio-8087-exec-7] u.d.e.e.i.VisiableThreadPoolTaskExecutor : async-service-, 2. do submit,taskCount [3], completedTaskCount [3], activeCount [0], queueSize [0]
è¿™è¯´æ˜æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œè°ƒç”¨çš„æ˜¯submit(Callable task)è¿™ä¸ªæ–¹æ³•ï¼Œå½“å‰å·²ç»æäº¤äº†3ä¸ªä»»åŠ¡ï¼Œå®Œæˆäº†3ä¸ªï¼Œå½“å‰æœ‰0ä¸ªçº¿ç¨‹åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿˜å‰©0ä¸ªä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œçº¿ç¨‹æ± çš„åŸºæœ¬æƒ…å†µä¸€è·¯äº†ç„¶ï¼›
___________________________________________________________________________________________________________________________________________________________________________________________________________________
æˆ‘ä»¬å¸¸ç”¨ThreadPoolExecutoræä¾›çš„çº¿ç¨‹æ± æœåŠ¡ï¼Œspringbootæ¡†æ¶æä¾›äº†@Asyncæ³¨è§£ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿çš„å°†ä¸šåŠ¡é€»è¾‘æäº¤åˆ°çº¿ç¨‹æ± ä¸­å¼‚æ­¥æ‰§è¡Œï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å®æˆ˜ä½“éªŒè¿™ä¸ªçº¿ç¨‹æ± æœåŠ¡ï¼›
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆWebMvcConfigurerAdapter å¸¸ç”¨æ–¹æ³•(deprecated)ï¼‰
public abstract class WebMvcConfigurerAdapter implements WebMvcConfigurer {
/** é…ç½®è·¯å¾‘åŒ¹é…åƒæ•¸ **/
public void configurePathMatch(PathMatchConfigurer configurer) {}


/** é…ç½®è·¯å¾‘åŒ¹é…åƒæ•¸ **/
public void configureAsyncSupport(AsyncSupportConfigurer configurer) {}


/** è¨»å†Šåƒæ•¸è½‰æ›å’Œæ ¼å¼åŒ–å™¨ **/
public void addFormatters(FormatterRegistry registry) {}


/** cors è·¨åŸŸè¨ªå• **/
public void addCorsMappings(CorsRegistry registry) {}


/** æ·»åŠ æ””æˆªå™¨ **/
public void addInterceptors(InterceptorRegistry registry) {}


/** é…ç½®è¦–åœ–è§£æå™¨ **/
public void configureViewResolvers(ViewResolverRegistry registry) {}


/** è¨»å†Šè‡ªå®šç¾©æ§åˆ¶å™¨æ–¹æ³•åƒæ•¸é¡å‹ **/
public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {}


/** è¨»å†Šè‡ªå®šç¾©æ§åˆ¶å™¨æ–¹æ³•è¿”å›é¡å‹ **/
public void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> returnValueHandlers) {}


/** é‡è¼‰æœƒè¦†è“‹æ‰ spring mvc é»˜èªè¨»å†Šçš„å¤šå€‹HttpMessageConverter **/
public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {}


/** åƒ…æ·»åŠ ä¸€å€‹è‡ªå®šç¾©çš„ HttpMessageConvertersï¼Œä¸è¦†è“‹é»˜èªè¨»å†Šçš„ HttpMessageConverter **/
public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {}


/** è¨»å†Šç•°å¸¸è™•ç† **/
public void configureHandlerExceptionResolvers(List<HandlerExceptionResolver> exceptionResolvers) {}


/** å¤šå€‹ç•°å¸¸è™•ç†ï¼Œå¯ä»¥é‡å¯«æ¬¡æ–¹æ³•æŒ‡å®šè™•ç†é †åºç­‰ **/
public void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> exceptionResolvers) {}


/** é…ç½® Web Service æˆ– REST API è¨­è¨ˆä¸­å…§å®¹è£æ±ºçš„ä¸€äº›é¸é …ï¼Œå³æ ¹æ“šå®¢æˆ¶ç«¯çš„æ”¯æŒå…§å®¹æ ¼å¼æƒ…æ³ä¾†å°è£éŸ¿æ‡‰æ¶ˆæ¯é«”ï¼Œå¦‚xml, json **/
public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {}


/** è¦–åœ–è·³è½‰æ§åˆ¶å™¨(é…ç½®é é¢ç›´æ¥è¨ªå•ï¼Œä¸èµ°æ¥å£) **/
public void addViewControllers(ViewControllerRegistry registry) {}


/** è‡ªå®šç¾©éœæ…‹è³‡æºæ˜ å°„ **/
public void addResourceHandlers(ResourceHandlerRegistry registry) {}


/** é»˜èªéœæ…‹è³‡æºè™•ç†å™¨ï¼Œä½¿å¾— springmvc åœ¨æ¥å£å±¤æ”¯æŒç•°æ­¥ **/
public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {}


1. addInterceptors: æ””æˆªå™¨
addInterceptor: éœ€è¦ä¸€å€‹å¯¦ç¾ HandlerInterceptor æ¥å£çš„æ””æˆªå™¨å¯¦ä¾‹
addPathPatterns: ç”¨æ–¼è¨­ç½®æ””æˆªå™¨çš„éæ¿¾è·¯å¾‘è¦å‰‡
excludePathPatterns: ç”¨æ–¼è¨­ç½®ä¸éœ€è¦æ””æˆªçš„éæ¿¾è¦å‰‡
@Override
public void addInterceptors(InterceptorRegistry registry) {
	registry.addInterceptor(new MyInterceptor()).addPathPatterns("/**").excludePathPatterns("/toLogin", "/login");
	super.addInterceptors(registry);
}

2. addCorsMappings: è·¨åŸŸ
@Override
public void addCorsMappings(CorsRegistry registry) {
	registry.addMapping("/**").allowedOrigins("*").allowedMethods("POST", "GET", "PUT", "OPTIONS", "DELETE").maxAge(3600).allowCredentials(true);
}

3. addViewControllers: è·³è½‰æŒ‡å®šé é¢
/**
 *  ä»¥å‰è¦è¨ªå•ä¸€å€‹é é¢éœ€è¦å…ˆå‰µå»º Controller æ§åˆ¶é¡ï¼Œå†å¯«æ–¹æ³•è·³è½‰åˆ°é é¢
 *  åœ¨é€™è£¡é…ç½®å¾Œå°±ä¸éœ€è¦é‚£éº¼éº»ç…©äº†ï¼Œç›´æ¥è¨ªå• http://localhost:8080/toLogin å°±è·³è½‰åˆ° login.html é é¢äº†
 */
@Override
public void addViewControllers(ViewControllerRegistry registry) {
	registry.addViewController("/toLogin").setViewName("login");
	registry.addViewController("/").setViewName("/index");
	registry.addViewController("/login").setViewName("forward:/index.html");
	super.addViewControllers(registry);
}

4. resourceViewResolver: è¦–åœ–è§£æå™¨
/**
 *  é…ç½®è«‹æ±‚è¦–åœ–æ˜ å°„
 */
@Bean
public InternalResouceViewResolver resourceViewResolver() {
	InternalResourceViewResolver internalResourceViewResolver = new InternalResourceViewResolver();
	// è«‹æ±‚è¦–åœ–æ–‡ä»¶çš„å‰ç¼€åœ°å€
	internalResourceViewResolver.setPrefix("/WEB-INF/jsp/");
	// è«‹æ±‚è¦–åœ–æ–‡ä»¶å¾Œç¼€
	internalResourceViewResolver.setSuffix(".jsp");
	return internalResouceViewResolver;
}

/**
 *  è¦–åœ–é…ç½®
 */
@Override
public void ConfigureViewResolvers(ViewResolverRegistry registry) {
	super.configureViewResolvers(registry);
	registry.viewResolver(resourceViewResolver());
	// registry.jsp("/WEB-INF/jsp/",".jsp");
}

5. configureMessageConverters: ä¿¡æ¯è½‰æ›å™¨
/**
 *  æ¶ˆæ¯å…§å®¹è½‰æ›é…ç½®
 *  é…ç½® fastJson è¿”å› json è½‰æ›
 */
@Override
public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
	// èª¿ç”¨çˆ¶é¡çš„é…ç½®
	super.configureMessageConverters(converters);
	// å‰µå»º fastJson æ¶ˆæ¯è½‰æ›å™¨
	FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();
	// å‰µå»ºé…ç½®é¡
	FastJsonConfig fastJsonConfig = new FastJsonConfig();
	// ä¿®æ”¹é…ç½®è¿”å›å…§å®¹çš„éæ¿¾
	fastJsonConfig.setSerializerFeatures(
		SerializerFeature.DisableCircularReferenceDetect,
		SerializerFeature.WriteMapNullValue,
		SerializerFeature.WriteNullStringAsEmpty
	);
	fastConverter.setFastJsonConfig(fastJsonConfig):
	// å°‡ fastJson æ·»åŠ åˆ°è¦–åœ–æ¶ˆæ¯è½‰æ›å™¨åˆ—è¡¨å…§
	converters.add(fastConverter);
}

6. addResourceHandlers: éœæ…‹è³‡æº
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
	// è‡ªå®šç¾©é …ç›®å…§ç›®éŒ„
	// registry.addResourceHandler("/my/**").addResourceLocations("classpath:/my/");
	// æŒ‡å‘å¤–éƒ¨ç›®éŒ„
	registry.addResourceHandler("/my/**").addResourceLocations("file:E:/my/");
	super.addResourceHandlers(registry);
}

ä½¿ç”¨ WebMvcConfigurerAdapter		// å° WebMvcConfigurer çš„ç©ºå¯¦ç¾

1. éæ™‚æ–¹å¼: ç¹¼æ‰¿ WebMvcConfigurerAdapter	// spring boot 2.0, spring 5.0 @Deprecated

2. ä»£æ›¿æ–¹æ¡ˆ
ç›´æ¥å¯¦ç¾ WebMvcConfigurer
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
	// TODO
}
ç›´æ¥ç¹¼æ‰¿ WebMvcConfigurationSupport
@Configuration
public class WebMvcConfig extends WebMvcConfigurationSupport {
	// TODO
}

WebMvcConfigurationSupportã€WebMvcConfigurerAdapterã€æ¥å£WebMvcConfigurerè™•æ–¼åŒä¸€å€‹ç›®éŒ„ä¸‹
WebMvcConfigurationSupportåŒ…å«WebMvcConfigurerè£¡é¢çš„æ–¹æ³•ï¼Œä¸”WebMvcConfigurationSupportçš„å¯¦ç¾çš„æ–¹æ³•æ›´å…¨é¢
ä½†æ˜¯ç¹¼æ‰¿WebMvcConfigurationSupportæœƒç™¼ç¾Spring Bootçš„WebMvcè‡ªå‹•é…ç½®å¤±æ•ˆ(WebMvcAutoConfiguration)ï¼Œå°è‡´è¦–åœ–è§£æå™¨ç„¡æ³•è§£æä¸¦è¿”å›åˆ°å°æ‡‰çš„è¦–åœ–ã€‚

WebMvcConfigurer èˆ‡ WebMvcConfigurationSupportï¼š
çœ‹ WebMvcAutoConfiguration çš„å®šç¾©ï¼š
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)	// åªæœ‰ç•¶ WebMvcConfigurationSupport.class ä¸å­˜åœ¨çš„æ™‚å€™æ‰æœƒç”Ÿæ•ˆWebMvcAutoConfigurationï¼ŒWebMvcAutoConfiguration ä¸åƒ…å®šç¾©äº†
							// classpath:/META-INFO/resources/ã€classpath:/resources/ã€classpath:/static/ã€classpath:/public/ç­‰è·¯å¾‘çš„æ˜ å°„ï¼Œé‚„å®šç¾©äº†é…ç½®æ–‡ä»¶ spring.mvc é–‹é ­çš„é…ç½®ä¿¡æ¯ç­‰ã€‚
ç•¶ WebMvcAutoConfiguration ä¸ç”Ÿæ•ˆæ™‚æœƒå°è‡´ä»¥ä¸‹å¹¾å€‹å•é¡Œï¼š
1. WebMvcPropertiesã€ResourceProperties å¤±æ•ˆ			// æœƒå°è‡´è¦–åœ–è§£æå™¨ç„¡æ³•è§£æä¸¦è¿”å›åˆ°å°æ‡‰çš„è¦–åœ–
å› ç‚ºé€™å…©å€‹é…ç½®é¡ä¸­çš„å±¬æ€§éƒ½åœ¨ WebMvcAutoConfiguration ä¸­ä½¿ç”¨
è§£æ±ºæ–¹æ¡ˆï¼š
1.1. åœ¨ Spring Boot 1.X çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ç¹¼æ‰¿è‡ª WebMvcConfigurerAdapterï¼Œè¦†è“‹æƒ³è¦å¯¦ç¾çš„æ–¹æ³•å³å¯ã€‚
1.2. ä½†æ˜¯åœ¨ Spring Boot 2.X çš„å®šç¾©ä¸­ï¼ŒWebMvcConfigurerAdapter å·²ç¶“è¢«å®šç¾©ç‚º @Deprecatedï¼Œçœ‹å€‹æºç¢¼ï¼š
/**
 *  An implementation of {@link WebMvcConfigurer} with empty methods allowing subclasses to override only the methods they're interested in.
 *  @deprecated as of 5.0 {@link WebMvcConfigurer} has default methods (made possible by a Java 8 baseline)
 *  and can be implemented directly without the need for this adapter
 */
@Deprecated
public abstract class WebMvcConfigurerAdapter implements WebMvcConfigurer {

2. é¡è·¯å¾‘ä¸Šçš„ HttpMessageConverter å¤±æ•ˆ
å¦‚: StringHttpMessageConverterConfigurationã€MappingJackson2HttpMessageConverterï¼Œå› ç‚º HttpMessageConverters ä¸­æŒæœ‰è‘—æ‰€æœ‰ HttpMessageConverter çš„å¯¦ä¾‹ï¼Œåœ¨ WebMvcAutoConfigurationAdapter ä¸­
æœƒæ³¨å…¥ HttpMessageConvertersï¼Œå› æ­¤ç•¶ WebMvcAutoConfigurationAdapter ä¸åŠ è¼‰æ™‚ï¼Œå‰‡æœƒå¤±æ•ˆï¼Œé–“æ¥é€ æˆ spring.http.encoding.charset èˆ‡ spring.jackson.data-format å‡è±¡çš„å¤±æ•ˆã€‚
å¦‚: StringHttpMessageConverter æœƒä½¿ç”¨ spring.http.encoding.charset é…ç½®ï¼Œé»˜èªç·¨ç¢¼ç‚º: ISO-8859-1
@Bean
	@ConditionalOnMissingBean
	public StringHttpMessageConverter stringHttpMessageConverter() {
		StringHttpMessageConverter converter = new StringHttpMessageConverter(
			this.encodingProperties.getCharset());
		converter.setWriteAcceptCharset(false);
		return converter;
	}
è§£æ±ºæ–¹æ¡ˆï¼š
å› ç‚ºå·²çŸ¥çš„é…ç½®é¡éƒ½å·²é€šé @Bean è¨»å†Šåœ¨å®¹å™¨ä¸­ï¼Œé‚£éº¼æˆ‘å€‘å¯ä»¥åœ¨ä½¿ç”¨ WebMvcConfigurationSupport æ™‚ï¼Œé€šé @Autowired æ³¨å…¥åˆ°é…ç½®é¡ä¸­ï¼Œç„¶å¾Œæ›¿æ›æ‰ WebMvcConfigurationSupport é»˜èªçš„é…ç½®å³å¯ï¼š
@Configuration
public class WebConfiguration extends WebMvcConfigurationSupport {
	@Autowired
	private StringHttpMessageConverter stringHttpMessageConverter;
	@Autowired
	private MappingJackson2HttpMessageConverter httpMessageConverter;
	/**
	 *  æ·»åŠ è½‰æ›å™¨
	 */
	@Override
	public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
		for (int i = 0; i<converters.size(); i++) {
			if (converters.get(i) instanceof StringHttpMessageConverter) {
				converters.set(i, stringHttpMessageConverter);
			}
			if (converters.get(i) instanceof MappingJackson2HttpMessageConverter) {
				converters.set(i, httpMessageConverter);
			}
		}
	}
}
ä¹Ÿå¯ä»¥æ ¹æ“šéœ€æ±‚ä¾†é‡æ–°å¯¦ç¾ã€‚

è£œå……ï¼š
WebMvcConfigurer é¡ä»£ç¢¼åˆ†æ:
å¾ EnableWebMvcConfiguration é…ç½®é¡é–‹å§‹ï¼Œç•¶å®ƒæ³¨å…¥æ™‚çˆ¶é¡æœƒæ³¨å…¥ Spring å®¹å™¨ä¸­æ‰€æœ‰çš„ WebMvcConfigurer é¡
@Configuration
public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {
	private final WebMvcConfigurerComposite configurers = new WebMvcConfigurerComposite();

	@Autowired(required = false)
	public void setConfigurers(List<WebMvcConfigurer> configurers) {
		if (!CollectionUtils.isEmpty(configurers)) {
			this.configurers.addWebMvcConfigurers(configurers);
		}
	}
æ¥è‘—æ³¨å…¥ RequestMappingHandlerAdpater Bean å®ƒæœƒèª¿ç”¨çˆ¶é¡çš„ requestMappingHandlerAdapter æ–¹æ³•
@Bean
@Override
public RequestMappingHandlerAdapter requestMappingHandlerAdapter() {
	RequestMappingHandlerAdapter adapter = super.requestMappingHandlerAdapter();
	adapter.setIgnoreDefaultModelOnRedirect(this.mvcProperties == null ? true : this.mvcProperties.isIgnoreDefaultModelOnRedirect());
	return adapter;
}
@Bean
public RequestMappingHandlerAdapter requestMappingHandlerAdapter() {
	adapter.setContentNegotiationManager(mvcContentNegotiationManager());
	adapter.setMessageConverters(getMessageConverters());
	adapter.setWebBindingInitializere(getConfigurableWebBindingInitializer());
	adapter.setCustomArgumentResolvers(getArgumentResolvers());
	adapter.setCustomReturnValueHandlers(getReturnValueHandlers());

	if (jackson2Present) {
		adapter.setRequestBodyAdvice(
			Collections.<~>singletonList(new JsonViewRequestBodyAdvice()));
		adapter.setResponseBodyAdvice(
			Collections.<~>singletonList(new JsonViewResponseBodyAdvice()));
	}

	AsyncSupportConfigurer configurer = new AsyncSupportConfigurer();
	configureAsyncSupport(configurer);
	if (configurer.getTaskExecutor() != null) {
		adapter.setTaskExecutor(configurer.getTaskExecutor());
	}
	if (configurer.getTimeout() != null) {
		adapter.setAsyncRequestTimeout(configurer.getTimeout());
	}
	adapter.setCallableInterceptors(configurer.getCallableInterceptors());
	adapter.setDeferredResultInterceptors(configurer.getDeferredResultInterceptors());

	return adapter;
}
é€™å€‹æ™‚å€™ç²å–é…ç½®ï¼Œä¾‹å¦‚è‡ªå®šç¾©äº†è¿”å›çµæœ Handlerï¼ŒWebMvcConfigurerComposite æœƒéæ­·èª¿ç”¨ WebMvcConfigurer å¯¦ç¾é¡çš„ addReturnValueHandlers æ–¹æ³•ï¼ŒæœƒæŠŠè‡ªå®šç¾©é…ç½®åŠ è¼‰åˆ°é»˜èªçš„é…ç½®ä¸­
@Override
public void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> returnValueHandlers) {
	for (WebMvcConfigurer delegate : this.delegates) {
		delegate.addReturnValueHandlers(returnValueHandlers);
	}
}
@Override
public void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> returnValueHandlers) {
	returnValueHandlers.add(new DataPermissionMethodArgumentResolver());
}
___________________________________________________________________________________________________________________________________________________________________________________________________________________
org.springframework.web.servlet
Handler
HandlerAdapter
HandleExceptionResolver
HandleFilterFunction
HandleFunction
HandleInterceptor
HandleMapping
HandleMethodMappingNamingStrategy

___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆ@AliasForï¼‰
___________________________________________________________________________________________________________________________________________________________________________________________________________________
æ‰“åŒ…æ™‚ä½¿ç”¨äº† FatJar æŠ€è¡“å°‡æ‰€æœ‰çš„ä¾è³´ jar åŒ…ä¸€èµ·æ”¾é€²æœ€çµ‚çš„ jar åŒ…ä¸­çš„ BOOT-INF/libç›®éŒ„ä¸­ï¼Œç•¶å‰é …ç›®çš„ class çµ±ä¸€æ”¾åˆ° BOOT-INF/classes ç›®éŒ„ä¸­ã€‚
ä¸åŒæ–¼ maven shade æ’ä»¶ï¼Œå°‡æ‰€æœ‰çš„ä¾è³´ jar åŒ…ä¸­çš„ class æ–‡ä»¶è§£åŒ…å‡ºä¾†å¾Œå†å¯†å¯†éº»éº»åœ°å¡é€²çµ±ä¸€çš„ jar åŒ…ä¸­ã€‚
ä¸‹é¢æˆ‘å€‘å°‡ springboot æ‰“åŒ…çš„ jar åŒ…è§£å£“å‡ºä¾†çœ‹ç›®éŒ„çµæ§‹ï¼š

â”œâ”€â”€ BOOT-INF
â”‚   â”œâ”€â”€ classes
â”‚   â”‚   â””â”€â”€ hello
â”‚   â””â”€â”€ lib
â”‚       â”œâ”€â”€ classmate-1.3.4.jar
â”‚       â”œâ”€â”€ hibernate-validator-6.0.12.Final.jar
â”‚       â”œâ”€â”€ jackson-annotations-2.9.0.jar
â”‚       â”œâ”€â”€ jackson-core-2.9.6.jar
â”‚       â”œâ”€â”€ jackson-databind-2.9.6.jar
â”‚       â”œâ”€â”€ jackson-datatype-jdk8-2.9.6.jar
â”‚       â”œâ”€â”€ jackson-datatype-jsr310-2.9.6.jar
â”‚       â”œâ”€â”€ jackson-module-parameter-names-2.9.6.jar
â”‚       â”œâ”€â”€ javax.annotation-api-1.3.2.jar
â”‚       â”œâ”€â”€ jboss-logging-3.3.2.Final.jar
â”‚       â”œâ”€â”€ jul-to-slf4j-1.7.25.jar
â”‚       â”œâ”€â”€ log4j-api-2.10.0.jar
â”‚       â”œâ”€â”€ log4j-to-slf4j-2.10.0.jar
â”‚       â”œâ”€â”€ logback-classic-1.2.3.jar
â”‚       â”œâ”€â”€ logback-core-1.2.3.jar
â”‚       â”œâ”€â”€ slf4j-api-1.7.25.jar
â”‚       â”œâ”€â”€ snakeyaml-1.19.jar
â”‚       â”œâ”€â”€ spring-aop-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-beans-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-autoconfigure-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-starter-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-starter-json-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-starter-logging-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-starter-tomcat-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-boot-starter-web-2.0.5.RELEASE.jar
â”‚       â”œâ”€â”€ spring-context-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-core-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-expression-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-jcl-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-web-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ spring-webmvc-5.0.9.RELEASE.jar
â”‚       â”œâ”€â”€ tomcat-embed-core-8.5.34.jar
â”‚       â”œâ”€â”€ tomcat-embed-el-8.5.34.jar
â”‚       â”œâ”€â”€ tomcat-embed-websocket-8.5.34.jar
â”‚       â””â”€â”€ validation-api-2.0.1.Final.jar
â”œâ”€â”€ META-INF
â”‚   â”œâ”€â”€ MANIFEST.MF
â”‚   â””â”€â”€ maven
â”‚       â””â”€â”€ org.springframework
â””â”€â”€ org
    â””â”€â”€ springframework
        â””â”€â”€ boot
ä½¿ç”¨ FatJar æŠ€è¡“é‹è¡Œéœ€è¦å° jar åŒ…é€²è¡Œæ”¹é€ ï¼Œé‚„éœ€è¦è‡ªå®šç¾©è‡ªå·±çš„ ClassLoader ä¾†åŠ è¼‰ jar åŒ…è£¡é¢ lib ç›®éŒ„ä¸­åµŒå¥—çš„ jar åŒ…ä¸­çš„é¡ã€‚
å¯ä»¥å°æ¯”å…©è€…çš„æ–‡ä»¶ï¼š
MANIFESTï¼š
// Generated by Maven Shade Plugin
Manifest-Version: 1.0
Implementation-Title: gs-spring-boot
Implementation-Version: 0.1.0
Built-By: qianwp
Implementation-Vendor-Id: org.springframework
Created-By: Apache Maven 3.5.4
Build-Jdk: 1.8.0_191
Implementation-URL: https://projects.spring.io/spring-boot/#/spring-bo
 ot-starter-parent/gs-spring-boot
Main-Class: hello.Application

// Generated by SpringBootLoader Plugin
Manifest-Version: 1.0
Implementation-Title: gs-spring-boot
Implementation-Version: 0.1.0
Built-By: qianwp
Implementation-Vendor-Id: org.springframework
Spring-Boot-Version: 2.0.5.RELEASE
Main-Class: org.springframework.boot.loader.JarLauncher
Start-Class: hello.Application
Spring-Boot-Classes: BOOT-INF/classes/
Spring-Boot-Lib: BOOT-INF/lib/
Created-By: Apache Maven 3.5.4
Build-Jdk: 1.8.0_191
Implementation-URL: https://projects.spring.io/spring-boot/#/spring-bo
 ot-starter-parent/gs-spring-boot

SpringBoot å°‡ Main-Class æ›æˆäº† JarLauncherã€‚é‚„å¢åŠ äº† Start-Class åƒæ•¸ï¼Œæ­¤åƒæ•¸å°æ‡‰çš„é¡æ‰æ˜¯çœŸæ­£çš„æ¥­å‹™ main æ–¹æ³•å…¥å£ã€‚

public class JarLauncher{
    ...
  static void main(String[] args) {
    new JarLauncher().launch(args);
  }

  protected void launch(String[] args) {
    try {
      JarFile.registerUrlProtocolHandler();
      ClassLoader cl = createClassLoader(getClassPathArchives());
      launch(args, getMainClass(), cl);
    }
    catch (Exception ex) {
        ex.printStackTrace();
        System.exit(1);
    }
  }

  protected void launch(String[] args, String mcls, ClassLoader cl) {
        Runnable runner = createMainMethodRunner(mcls, args, cl);
        Thread runnerThread = new Thread(runner);
        runnerThread.setContextClassLoader(classLoader);
        runnerThread.setName(Thread.currentThread().getName());
        runnerThread.start();
  }

}

class MainMethodRunner {
  @Override
  public void run() {
    try {
      Thread th = Thread.currentThread();
      ClassLoader cl = th.getContextClassLoader();
      Class<?> mc = cl.loadClass(this.mainClassName);
      Method mm = mc.getDeclaredMethod("main", String[].class);
      if (mm == null) {
        throw new IllegalStateException(this.mainClassName
                        + " does not have a main method");
      }
      mm.invoke(null, new Object[] { this.args });
    } catch (Exception ex) {
      ex.printStackTrace();
      System.exit(1);
    }
  }
}
å»ºç«‹äº†ä¸€å€‹ç‰¹æ®Šçš„ ClassLoaderï¼Œç”±å®ƒä¾†å¦å•Ÿä¸€å€‹å–®ç¨çš„ç·šç¨‹ä¾†åŠ è¼‰ MainClass ä¸¦é‹è¡Œã€‚

JVM æ˜¯å¦‚ä½•çŸ¥é“å»å“ªå€‹ jar åŒ…è£¡åŠ è¼‰å‘¢ï¼Ÿ
class LaunchedURLClassLoader extends URLClassLoader {
  ...
  private Class<?> doLoadClass(String name) {
    if (this.rootClassLoader != null) {
      return this.rootClassLoader.loadClass(name);
    }

    findPackage(name);
    Class<?> cls = findClass(name);
    return cls;
  }

}
é€™çš„ rootClassLoader å°±æ˜¯é›™è¦ªå§”æ´¾æ¨¡å‹(ç”±ä¸‹è€Œä¸Šè©¢å•ï¼Œå·²å­˜åœ¨å‰‡ä¸ç”Ÿæˆé¡ã€‚æœ€å¾Œç”±ä¸Šè€Œä¸‹è©¢å•æ˜¯å¦å¯ä»¥åŠ è¼‰)è£¡çš„ ExtensionClassLoaderï¼ŒJVM å…§ç½®çš„é¡æœƒå„ªå…ˆä½¿ç”¨å®ƒä¾†åŠ è¼‰ã€‚å¦‚ä¸æ˜¯å…§ç½®çš„å°±å»æŸ¥æ‰¾å°æ‡‰çš„ Packageã€‚
private void findPackage(final String name) {
    int lastDot = name.lastIndexOf('.');
    if (lastDot != -1) {
        String packageName = name.substring(0, lastDot);
        if (getPackage(packageName) == null) {
            try {
                definePackage(name, packageName);
            } catch (Exception ex) {
                // Swallow and continue
            }
        }
    }
}

private final HashMap<String, Package> packages = new HashMap<>();

protected Package getPackage(String name) {
    Package pkg;
    synchronized (packages) {
        pkg = packages.get(name);
    }
    if (pkg == null) {
        if (parent != null) {
            pkg = parent.getPackage(name);
        } else {
            pkg = Package.getSystemPackage(name);
        }
        if (pkg != null) {
            synchronized (packages) {
                Package pkg2 = packages.get(name);
                if (pkg2 == null) {
                    packages.put(name, pkg);
                } else {
                    pkg = pkg2;
                }
            }
        }
    }
    return pkg;
}

private void definePackage(String name, String packageName) {
  String path = name.replace('.', '/').concat(".class");
  for (URL url : getURLs()) {
    try {
      if (url.getContent() instanceof JarFile) {
        JarFile jf= (JarFile) url.getContent();
        if (jf.getJarEntryData(path) != null && jf.getManifest() != null) {
          definePackage(packageName, jf.getManifest(), url);
          return null;
        }
      }
    } catch (IOException ex) {
        // Ignore
    }
  }
  return null;
}
ClassLoader æœƒåœ¨æœ¬åœ°ç·©å­˜ åŒ…åå’ŒjaråŒ…è·¯å¾‘ çš„æ˜ å°„é—œä¿‚(åºåˆ—åŒ–ä¹‹æ‹·è²ï¼Ÿ)ï¼Œå¦‚æœç·©å­˜æ‰¾ä¸åˆ°ï¼Œå°±å¿…é ˆå» jar åŒ…ä¸­æœå°‹ã€‚ä¸éåŒä¸€å€‹åŒ…ååªæœƒæœå°‹ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡å°±ç›´æ¥å¾ç·©å­˜å¾—åˆ°å°æ‡‰çš„å…§åµŒ jar åŒ…è·¯å¾‘ã€‚

æ·±å±¤ jar åŒ…çš„å…§åµŒ class çš„ URL è·¯å¾‘ä½¿ç”¨ ! åˆ†å‰²
jar:file:/workspace/springboot-demo/target/application.jar!/BOOT-INF/lib/snakeyaml-1.19.jar!/org/yaml/snakeyaml/Yaml.class

ä¸éé€™å®šè£½çš„ ClassLoader åªæœƒç”¨æ–¼æ‰“åŒ…é‹è¡Œæ™‚ï¼ŒIDE é–‹ç™¼ç’°å¢ƒä¸­ main æ–¹æ³•é‚„æ˜¯ç›´æ¥ä½¿ç”¨ ç³»çµ±é¡åŠ è¼‰å™¨ åŠ è¼‰é‹è¡Œçš„ã€‚


Java è¨»è§£çš„å½¢å¼å’ŒåŠŸèƒ½æ˜¯åˆ†é›¢çš„ï¼Œä¸åŒæ–¼ Python çš„è£é£¾å™¨æ˜¯åŠŸèƒ½æ€§çš„ã€‚

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}

@ComponentScan
public @interface SpringBootApplication {
...
}

public @interface ComponentScan {
    String[] basePackages() default {};
}

SpringBoot é‡åˆ° @ComponentScan æƒæå°æ‡‰åŒ…è·¯å¾‘ä¸‹é¢çš„æ‰€æœ‰ Classï¼Œæ ¹æ“šé€™äº› Class ä¸Šæ¨™è¨»çš„å…¶ä»–è¨»è§£ç¹¼çºŒé€²è¡Œå¾ŒçºŒè™•ç†ã€‚ä¾‹å¦‚æƒåˆ° @RestControllerï¼Œè€Œ @RestController åˆæ¨™è¨»äº† @Controller ã€‚
SpringBoot å° @Controller é€²è¡Œäº†ç‰¹æ®Šè™•è£¡ï¼Œæœƒå°‡æ­¤é¡ç•¶æˆ URL è™•ç†å™¨è¨»å†Šåˆ° Servlet çš„è«‹æ±‚è™•ç†å™¨ä¸­ï¼Œåœ¨å‰µå»º TomcatServer æ™‚ï¼Œæœƒå°‡è«‹æ±‚è™•ç†å™¨å‚³éé€²å»ã€‚
