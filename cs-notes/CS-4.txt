Data Structure & Algorithmã€Design Patternã€Networkã€Operation System
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆData Structure & Algorithmï¼‰
List(Stack FILO)	ArrayList		ä½¿ç”¨äº† Array å¯¦ä½œ List ä»‹é¢ã€‚O: ä½¿ç”¨ç´¢å¼•éš¨æ©Ÿå­˜å–ã€æ’åº	X: èª¿æ•´ç´¢å¼•é †åº	é™£åˆ—é•·åº¦å›ºå®šå•é¡Œ
		LinkedList		ä½¿ç”¨äº† Link å¯¦ä½œ List ä»‹é¢ã€‚O: æ¯æ¬¡ add() ç‰©ä»¶ï¼Œæ‰å»ºç«‹æ–°çš„ Node ä¿å­˜ç‰©ä»¶ï¼Œä¸æœƒäº‹å…ˆè€—è²»è¨˜æ†¶é«”ã€‚æœ‰åˆ©æ–¼èª¿æ•´ç´¢å¼•é †åº	X: æŒ‡å®šç´¢å¼•éš¨æ©Ÿå­˜å–ç‰©ä»¶æ™‚(ä¸€å€‹ä¸€å€‹æŸ¥æ‰¾)
		(éš¨æ™‚æœƒæœ‰å®¢æˆ¶ç«¯ç™»å…¥ç™»å‡ºçš„å®¢æˆ¶ç«¯ List)

Set	HashSet		å…§å®¹ä¸é‡è¤‡çš„ Set


Queue(Queue FIFO)		å®šç¾©äº†è‡ªå·±çš„ offer()ã€poll()ã€peek() ç­‰æ–¹æ³•ï¼Œæœ€ä¸»è¦å·®åˆ¥ä¹‹ä¸€åœ¨æ–¼ï¼Œadd()ã€remove()ã€element() ç­‰æ“ä½œå¤±æ•—æ™‚æœƒæ‹‹å‡ºä¾‹å¤–ï¼Œè€Œ offer()ã€poll()ã€peek() ç­‰æ“ä½œå¤±æ•—æœƒå‚³å›ç‰¹å®šå€¼ã€‚
å¦‚æœç‰©ä»¶æœ‰å¯¦ä½œ Queueï¼Œä¸¦æ‰“ç®—ä»¥ä½‡åˆ—çµæ§‹è¡¨ç¤ºï¼Œä¸”ä½‡åˆ—é•·åº¦å—é™ï¼Œé€šå¸¸å»ºè­°ä½¿ç”¨ offer()ã€poll()ã€peek() ç­‰æ–¹æ³•ã€‚
offer() å¾Œç«¯åŠ å…¥ç‰©ä»¶ï¼ŒæˆåŠŸ trueã€å¤±æ•— falseã€‚
poll() å–å‡ºä½‡åˆ—å‰ç«¯ç‰©ä»¶ï¼Œè‹¥ä½‡åˆ—ç‚ºç©ºå‚³å› nullã€‚
peek() å–å¾—(ä½†ä¸å–å‡º)ä½‡åˆ—å‰ç«¯ç‰©ä»¶ï¼Œè‹¥ä½‡åˆ—ç‚ºç©ºå‚³å› nullã€‚

LinkedList ä¸åƒ…å¯¦ä½œ List ä»‹é¢ä¹Ÿå¯¦ä½œ Queue çš„è¡Œç‚ºï¼Œå› æ­¤å¯å°‡ LinkedList ç•¶ä½œä½‡åˆ—ä¾†ä½¿ç”¨ã€‚




ã€ŒStack çµæ§‹è¡¨ç¤ºæ³•ã€ã€ã€ŒQueue çµæ§‹è¡¨ç¤ºæ³•ã€éƒ½æœ‰ã€Œé™£åˆ—ã€å’Œã€Œéˆçµä¸²åˆ—ã€







æ•¸æ“šçµæ§‹çš„ä¸‰è¦ç´ ï¼š

é›†åˆã€ç·šæ€§ã€æ¨¹ç‹€ã€ç¶²ç‹€ã€æ•£åˆ—
å®šç¾©				é‚è¼¯çµæ§‹			é›†åˆçµæ§‹
							ç·šæ€§çµæ§‹		ä¸€å°ä¸€		stackã€queue
							æ¨¹å‹çµæ§‹		ä¸€å°å¤š		trees
							åœ–ç‹€çµæ§‹		å¤šå°å¤š		graphs

				æ•¸æ“šçš„é‹ç®—		çµåˆé‚è¼¯çµæ§‹ã€å¯¦éš›éœ€æ±‚ä¾†å®šç¾©åŸºæœ¬é‹ç®—

							é †åºå­˜å„²
å¦‚ä½•ç”¨è¨ˆç®—æ©Ÿå¯¦ç¾é€™ç¨®å­˜å„²çµæ§‹	ç‰©ç†çµæ§‹(å­˜å„²çµæ§‹)	éˆå¼å­˜å„²		ï½
							ç´¢å¼•å­˜å„²		ï½éé †åºå­˜å„²
							æ•£åˆ—å­˜å„²		ï½
Stack(é †åº)ã€Queue(é †åº)ã€Trees(nodesçµ„æˆ)ã€Graphsã€Hash
tupleã€arrayã€listã€setã€dicã€struct...
é †åº: Array(éœ€è¦è¶³å¤ å¤§çš„é€£çºŒå„²å­˜å€åŸŸ)ã€æ›´é©åˆæŸ¥è©¢é‡å¤§çš„ç¨‹å¼è¨­è¨ˆ
éˆå¼: Linked List(dataã€pointer)ã€æ›´é©åˆéœ€è¦é »ç¹æ’å…¥å’Œåˆªé™¤çš„ç¨‹å¼

ä¸²(String): ç”±characterçµ„åˆï¼Œå­˜å„²çµæ§‹ä¹Ÿæœ‰é †åºã€éˆå¼
é †åº(Cèªè¨€ 0å‡ é0çœŸ )ï¼š
å®šé•·å­˜å„²çµæ§‹
typedef struct
{
	char str[maxSize + 1];	// å¤šä¸€å€‹ \0 ä½œç‚ºçµæŸæ¨™è¨˜ã€‚
	int length;
} Str;

è®Šé•·å­˜å„²çµæ§‹
typedef struct
{
	char *ch;
	int length;
} Str;

Str S;
S.length = L;
S.ch = (char*)malloc((L+1)*sizeof(char));
...
free(S.ch);

HashMapçš„å„²å­˜çµæ§‹æ¡ç”¨é †åºå­˜å„²çµæ§‹åŠéˆå¼å­˜å„²çµæ§‹ã€‚
é †åºå­˜å„²å„²å­˜æ¯å€‹é€£çµä¸²åˆ—çš„é ­ç¯€é»ã€‚æ¯å€‹ Key æ ¹æ“šè¨ˆç®— bucketindex ä¾†ç¢ºå®šé™£åˆ—ä¸‹æ¨™ã€‚bucketindex = hash & (length-1)ã€‚ç•¶ bucketindex ç›¸åŒï¼Œæ’å…¥é€£çµä¸²åˆ—é ­éƒ¨ã€‚
HashMapä¸­çš„è³‡æ–™çµæ§‹æ˜¯é™£åˆ—+å–®éˆè¡¨çš„çµ„åˆï¼Œæˆ‘å€‘å¸Œæœ›å…ƒç´ å­˜æ”¾çš„æ›´å‡å‹»ï¼Œæœ€ç†æƒ³çš„æ•ˆæœï¼ŒEntryé™£åˆ—ä¸­æ¯å€‹ä½ç½®éƒ½åªæœ‰ä¸€å€‹å…ƒç´ ï¼ŒæŸ¥è©¢çš„æ™‚å€™æ•ˆç‡æœ€é«˜ï¼Œä¸éœ€è¦éæ­·å–®éˆè¡¨ï¼Œä¹Ÿä¸éœ€è¦é€šéequalså»æ¯”è¼ƒKï¼Œè€Œä¸”ç©ºé–“åˆ©ç”¨ç‡æœ€å¤§ã€‚
æ‰€ä»¥å¯ä»¥æ¡ç”¨%çš„æ–¹å¼ï¼Œæ—¢é›œæ¹Šå€¼%å®¹é‡=bucketIndexã€‚è€ŒåŸå§‹ç¢¼çš„å¯¦ç¾æ¡ç”¨ h & (length-1)ï¼Œå…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚é€™è£¡æ³¨æ„ï¼Œç‚ºä»€éº¼ HashMap çš„é è¨­å®¹é‡è¦æ±‚2Næ¬¡æ–¹ã€‚ç•¶å®¹é‡ä¸€å®šæ˜¯2^næ™‚ï¼Œh & (length - 1) == h % length


éè¿´ (Recursion)
int a[] = {15, 37, 26, 9};

int sum(int[] a, int n) {
	int result = 0;

	if(n < 1)
		throw new IllegalArgumentException("n should be >= 1");
	else {
		for (int i = 0; i<n; i++)
			result = result + a[i];
	}
	return result;
}
è‹¥æ›æˆ éè¿´ çš„æ€ç¶­æ–¹å¼:
å°‡å…·æœ‰ ç›¸åŒæ€§è³ª çš„å•é¡Œï¼Œæ‹†æˆ å¤šå€‹ å­å•é¡Œã€‚
int sum(int[] a, int n) {
	if (n<1)
		throw new IllegalArgumentException("n should be >= 1");
	else if (n == 1)
		return a[0];
	else
		return sum(a, n-1) + a[n-1];
}
ç¨®é¡ â€”â€” ä¾ å‘¼å«æ–¹å¼
å¦‚é–‹é ­å®šç¾©æ‰€è¿°ï¼Œ éè¿´ æœ‰å…©ç¨®å‘¼å«æ–¹å¼:

1. ç›´æ¥éè¿´ (direct recursion)
2. é–“æ¥éè¿´ (indirect recursion)

ç›´æ¥éè¿´ (direct recursion)
æŒ‡çš„æ˜¯ å‡½å¼ å‘¼å«è‡ªå·±æœ¬èº«ã€‚

é–“æ¥éè¿´ (indirect recursion)
æŒ‡çš„æ˜¯ å‡½å¼å¼•ç”¨ å…¶ä»–å‡½å¼ï¼Œå…¶å† å‘¼å«åŸå‡½å¼ã€‚
ç”±æ–¼å½¢æˆäº† calling cycleï¼Œä½¿ç”¨ä¸Šéœ€æ ¼å¤–å°å¿ƒã€‚

ç¨®é¡ â€”â€” ä¾ å‘¼å«æ¬¡æ•¸
åˆ†ç‚º

1. ç·šæ€§éè¿´ (linear recursion)
2. äºŒå…ƒéè¿´ (binary recursion)
3. å¤šå…ƒéè¿´ (multiple recursion)

ç·šæ€§éè¿´ (linear recursion)
ç•¶å‡½ç¤ºï¼Œåªå‘¼å«ä¸€æ¬¡éè¿´ï¼Œç¨±ä¹‹ï¼Œ
æœ€ç°¡å–®çš„éè¿´å½¢å¼ã€‚

äºŒå…ƒéè¿´ (binary recursion)
ç•¶å‡½å¼ï¼Œå‘¼å«å…©æ¬¡éè¿´ï¼Œç¨±ä¹‹ã€‚

å¤šå…ƒéè¿´ (multiple recursion)
å°±æ˜¯å‘¼å« å…©æ¬¡ä»¥ä¸Šå›‰ï¼

ç¨®é¡ â€”â€” å°¾ç«¯éè¿´ (tail recursion)
é€™æ˜¯å¯¦å‹™ä¸Šä¸€ç¨®é‡è¦çš„éè¿´ç¨®é¡ï¼ŒæŒ‡çš„æ˜¯å…·å‚™:

ç›´æ¥éè¿´ (direct recursion)
ç·šæ€§éè¿´ (linear recursion)
ä¸”è©² å‡½å¼åŸ·è¡Œçš„æœ€å¾Œä¸€ä»¶äº‹ ç‚ºéè¿´å‘¼å«ï¼Œä¸” åªèƒ½æ˜¯éè¿´å‘¼å«

è­¬å¦‚ ä¸Šæ–¹çš„ é™£åˆ—åŠ ç¸½ç¯„ä¾‹ ï¼Œ
å³ä½¿æœ€å¾Œçš„æ•˜è¿°åŒ…å«äº†ä¸€å€‹éè¿´å‘¼å«ï¼Œå®ƒé‚„å¿…é ˆèˆ‡ a[n-1] åŠ ç¸½ï¼Œ
ä¹Ÿå°±æ˜¯èªªï¼Œä»–æœ€å¾ŒåŸ·è¡Œçš„æ˜¯ åŠ æ³•ï¼Œè€Œééè¿´ã€‚
ä»–æ˜¯ ç›´æ¥ç·šæ€§å¼éè¿´ï¼Œä½†æ˜¯ ä¸¦é å°¾ç«¯éè¿´ï¼


é‚£éº¼ï¼Œå°¾ç«¯éè¿´ è·Ÿ å…¶ä»–éè¿´ åˆ°åº•æœ‰ä»€éº¼å·®ç•°å‘¢ï¼Ÿ
 
å‡½å¼å‘¼å«
é¦–å…ˆå¾—çŸ¥é“å‡½å¼å‘¼å«çš„ç°¡æ˜“æµç¨‹:
åŸ·è¡Œ Function A( ) æ™‚ï¼Œè‹¥éœ€å‘¼å« Function B( )ï¼Œ
é€™æ™‚å¾—

1. ç¨‹å¼æœƒå»ºç«‹ä¸€å€‹ è¢«ç¨±ç‚º æ´»å‹•ç´€éŒ„ (activation record) æˆ– å †ç–Šæ¡† (stack frame) çš„çµæ§‹ï¼Œ
ä¿å­˜ Function A ( ) ç›®å‰çš„åŸ·è¡Œç‹€æ…‹ï¼Œä¸¦å°‡å…¶è³‡è¨Š push åˆ° ç³»çµ±å †ç–Š (System Stack) é ‚ç«¯ï¼Œ
åŒ…å« åƒæ•¸ã€å€åŸŸè®Šæ•¸ã€è¿”å›ä½ç½® (return address)ã€‚
2. æ§åˆ¶æ¬Šè½‰ç§»ï¼Œä¸”åšåƒæ•¸å‚³é
3. åŸ·è¡Œ Function B( ) ã€‚
4. Function B( ) åŸ·è¡Œå®Œæˆï¼Œåšåˆ¤æ–·:
if (Stack != empty) {
	pop stack;	// å–å‡ºåƒæ•¸ã€å€åŸŸè®Šæ•¸ã€è¿”å›ä½ç½®
		ä¾ è¿”å›ä½ç½® è¿”å› ä¸¦åŸ·è¡Œ
}
å› æ­¤ï¼Œéè¿´çš„æ¯æ¬¡å‘¼å«: éœ€è¦é¡å¤–çš„è¨˜æ†¶é«” (ç³»çµ±å †ç–Š)ï¼Œä¾†è¨˜éŒ„æ¯å€‹éè¿´çš„å‘¼å«ç‹€æ…‹ï¼

è‹¥å»ç¶²è·¯æœå°‹ å°¾ç«¯éè¿´ (tail recursion)ï¼Œä½ å°±çŸ¥é“å®ƒç‚ºä½•é‡è¦äº†ã€‚

å¤§éƒ¨åˆ†éƒ½æœƒå‘Šè¨´ä½ :

å°¾ç«¯éè¿´ï¼Œä¸å¢åŠ  æ–°çš„ç³»çµ±å †ç–Šï¼Œ
è€Œæ˜¯ç”¨æ¯æ¬¡åŸ·è¡Œçš„çµæœï¼Œç›´æ¥æ›´æ–°å‡½ç¤ºå…§å®¹ï¼Œé€™æ¨£çš„åšæ³•ç¨±ç‚º:
å°¾ç«¯å‘¼å«æ¶ˆé™¤ (Tail Call Elimination, TCE) æˆ– å°¾ç«¯å‘¼å«æœ€ä½³åŒ– (Tail Call Optimization, TCO)ã€‚

é€™ä¸å®Œå…¨æ˜¯çœŸçš„ï¼
è¨±å¤šèªè¨€ç·¨è­¯å™¨ ä¸¦ ä¸(æƒ³)æ”¯æ´ å°¾ç«¯å‘¼å«æœ€ä½³åŒ– ! (ex: Javaã€Python)

éè¿´/è¿­ä»£è½‰æ›ï¼š
å„˜ç®¡è¨±å¤šèªè¨€ï¼Œä¸¦ä¸æ”¯æ´ å°¾ç«¯å‘¼å«å„ªåŒ–ï¼Œ
å°¾ç«¯éè¿´ é‚„æ˜¯å¾ˆé‡è¦çš„ï¼
 
é€™è£¡ç”¨å€‹è‘—åçš„ä¾‹å­ã€Œå°æ–¼ç­‰æ–¼ n çš„è‡ªç„¶æ•¸ç¸½å’Œã€:
ä½¿ç”¨ è¿­ä»£
ä½¿ç”¨ éè¿´ (ç·šæ€§ éå°¾ç«¯)
int sum(int n) {
	in (n < 0)
		throw new IllegalArgumentException("n should be >= 0");
	else if (n==0)
		return 0;
	else
		return sum(n-1)+n;
}
å‚³å…¥ sum(100) æƒ³è¨ˆç®— 1 + 2 + 3 + â€¦ + 99 + 100 çš„å€¼ï¼Œsum(99) + 100ï¼›sum(99) å†è¢«æ‹†æˆ sum(98) + 99 â€¦
ä½¿ç”¨ éè¿´ (å°¾ç«¯)
public int sum(int n, int total) {
	if (n==0)
		return total;
	else
		return sum(n-1, total+n);
}
sum(10, 0) å•é¡Œæœƒä¾åºè¢«åˆ†è§£ç‚º:
sum(9, 10);
sum(8, 19);
sum(7, 27);
...
æœ€å¾Œ return 55;

n â€“ 1ï¼Œä¸å°±æ˜¯æ¯æ¬¡ è¿´åœˆ çš„ è®ŠåŒ–é‡å—?
total + n ä¸å°±æ˜¯ å€åŸŸè®Šæ•¸ çš„ ç´¯åŠ  ?

å°¾ç«¯éè¿´å…¶å¯¦åªæ˜¯æŠŠ:
è¿­ä»£çš„ è¿´åœˆè®ŠåŒ– èˆ‡ å€åŸŸè®Šæ•¸ï¼Œæ”¾åœ¨æ–¹æ³•çš„åƒæ•¸ä¸­å‚³é ç½·äº†ã€‚
è¦æ”¹å¯«æˆ ééè¿´ å°±æ˜¯ piece of a cake äº† ğŸ°ã€‚

ä¸€å€‹å‡½å¼ï¼Œç†è«–ä¸Šå¿…å®šå­˜åœ¨å…©ç¨®å½¢å¼è§£æ³•: éè¿´ èˆ‡ ééè¿´ã€‚
è€Œ å°¾ç«¯éè¿´ å‰‡èƒ½ ç„¡ç—›è½‰æ› ç‚ºééè¿´ï¼

			Recursion		Non-recursion
ç¨‹å¼ç¢¼			è¼ƒç²¾ç°¡		å†—é•·
ç†è§£æ€§			æ˜“ç†è§£		ä¸æ˜“
è¡¨é”èƒ½åŠ›			ä½³		è¼ƒå·®
åŸ·è¡Œæ™‚é–“			é€šå¸¸æ•ˆç‡è¼ƒå·®	é€šå¸¸æ•ˆç‡è¼ƒé«˜
é¡å¤–Stackç©ºé–“		éœ€æ”¯æ´		ç„¡
è®Šæ•¸			è¼ƒå°‘æˆ–ç„¡		è¼ƒå¤š
å‡½å¼è¨˜æ†¶é«”ç©ºé–“		è¼ƒçœ		è¼ƒå¤š
(é ç³»çµ±å †ç–Šè¨˜æ†¶é«”)
å¯¦å‹™ä½¿ç”¨			è¼ƒå°‘		è¼ƒå¤š
			(è¼ƒå¸¸è¦‹æ–¼ç‰¹å®šå•é¡Œ)

è‹¥èƒ½ä¿è­‰å‡½å¼æœ‰ è¼ƒä½³çš„æ”¶æ–‚ç¨‹åº¦ ä¸” æ•ˆèƒ½è‰¯å¥½ï¼Œé‚„æ˜¯èƒ½ä½¿ç”¨
å¦å¤–ï¼Œä»¥ä¸Šçš„æƒ…æ³åƒ…é©ç”¨æ–¼ç›¸åŒé‚è¼¯ä¹‹æ¼”ç®—æ³•ï¼Œ
è‹¥ éè¿´ç”¨å¾—å¥½æ•ˆèƒ½å¯ä¸è¼¸çµ¦è¿­ä»£ ï¼æ¥ä¸‹ä¾†å°±ä¾†çœ‹å€‹éè¿´å„ªåŒ–çš„ç¯„ä¾‹å§ã€‚

è²»å¼æ•¸åˆ— (Fibonacci Number)
Def:
F_0=0
F_1=1
F_n=F_n-1+F_n-2(n>=2)

ä½¿ç”¨ éè¿´ (äºŒå…ƒ éå°¾ç«¯)
æ™‚é–“è¤‡é›œåº¦ â€” O(2^n)ï¼š
int  fib(int n) {
	if (n==0)
		return 0;
	else if (n==1)
		return 1;
	else
		return fib(n-1) + fib(n-2);
}

ç”±æ–¼ è²»æ°æ•¸åˆ— æœ¬èº«å³ç”±éè¿´å®šç¾©ï¼Œå¯«æˆéè¿´ç›¸ç•¶å®¹æ˜“ï¼
ç„¶è€Œï¼Œæ­¤ç¨®äºŒå…ƒéè¿´ç”¢ç”Ÿäº†è¨±å¤šå†—ä½™è¨ˆç®—ï¼Œè€—æ™‚åˆè€— Stack ç©ºé–“ï¼š

ä½¿ç”¨ è¿­ä»£
ä½¿ç”¨ ééè¿´ï¼Œæ™‚é–“è¤‡é›œåº¦ â€” O(n)ï¼š
int fib(int n) {
	if(n==0)
		return 0;
	else if (n ==1 )
		return 1;
	else {
		int a=0, b=1, result=0;
		for(int i =2; i<=n;i++) {
			result = a + b;
			a = b;
			b = result;
		}
		return result;
	}
}
ç›¸æ¯”åŸºæœ¬éè¿´å‡½å¼æ•ˆç‡æå‡è¨±å¤šï¼
ç„¶è€Œï¼Œé€™ ä¸ä»£è¡¨éè¿´æ¯”è¿­ä»£å·®ï¼Œå¤§å¤šæ™‚å€™å¯èƒ½æ˜¯éè¿´ ç”¨å¾—ä¸å¤ å¥½ï¼

ä½¿ç”¨ éè¿´ (å°¾ç«¯)
ééè¿´ æ”¹å¯«ç‚º å°¾ç«¯éè¿´ï¼Œæ™‚é–“è¤‡é›œåº¦ â€” O(n)ï¼
public int fib(int n ) {
	return fib(n, 0, 1);
}
private int fib(int n, int a, int b) {
	if (n==0) return a;
	return fib(n-1, b, a + b);
}
æŠŠè¿­ä»£çš„ è¿´åœˆè®ŠåŒ– èˆ‡ å€åŸŸè®Šæ•¸ï¼Œæ”¾åœ¨åƒæ•¸ä¸­å‚³éç½·äº†ã€‚


ä½¿ç”¨ è¿­ä»£ (Fast Doubling)
é€é Q-Matrixï¼Œé‚„èƒ½é€²ä¸€æ­¥å°‡è²»æ°æ•¸åˆ—è½‰ç§»æˆçŸ©é™£ä¹˜æ³•å•é¡Œï¼š


ä¹˜å…¥å¾Œä¾¿å¯ä»¥å°å‡ºå…©å€‹æ–¹ä¾¿çš„å…¬å¼ï¼š
F_(2n) = F_(n) [2F_(n + 1) âˆ’ F_(n)]
F_(2n + 1) = F_(n + 1)^2 + F_(n)^2

è—‰ç”±å¿«é€Ÿå†ªçš„æŠ€å·§å³å¯å¾—ï¼š
æ™‚é–“è¤‡é›œåº¦ â€” O(log n)ï¼
int fib(int n ) {
	int a = 0;
	int b = 1;
	for (int bit = Integer.highestOneBit(n); bit != 0; bit >>>= 1) {
		int c = a * ((b << 1) - (a));
		int d = (a * a) + (b * b);

		if ((n & bit) != 0) {
			int e = c + d;
			a = d;
			b = e;
		} else {
			a = c;
			b = d;
		}
	}
	return a;
}

ä½¿ç”¨ éè¿´ (å°¾ç«¯ + Fast Doubling)
æ™‚é–“è¤‡é›œåº¦ O(log n)ï¼
public int fib(int n) {
	return fib(n, 0, 1, Integer.highestOneBit(n));
}

private int fib(int n, int a, int b, int bit) {
	if (bit == 0) return a;
	int c =a * ((b << 1) - (a));
	int d= (a * b) + (b * b);

	if ((n & bit) != 0) {
		int e = c + d;
		a = d;
		b = e;
	} else {
		a = c;
		b = d;
	}
	bit >>>= 1;
	return fib(n, a, b, bit);
}



æ²³å…§å¡” (Hanoi Tower)
Def:
æœ‰ å¡”Aã€å¡”Bã€å¡”Cï¼Œå¡”A æ”¾è‘— n å€‹ç›¤å­ï¼Œ
æ¬²å°‡ n å€‹ ç›¤å­ (disks)ï¼Œç”± å¡” A æ¬ç§»åˆ° å¡”Cã€‚

ä¸”å¿…é ˆéµå®ˆ:
ä¸€æ¬¡åªèƒ½æ¬ç§»ä¸€å€‹ disk
æ¬ç§»éç¨‹ä¸­ï¼Œå°ç›¤ä¸å¯åœ¨å¤§ç›¤ä¹‹ä¸‹

è§£æ³•é‚è¼¯ (å°‹æ‰¾ä¸­ç¹¼å¡”):
å…ˆå°‡ å¡”A ä¸Šé¢çš„ n-1 å€‹ ç›¤å­ï¼Œç§»å‹•åˆ°å¡”B (ä¸­ç¹¼ç‚º c)
å°‡æœ€å¤§çš„ç›¤å­ï¼Œæ¬è‡³ç›®çš„åœ° å¡”C
å°‡ å¡”B å‰©ä¸‹çš„ç›¤å­ï¼Œæ¬ç§»è‡³ç›®çš„åœ° å¡”C (ä¸­ç¹¼ç‚º a)

ç¯„ä¾‹ï¼š
void hanoi(int n , String a, String b, String c) {
	if (n==1) {
		System.out.println("å°‡ç›¤å­å¾" + a + "æ¬åˆ°" + c);
	} else {
		hanoi(n-1, a, c, b);
		hanoi(1, a, b, c);
		hanoi(n-1, b, a, c);
	}
}
æ¥è‘—ï¼ŒåŸ·è¡Œ hanoi(3, a, b, c) å°‡ 3 å€‹ç›¤å­ï¼Œå¾ A æ¬åˆ° Bï¼
ç•¶è¦æ¬å‹• n å€‹ç›¤å­æ™‚ï¼Œç¸½å…±è¦æ¬å‹• 2n â€“ 1 æ¬¡ï¼Œæ™‚é–“è¤‡é›œåº¦ç‚º O(2n)

ç°¡å–®èªªå°±æ˜¯ï¼Œé‡åˆ°å•é¡Œå°±ä¸æ–·åœ° æ‹†è§£ æˆç›¸åŒ å­å•é¡Œï¼Œ
ç›´åˆ°æ‹†åˆ°ä¸èƒ½æ‹†ç‚ºæ­¢ï¼Œä¸¦å®šç¾© æœ€ç°¡æƒ…æ³ çš„åšæ³•ã€‚
å»ºç«‹çµ‚æ­¢éè¿´å‘¼å«çš„ è‡¨ç•Œ/çµ‚æ­¢æ¢ä»¶

ä¾‹å¦‚ï¼Œä¸Šè¿°çš„æ²³å…§å¡”å•é¡Œï¼Œçµ‚æ­¢æ¢ä»¶ä¾¿æ˜¯åªæœ‰ä¸€å€‹ç›¤å­æ™‚â€¦ï¼Œ
äºŒå…ƒæ¨¹çš„èµ°è¨ªã€ç¿»è½‰ï¼Œå‰‡æ˜¯ ç•¶æ¨¹ç‚ºç©ºã€‚


ArrayListå¯¦ä½œ
import java.util.Arrays;

public class ArrayList {
	private Object[] elems;
	private int next;

	public ArrayList(int capacity) {
		elems= new Object[capacity];
	}
	public ArrayList() {
		this(16);
	}
	public void add(Object o) {
		if next==elems.length) {
			elems=Arrays.copyof(elems,elems.length * 2);
		}
		elems [next ++] = 0;
	}
	public Object get (int index) {
		return elems [index];
	}
	public int size() {
		return next;
	}
}

ArrayList<Integer>14å€‹åŸºæœ¬ä½¿ç”¨

java.util.*

æ·»åŠ 
ArrayList<Integer> list2 = new ArrayList<Integer>();
list2.add(12);
list2.add(23);
list2.add(9);

æœ€å¤§æœ€å°å€¼
int maxa = Collections.max(list2), mina = Collections.min(list2);

è¼¸å‡º
System.out.println("whole list2 is "+list2;

whole list2 is [12, 23, 9]

è¤‡è£½
ArrayList<Integer> list21 = new ArrayList<Integer>();
lsit21.addAll(list2);

å¾å°åˆ°å¤§æ’åº
Collections.sort(list2);
System.out.println("list2 sort is "+list2);

list2 sort is [9, 12, 23]

å¾å¤§åˆ°å°æ’åº
Collections.sort(list2, Collections.reverseOrder());
System.out.println("list2 descend sort is "+list2);

list2 descend sort is [23, 12, 9]

å€’åº
Collections.reverse(list21);
System.out.println("reverse list21 is "+list21);

reverse list21 is [9, 23, 12]

æ±‚æŸå€‹å…ƒç´ é¦–æ¬¡å‡ºç¾çš„ä½ç½®
int idx = list2.indexOf(23);
System.out.println("list2 is "+list2+" and 23 locates :"+idx);

list2 is [23, 12, 9] and 23 locates :0

æ±‚å’Œ
int sum = 0;
for (int i = 0; i<list2.size(); i++) {
	sum += list2.get(i);
}
System.out.println("list2 sum is "+sum);

//åˆ©ç”¨streamæ±‚å’Œ
List<Integer> ls = new ArrayList<Integer>();
ls.add(43);
ls.add(27);
int sum2 = ls.stream().mapToInt(a -> a).sum();
System.out.println("sum is "+sum2);

list2 sum is 44
sum is 70

åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ 
list2.add(1,88);

ç§»é™¤æŸå€‹ä½ç½®çš„å…ƒç´ 
list2.remove(1);
list2.remove(list2.size()-1);	//åˆªé™¤æœ«å°¾

ç§»é™¤æŸå€‹å€¼	// [23, 12]
list2.add(0,23);
for (int i = 0; i<list2.size(); i++) {
	if(list2.get(i) == 23 {
		list2.remove(i);
		i--;
	}
}
System.out.println("remove 23 and list2 is "+list2);

remove 23 and list2 is [12]

åˆ‡ç‰‡
ArrayList<Integer> list3 = new ArrayList<Integer>();
list3.add(45);
list3.add(52);
list3.add(66);
System.out.println("list3 is "+list3);
System.out.println("list3[0:2} is "+list3.subList(0,2));

list3 is [45, 52, 66]
list3[0:2] is [45, 52]

è½‰åŒ–ç‚ºæ•´å½¢æ•¸çµ„
import java.util.*;
class Solution {
	public int[] twoSum(int[] nums, int target) {
		ArrayList<Integer> re = new ArrayList<Integer>();
		for (int i = 0; i<nums.length; i++) {
			for(int j =i+1; j<nums.length;j++) {
				if(nums[i]+nums[j]==target) {
					re.add(i);
					re.add(j);
				}
			}
		}
		int[] res = re.stream().mapToInt(Integer::valueOf).toArray();	// ArrayList -> Array
		return res;
	}

	// èª¿ç”¨
	public static void main(String[] args) {
		int[] nums = {2, 7, 11, 9};		// Array
		int target = 9;
		Solution s = new Solution();
		int[] lst = s.twoSum(nums, target);
		System.out.println(Arrays.toString(lst));
	}
}

[0, 1]
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ArrayListã€Arraysæ¯”è¼ƒ
import java.util.ArrayList;
import java.util.Arrays;

class ArrayTest {
	public static void main(String[] args)
					// Array
		int[] arr = new int[2];
					//æ–°å¢å…ƒç´ 
		arr[0] = 1;
		arr[1] = 2;
					//å­˜å–å…ƒç´ 
		System.out.println(arr[0]);
	
					// ArrayList
		Arraylist<Integer> arrL = new ArrayList<Integer>(2);
					//æ–°å¢å…ƒç´ 
		arrL.add(1);
		arrL.add(2);
					//å­˜å–å…ƒç´ 
		System.out.println(arrL.get(0));
	}
}
ArrayListé€éadd get
Array å¯ä»¥åŒ…å«primitive data types å’Œobject entitiesã€‚		// æ¥æ”¶åŸå§‹æ•¸æ“šå’Œç‰©ä»¶
ArrayList åªå¯ä»¥åŒ…å«object entries ä½†ä¸æ”¯æŒprimitive data typesã€‚	// æ¥æ”¶ç‰©ä»¶

import java.util.ArrayList;
import java.util.Arrays;

class ArrayTest {
	public static void main(String[] args) {
					//å…è¨±primitive data types
		int[] array = new int[3];
					//å…è¨±object entities
		Test[] array1 = new Test[3]
					//ä¸å…è¨±primitive data types
		ArrayList<char> arrL = new ArrayList<char>();
					//å…è¨±object entities
		ArrayList<Integer> arrL1 = new ArrayList<>();
		ArrayList<String> arrL2 = new ArrayList<>();
		ArrayList<Object> arrL3 = new ArrayList<>();
	}
}

ArrayList toArray() è½‰æ›ç‚ºå°è±¡æ•¸çµ„
import java.util.ArrayList;
import java.util.Arrays;

public class ArrayListExample {
	public static void main(String[] args) {
		ArrayList<String> list = new ArrayList<>(2);

		list.add("A");
		list.add("B");
		list.add("C");
		list.add("D");

		// Convert to object array
		Object[] array = list.toArray();

		System.out.println(Arrays.toString(array));

		// Iterate nad convert to desired type
		for (Object o : array) {
			String s = (String) o;

			System.out.println(s);
		}
	}
}

[A, B, C, D]

A
B
C
D

ArrayList toArray(T[] a) è½‰æ›ç‚ºå­—ç¬¦ä¸²æ•¸çµ„
import java.util.ArrayList;
import java.util.Arrays;

public class ArrayListExample {
	public static void main(String[] args) {
		ArrayList<String> list = new ArrayList<>(2);

		list.add("A");
		list.add("B");
		list.add("C");
		list.add("D");

		// Convert to string array
		String[] array = list.toArray(new String[list.size()]);

		System.out.println(Arrays.toString(array));
	}
}
[A, B, C, D]
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆStringï¼‰
Immutable stringsï¼šä¸å¯è®Šç‰¹æ€§ï¼Œå¦å‰‡å¾ˆå±éšªï¼ŒStringæœ‰éå¸¸å¤šçš„ç”¨é€”èˆ‡å®‰å…¨æ€§è€ƒé‡ã€‚
æ‰€ä»¥è¦ç”¨ + ä¸²æ¥ï¼Œä½†ä½¿ç”¨ + å°±æœƒ(new StringBuilder()).append().toString()ï¼Œé‡è¤‡ä½¿ç”¨å¤šæ¬¡å®¹æ˜“é€ æˆæ•ˆèƒ½ä¸Šè² æ“”ï¼Œå¯ä»¥å–®ä¾‹StringBuilderé‡è¤‡ä½¿ç”¨.append().append().toStringã€‚
StringBuilder:ä¸è™•ç†åŒæ­¥(Sync)
StringBuffer:è™•ç†åŒæ­¥(Sync)

Objectçš„String toString()ã€static String toString(int i)

ç”¨å¤šè¼‰(Overload)å°±æ˜¯å…¸å‹switch case defaultã€‚å¤šå‹(Polymorphism)çš„è©±è¦å†æä¸€å€‹ä»‹é¢å‡ºä¾†ï¼Œå¤šè¼‰å°±æ˜¯ä¸€å€‹é¡åˆ¥æå®šã€‚
public string toString(string fmt)
   {
      if (string.IsNullOrEmpty(fmt))
         fmt = "G";

      switch (fmt.ToUpperInvariant())
      {
         case "G":
            return string.Format("{0} {1}", _year, _model);
         case "D":
            return string.Format("{0} {1}, {2} dr.",
                                 _year, _model, _doors);
         case "C":
            return string.Format("{0} {1}, {2}",
                                 _year, _model, _cylinders);
         case "A":
            return string.Format("{0} {1}, {2} dr. {3}",
                                 _year, _model, _doors, _cylinders);
         default:
            string msg = string.Format("'{0}' is an invalid format string",
                                       fmt);
            throw new ArgumentException(msg);
      }
   }
}
___________________________________________________________________________________________________________________________________________________________________________________________________________________compact1, compact2, compact3
java.util
Interface Comparator<T>

Type Parameters:
T - the type of objects that may be compared by this comparator

All Known Implementing Classes:
Collator, RuleBasedCollator

Functional Interface:
This is a functional interface and can therefore be used as the assignment target for a lambda expression or method reference.

@FunctionalInterface
public interface Comparator<T>

See Also:
Comparable, Serializable

Method Detail:
int compare(T o1, To2)
boolean equals(Object obj)
default Comparator<T> reversed()
default Comparator<T> thenComparing(Comparator<? super T> other)
default<U> Comparator<T> thenComparing(Function<? super T, ? extends U> keyExtractor, Comparator<? super U> keyComparator)
default<U extends Comparable<? super U>> Comparator<T> thenComparing(Function<? super T, ? extends U> keyExtrator)
default Comparator<T> thenComparingInt(ToIntFunction<? super T> keyExtractor)
default Comparator<T> thenComparingLong(ToLongFunction<? super T> keyExtractor)
default Comparator<T> thenComparingDouble(ToDoubleFunction<? super T> keyExtractor)
static <T extends Comparable<? super T>> Comparator<T> reverseOrder()
static <T extends Comparable<? super T>> Comparator<T> naturalOrder()
static <T> Comparator<T> nullsFirst(Comparator<? super T> comparator)
static <T> Comparator<T> nullsLast(Comparator<? super T> comparator)
static <T,U> Comparator<T> comparing(Function<? super T, ? extends U> keyExtractor, Comparator<? super U> keyComparator)
static <T,U extends Comparable<? super U>> Comparator<T> comparing(Function<? super T,? extends U> keyExtractor)
static <T> Comparator<T> comparingInt(ToIntFunction<? super T> keyExtractor)
static <T> Comparator<T> comparingLong(ToLongFunction<? super T> keyExtractor)
static <T> Comparator<T> comparingDouble(ToDoubleFunction<? super T> keyExtractor)
___________________________________________________________________________________________________________________________________________________________________________________________________________________
Java setFetchSizeï¼Œæ’ˆå¤§é‡è³‡æ–™å·®ç•°æ¸¬è©¦
Javaæ’ˆå–å¯ç”¨è¨˜æ†¶é«”æ–¹å¼

public long getUsedMemory() {
	int kb = 1024;
	OperatingSystemMXBean osmxb = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
	long usedMemory = (osmxb.getTotalPhysicalMemorySize() - osmxb.getFreePhysicalMemorySize()) / kb;
	return usedMemory;
}

Javaæ’ˆå–è³‡æ–™æ–¹å¼

try{
	pstmt = conn.prepareStatement(sql);
	pstmt.setFetchSize(Integer.MIN_VALUE);		// æœ‰setFetchSizeæœ‰å·®ã€‚
	rs = pstmt.executeQuery();

	while(re.next()) {
		n++;
	}
}
catch(Exception ex) {
	log.error(ex);
	ex.printStackTrace();
} finally {
	rs.close();
	pstmt.close();
	conn.close();
}
___________________________________________________________________________________________________________________________________________________________________________________________________________________
Lambda - å°‡ä¸²åˆ— A è½‰æˆä¸²åˆ— B
List<ProductManager> B = A.stream()
		.map(developer -> new ProductManager(developer.getName(),developer.getAge()))
		.collect(Collectors.toList());


List<ProductManager> B = A.stream().map(developer -> {
		ProductManager productManager = new ProductManager();
		try {
			PropertyUtils.copyProperties(productManager, developer);
		} catch (Exception ex) {
			ex.printStackTrace();
		}
		return productManager;
	}).collect(Collectors.toList());

	B.forEach(System.out::println);


list.forEach(System.out.println);
ç›¸ç•¶æ–¼
for(int i = 0; i<list.size(); i++) {
	System.out.println(list.get(i));
}
é›†åˆåœ¨java8ä¸­æ“æœ‰ä¸€å€‹streamæ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°ä¸€å€‹æµå°è±¡ï¼Œé€™å€‹å°è±¡æ“æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œé€™äº›æ–¹æ³•å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°é›†åˆé€²è¡Œä¾‹å¦‚æ’åºã€åˆ†çµ„ã€è¨ˆæ•¸ã€éæ­·ã€è½‰æ›ç­‰æ“ä½œï¼Œè€ŒforEachå°±æ˜¯éæ­·ã€‚
è€Œlambdaå’Œå‡½æ•¸å¼æ¥å£ï¼Œåƒ…æœ‰ä¸€å€‹æœªå¯¦ç¾æ–¹æ³•çš„æ¥å£ï¼Œå¯ä»¥å¯«ä½œ(åƒæ•¸åˆ—è¡¨) -> {æ–¹æ³•é«”}
@FunctionalInterface
public interface FuncA {
	void doSomeThing(String str);
}
ä¸Šé¢é€™æ¥å£å°±èƒ½å¯«ä½œï¼ŒFuncA funcA = (str) -> {System.out.println("hello");}ï¼Œé¡ä¼¼çš„é‚„æœ‰Swingã€javaFxçš„ç›£è½å™¨: btn.addActionListener(e->{// do something});é€™æ¨£å°±çœå»äº†ä¹‹å‰éœ€è¦å°ˆç‚ºä»–ç·¨å¯«ä¸€å€‹å¯¦ç¾é¡æˆ–è€…åŒ¿åå…§éƒ¨é¡çš„ä»£ç¢¼ã€‚
è€Œåœ¨é€™ä¹‹ä¸Šï¼Œå¦‚æœä¸€å€‹æ–¹æ³•çš„èª¿ç”¨ä¸­ï¼Œé€™å€‹æ–¹æ³•çµ¦æ¥å£æä¾›çš„åƒæ•¸å’Œä»–æ¥æ”¶çš„è¿”å›ï¼Œå’Œä½ ç¾æœ‰æŸå€‹å¯¦ç¾å®Œå…¨ä¸€è‡´ï¼Œå°±å¯ä»¥é€²ä¸€æ­¥ç°¡åŒ–ï¼Œç¨±ç‚ºæ–¹æ³•å¼•ç”¨ã€‚forEachæ–¹æ³•æä¾›ä¸€å€‹æŸç¨®é¡å‹çš„Object(å…·é«”æ˜¯ç”šéº¼é¡å‹æ˜¯è¦çœ‹Streamé¡çš„æ³›å‹åƒæ•¸çš„ï¼Œä¸éä¸€èˆ¬å°±æ˜¯é€™å€‹é›†åˆæä¾›çš„é‚£ç¨®é¡å‹)ï¼Œè€ŒSystem.out.printlnå¯ä»¥æ¥å—ä¸€å€‹Objectï¼Œå› æ­¤forEachæä¾›çš„åƒæ•¸å’ŒSystem.out.printlnçš„åƒæ•¸é¡å‹æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€²è¡Œç°¡åŒ–ã€‚
åŸæœ¬æ‡‰è©²ç‚º .forEach(element -> {System.out.println(element)})ä½†æ˜¯System.out.printlnçš„åƒæ•¸å’Œå‚³éçš„åƒæ•¸elementçš„é¡å‹å®Œå…¨åŒ¹é…ï¼Œæ‰€ä»¥å¯ä»¥å¯«ç‚º .forEach(System.out::println)
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆArrayï¼‰
DVD[] dvdCollection = new DVC[15];

// A simple definition for a DVD.
public class DVD {
	public String name;
	public int releaseYear;
	public String director;

	public DVD(String name, int releaseYear, String director) {
		this.name = name;
		this.releaseYear = releaseYear;
		this.director = director;
	}

	public String toString() {
		System.out.println(this.name + ", dircted by " + this.director + ", released in " + this.releaseYear));
	}
}

DVD avengersDVD = new DVD("The Avengers", 2012, "Joss Whedon");
dvdCollection[7] = avengersDVD;

DVD incrediblesDVD = new DVD("The Incredibles", 2004, "Brad Bird");
DVD findingDoryDVD = new DVD("Finding Dory", 2016, "Andrew Stanton");
DVD lionKingDVD = new DVD("The Lion King", 2019, "Jon Favreau");

dvdCollection[3] = incrediblesDVD;
dvdCollection[9] = findingDoryDVD;
dvdCollection[2] = lionKingDVD;

// Notice that we put The Incredibles into the Array at index 3. What happens if we now run this next piece of code?
// It has been overwritten! If we still have the incrediblesDVD variable in scope, then the DVD still exists in the computer's memory. If not though, it's totally gone!

DVD starWarsDVD = new DVD("Star Wars", 1977, "George Lucas");
dvdCollection[3] = starWarsDVD;

// Reading Items from an Array
System.out.println(dvdCollection[7]);


// Notice that because we haven't yet put anything at index 10, the value it contains is null. In other languages, such as C, the Array slot could contain completely random data. Java always initializes empty Array slots to null if the Array contains objects, or to // default values if it contains primitive types. For example, the array int [] would contain the default value of 0 for each element, float[] would contain default values of 0.0, and bool[] would contain default values of false.

// This time, we're going to create an Array of ints and put the first 10 square numbers into it.

int[] squareNumbers = new int[10];

for (int i = 0; i < 10; i++) {
	int square = (i+1) * (i+1);
	squareNumbers[i] = square;
}

// a "for each" loop.
// We can use it whenever we don't need the index values

for (int square : squareNumbers) {
	System.out.println(square);
}

DVD[] array = new DVD[6];
int capacity = array.length;

ç´€éŒ„length
int array = new int[6];
int length = 0;

for (int i = 0; i<3; i++) {
	array[i] = i * i;
	length++;		// ç´¯åŠ å™¨ ç´€éŒ„arrayçš„é•·åº¦
}

class Solution {
	public int findMaxConsecutiveOnes(int[] nums) {		// like ArrayList nums
		for (int i = 0; i<nums.length; i++) {
			// Do something with element nums[i].
		}
	}
}






___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆDesign Patternï¼‰
ç‰©ä»¶å°å‘è¨­è¨ˆåŸºæœ¬åŸå‰‡ - SOLID
Single Responsibility Principle(SRP)å–®ä¸€è·è²¬
Open/Close Principle(OCP)é–‹æ”¾/å°é–‰åŸå‰‡	e.x. æ”¹å‹•ä¸å½±éŸ¿
Liskov Substitution Principle(LSP)Liskovæ›¿æ›	e.x. @Override
Interface Segregation Principle(ISP)ä»‹é¢éš”é›¢	e.x. interfaceã€class
Dependency Inversion Principle(DIP)ä¾è³´åè½‰	e.x. é«˜éšæ¨¡çµ„ä¸æ‡‰è©²ä¾è³´æ–¼ä½éšæ¨¡çµ„â†’é«˜ã€ä½éšæ¨¡çµ„éƒ½æ‡‰è©²ä¾è³´æŠ½è±¡ã€æŠ½è±¡ä¸æ‡‰è©²ä¾è³´æ–¼å…·é«”å¯¦ä½œæ–¹å¼â†’å…·é«”å¯¦ä½œæ–¹å¼æ‡‰è©²ä¾è³´æŠ½è±¡
è§£é™¤ é«˜éšæ¨¡çµ„ (Caller å‘¼å«è€…) èˆ‡ ä½éšæ¨¡çµ„ (Callee è¢«å‘¼å«è€…)çš„ è€¦åˆé—œä¿‚ï¼Œä½¿é«˜éšæ¨¡çµ„ä¸å†ç›´æ¥ä¾è³´ä½éšæ¨¡çµ„ã€‚
æˆ‘å€‘çœŸæ­£æ‰€éœ€è¦çš„ã€ä¾è³´çš„ï¼Œå…¶å¯¦ä¸æ˜¯å¯¦éš›çš„é¡åˆ¥èˆ‡ç‰©ä»¶ï¼Œè€Œæ˜¯ä»–æ‰€æ“æœ‰çš„åŠŸèƒ½ã€‚

ä¾æ“šã€ä»‹é¢å°å‘ç¨‹å¼è¨­è¨ˆã€ï¼Œå–„ç”¨ä»‹é¢çš„å¥½è™•ï¼Œä½¿å¾—ç³»çµ±å…·æœ‰é«˜ç¶­è­·æ€§èˆ‡å½ˆæ€§ï¼Œ
ä¸è«–æ˜¯æ“´å……æˆ–é‡æ§‹ï¼Œå¤–éƒ¨å‘¼å«é¡åˆ¥åƒ…æœƒå—åˆ°æœ€å°å¹…åº¦çš„å½±éŸ¿ (ç”šè‡³ä¸å—å½±éŸ¿)ã€‚
å¦å¤–ï¼Œé¸æ“‡ä½¿ç”¨ä»‹é¢æˆ–æŠ½è±¡é¡åˆ¥æ™‚ï¼šé™¤ééœ€è¦ç‚ºå­é¡åˆ¥æä¾›å…¬å…±åŠŸèƒ½ï¼Œå¦å‰‡ å„ªå…ˆä½¿ç”¨ä»‹é¢ã€‚
ä»‹é¢çš„æ€æƒ³ï¼šå°è£éš”é›¢	// å¤–éƒ¨é¡åˆ¥åªéœ€è¦å‘¼å«ä»‹é¢æä¾›çš„æ–¹æ³•ï¼Œä¸ç”¨ä¹Ÿä¸éœ€è¦çŸ¥é“å…§éƒ¨å¦‚ä½•å¯¦ä½œã€‚
public class Main {
	public static void main(String[] args) {
		People me = new People();
		me.eat();
	}
}
class People {
	private Stuffer stuffer;		// ä¾è³´å°±åƒåƒæ•¸éœ€è¦çš„typeï¼Œéœ€è¦é¡åˆ¥typeæˆ‘å€‘å°±æ‹¿æŠ½è±¡ç‚ºä¸»å›‰

	public People() {
		stuffer = new Hamburger();
	}
	public void eat() {	
		stuffer.stuff();
	}
}

interface Stuffer {
	void stuff();
}

class Hamburger implements Stuffer {
	@Override
	public void stuff() {
		System.out.println("è®š");
	}
}
é‚„å­˜åœ¨ä¸€å€‹å¤§å•é¡Œ â€” People ä»å¿…é ˆè‡ªå·±å» new ä¸€å€‹å…·é«”å¯¦ä½œï¼
Stuffer stuffer = new Hamburger();
é€™é•åäº† ä»‹é¢çš„æ€æƒ³ï¼šå°è£éš”é›¢ã€‚People ä¸æ‡‰çŸ¥é“å…·é«”çš„å¯¦ä½œé¡åˆ¥æ˜¯èª°ï¼Œå…·é«”çš„å¯¦ä½œ æ‡‰æ˜¯å¯ã€ æ›¿æ› ã€çš„ã€‚
ç”± runtime (é‹è¡Œæ™‚) å‚³å…¥ï¼Œè€Œé compile (ç·¨è­¯æ™‚) å°±æ±ºå®šï¼Œ
æ‰€ä»¥åˆè¢«ç¨±ç‚º â€”â€” Plugin (æ’ä»¶)ã€‚



Singleton(Greed Singletonï¼Œå› ç‚ºä¸€é–‹å§‹å°±å·²ç¶“å»ºç«‹ç‰©ä»¶)
ä¿è­‰ä¸€å€‹é¡åˆ¥åªæœƒç”¢ç”Ÿä¸€å€‹ç‰©ä»¶ï¼Œè€Œä¸”è¦æä¾›å­˜å–è©²ç‰©ä»¶çš„çµ±ä¸€æ–¹æ³•
public class SingletonGreed {
	// ä¸€é–‹å§‹å°±å»ºç«‹ç‰©ä»¶ï¼Œé€™æ¨£åªè¦ä¸€ç›´å›å‚³é€™å€‹ç‰©ä»¶å°±æ˜¯ç°¡å–®çš„singleton
	private static SingletonGreed instance = new SingletonGreed();

	// private constructorï¼Œé€™æ¨£å…¶ä»–ç‰©ä»¶å°±ä¸èƒ½newå–å¾—å¯¦é«”
	private SingletonGreed() {}

	// å› ç‚ºconstructorå·²ç¶“privateï¼Œæ‰€ä»¥éœ€è¦å¦å¤–æä¾›æ–¹æ³•è®“å…¶ä»–ç¨‹å¼èª¿ç”¨é€™å€‹é¡åˆ¥
	public static SingletonGreed getInstance() {
		return instance;
	}
}


å‡å¦‚å»ºç«‹é€™å€‹ç‰©ä»¶éœ€è¦è€—è²»å¾ˆå¤šè³‡æºï¼Œå¯æ˜¯ç¨‹å¼é‹è¡Œä¸­ä¸ä¸€å®šæœƒéœ€è¦å®ƒï¼Œæˆ‘å€‘å¸Œæœ›åªæœ‰åœ¨ç¬¬ä¸€æ¬¡getInstanceè¢«å‘¼å«çš„æ™‚å€™æ‰èŠ±è²»è³‡æºä¾†å»ºç«‹ç‰©ä»¶
public class Singleton {
	private static Singleton instance;

	private Singleton() {
		// é€™è£¡é¢è·‘äº†å¾ˆå¤šcodeï¼Œå»ºç«‹ç‰©ä»¶éœ€è¦èŠ±è²»å¾ˆå¤šè³‡æº
	}

	public static Singleton getInstance() {
		// ç¬¬ä¸€æ¬¡è¢«å‘¼å«çš„æ™‚å€™å†å»ºç«‹ç‰©ä»¶
		if (instance == null) {
			instance = new Singleton();
		}
		return instance;
	}
}

ä»¥ä¸Šç¨‹å¼çœ‹èµ·ä¾†æ²’å•é¡Œï¼Œä¸éå¦‚æœæ˜¯å¤šåŸ·è¡Œç·’æƒ…æ³ä¸‹å‘¼å«getInstance()ï¼Œå¯èƒ½ç¬¬ä¸€å€‹åŸ·è¡Œç·’è·‘åˆ°instance = new Singleton()æ™‚ï¼Œå°‡æ™‚é–“è®“çµ¦ç¬¬äºŒå€‹ åŸ·è¡Œç·’ï¼Œå› æ­¤ç¬¬äºŒå€‹åŸ·è¡Œç·’ä¹ŸåŸ·è¡Œäº†instance = new Singleton()ï¼Œé€ æˆåŒæ™‚newäº†å…©å€‹æ–°çš„ç‰©ä»¶ã€‚	Thread1 -> if (instance == null)ã€Thread2 -> if ( instance == null)

/**
 *  å–®ä¾‹æ¨¡å¼æ¸¬è©¦
 */
public class SingletonTest extends Thread {			// åŸ·è¡Œç·’é¡åˆ¥
	String myId;
	public SingletonTest(String id) {
		this.myId = id;
	}

	// åŸ·è¡Œç·’åŸ·è¡Œçš„æ™‚å€™å°±å»å‘¼å«Singleton.getInstance()
	public void run() {
		Singleton singleton = Singleton.getInstance();
		if (singleton != null) {
			// ç”¨hashCodeåˆ¤æ–·å‰å¾Œå…©æ¬¡å–åˆ°çš„Singletonç‰©ä»¶æ˜¯å¦ç‚ºåŒä¸€å€‹
			System.out.println(myId+"ç”¢ç”Ÿ Singleton:" + singleton.hashCode());
		}
	}

	public static void main(String[] args) {
		/*
		// å–®åŸ·è¡Œç·’çš„æ™‚å€™ï¼Œs1èˆ‡s2ç¢ºå¯¦ç‚ºåŒä¸€å€‹ç‰©ä»¶
		Singleton s1 = Singleton.getInstance();
		Singleton s2 = Singleton.getInstance();
		System.out.println("s1:"+s1.hashCode() + " s2:" + s2.hashCode());
		System.out.println();
		*/

		// å…©å€‹åŸ·è¡Œç·’åŒæ™‚åŸ·è¡Œ
		Thread t1 = new SingletonTest("åŸ·è¡Œç·’T1");	// ç”¢ç”ŸThreadç‰©ä»¶
		Thread t2 = new SingletonTest("åŸ·è¡Œç·’T2");	// ç”¢ç”ŸThreadç‰©ä»¶
		t1.start();	// é–‹å§‹åŸ·è¡Œt1.run()	startæ˜¯threadçš„æ–¹æ³•ï¼Œæœƒå»åŸ·è¡Œrun()ï¼Œæ‰€ä»¥ç¹¼æ‰¿threadçš„é¡åˆ¥è¦å¯¦ä½œrunï¼Œrunæ˜¯Runnableä»‹é¢çš„æ–¹æ³•ã€‚
		t2.start();
	}
}

ç‚ºäº†è§£æ±ºé€™æ¨£çš„å•é¡Œï¼Œå¯ä»¥ç”¨synchronizedä¿®é£¾ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œè®“getInstanceæ–¹æ³•è¢«èª¿ç”¨çš„æ™‚å€™è¢«lockä½ï¼Œå°±ä¸æœƒåŒæ™‚ç”¢ç”Ÿå…©å€‹ç‰©ä»¶ã€‚

public class Singleton {
	private static Singleton instance;

	private Singleton() {
		// é€™è£¡é¢è·‘äº†å¾ˆå¤šcodeï¼Œå»ºç«‹ç‰©ä»¶éœ€è¦èŠ±è²»å¾ˆå¤šè³‡æº
	}

	// å¤šåŸ·è¡Œç·’æ™‚ä½¿ç”¨synchronizedä¿è­‰Singletonä¸€å®šæ˜¯å–®ä¸€çš„
	public static synchronized Singleton getInstance() {
		if (instance == null) {
			instance = new Singleton();
		}
		return instance;
	}
}

ä¸Šé¢é€™æ¨£çš„å¯«æ³•ï¼Œsynchronizedæ•´å€‹æ–¹æ³•æœƒé€ æˆåŸ·è¡Œæ•ˆèƒ½è®Šå·®ï¼Œå¯¦éš›ä¸Šéœ€è¦lockä½çš„åªæœ‰å‰µé€ ç‰©ä»¶çš„éç¨‹ï¼Œä¹Ÿå°±æ˜¯new Singletoné€™æ®µç¨‹å¼ç¢¼è€Œå·²ï¼Œå› æ­¤å¯ä»¥å°‡synchronizedæ¬åˆ°getInstance()å…§ä¾†åŠ å¿«ç¨‹å¼çš„æ•ˆèƒ½ã€‚

public class Singleton {
	private static Singleton instance;

	private Singleton() {
		// é€™è£¡é¢è·‘äº†å¾ˆå¤šcodeï¼Œå»ºç«‹ç‰©ä»¶éœ€è¦èŠ±è²»å¾ˆå¤šè³‡æº
	}

	// å¤šåŸ·è¡Œç·’æ™‚ï¼Œç•¶ç‰©ä»¶éœ€è¦è¢«å»ºç«‹æ™‚æ‰ä½¿ç”¨synchronizedä¿è­‰Singletonä¸€å®šæ˜¯å–®ä¸€çš„ï¼Œå¢åŠ ç¨‹å¼æ•ˆèƒ½
	public static Singleton getInstance() {
		if (instance == null) {
			synchronized(Singleton.class) {
				if (instance == null) {
					instance = new Singleton();
				}
			}
		}
		return instance;
	}
}

Conclusion
ä¸€æ¨£çš„è¨­è¨ˆæ¨¡å¼åœ¨ä¸åŒçš„æƒ…æ³ä¹Ÿæ˜¯æœƒæœ‰ä¸åŒçš„è®ŠåŒ–ã€‚è¨­è¨ˆæ¨¡å¼ä¸æœƒæ˜¯ä¸€æ®µå›ºå®šçš„ç¨‹å¼ç¢¼ï¼Œè€Œæ˜¯ä¸€ç¨®å¦‚ä½•è§£æ±ºç‰¹å®šå•é¡Œçš„æ¦‚å¿µã€‚


SimpleFactory
å®šç¾©ä¸€å€‹ç°¡å–®å·¥å» ï¼Œå‚³å…¥ä¸åŒçš„åƒæ•¸å–å¾—ä¸åŒçš„é¡åˆ¥ç‰©ä»¶
åˆç¨±ç‚ºéœæ…‹å·¥å» æ¨¡å¼ï¼Œä¸€èˆ¬ä¾†èªªåŒä¸€å·¥å» å…§æ‰€ç”¢ç”Ÿçš„é¡åˆ¥æœƒæœ‰ä¸€å€‹å…±åŒçš„çˆ¶é¡åˆ¥(ä»‹é¢)

ç®¡ç†ç‰©ä»¶å‰µå»ºçš„æ¨¡å¼ï¼Œéš¨è‘—è¼¸å…¥çš„åƒæ•¸ä¸åŒï¼Œç°¡å–®å·¥å» æœƒå‚³å›ä¸åŒçš„ç‰©ä»¶ï¼Œä½¿ç”¨è€…å–å¾—ç‰©ä»¶çš„æ™‚å€™åªè¦å‚³å…¥æ­£ç¢ºçš„åƒæ•¸ï¼Œä¸éœ€è¦å»ç†è§£é€™å€‹ç‰©ä»¶ã€‚

ç”¨æ–°æ‰‹æ‘èˆ‰ä¾‹ï¼Œç¾åœ¨è¦å¤šè¨“ç·´ä¸€ç¨®å†’éšªè€…ç‰§å¸«Priestï¼Œåªè¦åœ¨trainAdventureræ–¹æ³•å…§å¢åŠ ä¸€å€‹switch caseåˆ†æ”¯å°±å¥½ã€‚ä¸éé€™æ¨£ç›´æ¥ä¿®æ”¹TrainingCampé¡åˆ¥çš„ç¨‹å¼ç¢¼ï¼Œé•åäº†é–‹æ”¾/å°é–‰åŸå‰‡ï¼Œå› æ­¤ç°¡å–®å·¥å» ä¸èƒ½ç®—æ˜¯ä¸€å€‹å¥å…¨çš„è¨­è¨ˆæ¨¡å¼ï¼Œä¸éå¦‚æœç°¡å–®å·¥å» åœ¨å°å‹çš„è»Ÿé«”æ¶æ§‹ä¸­å¾ˆå¥½ç”¨ï¼Œå› æ­¤ä¸€èˆ¬è¨­è¨ˆæ¨¡å¼çš„æ•™å­¸éƒ½æœƒå¾ç°¡å–®å·¥å» æ¨¡å¼é–‹å§‹ï¼Œå¯¦å‹™ä¸Šä¹Ÿå¸¸å¸¸æœƒç”¨åˆ°é€™å€‹ç°¡å–®çš„æ¨¡å¼ã€‚

TrainingCamp				Adventurer
+TrainingCamp()		----------------------->+getType():String
+trainAdventurer(String):Adventurer

				Archer			Warrior
				+Archer()			+Warrior()
				+getType():String		+getType():String
ç”¢å“ä»‹é¢èˆ‡å¯¦ä½œé¡åˆ¥

// å†’éšªè€…(Product)
public interface Adventurer {
	// å‘Šè¨´åˆ¥äººä½ æ˜¯å“ªç¨®å†’éšªè€…
	String getType();
}

// å¼“ç®­æ‰‹(ConcreteProduct)
public class Archer implements Adventurer {
	@Override
	public String getType() {
		System.out.println("æˆ‘æ˜¯å¼“ç®­æ‰‹");
		return this.getClass().getSimpleName();
	}
}

// é¬¥å£«(ConcreteProduct)
public class Warrior implements Adventurer {
	@Override
	public String getType() {
		System.out.println("æˆ‘æ˜¯é¬¥å£«");
		return this.getClass().getSimpleName();
	}
}

ç°¡å–®å·¥å» é¡åˆ¥

/**
 *  å†’éšªè€…è¨“ç·´ç‡Ÿ(SimpleFactory)
 */
public class TrainingCamp {
	public static Adventurer trainAdventurer(String type) {
		switch(type) {
			case "archer" : {
				System.out.println("è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹");
				return new Archer();
			}
			case "Warrior : {
				System.out.println("è¨“ç·´ä¸€å€‹é¬¥å£«");
				return new Warrior();
			}
			// å‡å¦‚å†’éšªè€…ç¨®é¡æ–°å¢ï¼Œå¢åŠ case
			default : return null;
		}
	}
}

æ¸¬è©¦ç¢¼

// å†’éšªè€…è¨“ç·´ç‡Ÿæ¸¬è©¦
public class TrainingCampTest {
	@Test
	public void test() {
		System.out.println("============ç°¡å–®å·¥å» æ¨¡å¼============");

		// æ–°æ‰‹æ‘è¨“ç·´å†’éšªè€…
		Adventurer memberA = TrainingCamp.trainAdventurer("archer");
		Adventurer memberB = TrainingCamp.trainAdventurer("warrior");
		// é€™é‚Šç”¨Junitä¾†å¹«æˆ‘å€‘åˆ¤è¨“ç·´å‡ºä¾†çš„å†’éšªè€…æ˜¯ä¸æ˜¯æˆ‘å€‘è¦çš„
		Assert.assertEquals(memberA.getType(), "Archer");
		Assert.assertEquals(memberB.getType(), "Warrior");
	}
}

æ¸¬è©¦çµæœ

============ç°¡å–®å·¥å» æ¨¡å¼============
è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹
è¨“ç·´ä¸€å€‹é¬¥å£«
æˆ‘æ˜¯å¼“ç®­æ‰‹
æˆ‘æ˜¯é¬¥å£«


Factory Pattern
æä¾›ä¸€å€‹å·¥å» ä»‹é¢ï¼Œå°‡ç”¢ç”Ÿå¯¦é«”çš„ç¨‹å¼ç¢¼äº¤ç”±å­é¡åˆ¥å„è‡ªå¯¦ç¾

åœ¨å·¥å» æ¨¡å¼ä¸­ï¼Œæˆ‘å€‘å°‡å·¥å» (Factory)æå‡ç‚ºä¸€ç¨®æŠ½è±¡çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯èªªç¾åœ¨å·¥å» æ˜¯ä¸€å€‹ä»‹é¢(Interface)ï¼Œå¯¦éš›ä¸Šè¦å¦‚ä½•è£½ä½œç”¢å“å‰‡äº¤çµ¦å¯¦é«”å·¥å» (Concrete Factory)ä¾†å¯¦ä½œã€‚

æ–°æ‰‹æ‘ç¾åœ¨å»ºç«‹äº†å…©åº§è¨“ç·´ç‡Ÿï¼Œå¼“ç®­æ‰‹è¨“ç·´ç‡Ÿã€é¬¥å£«è¨“ç·´ç‡Ÿã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹å¼“ç®­æ‰‹çš„è¨“ç·´æµç¨‹ï¼Œå°±ä¿®æ”¹å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿè£¡é¢çš„ç¨‹å¼ç¢¼å³å¯ï¼Œä¸ç”¨æ“”å¿ƒæ˜¯å¦æœƒå½±éŸ¿é¬¥å£«è¨“ç·´ç‡Ÿçš„é‹ä½œï¼Œè€Œä¸”å¦‚è¦å¢åŠ å†’éšªè€…çš„é¡åˆ¥å¦‚åŠå£«ï¼Œåªè¦æ–°å¢ä¸€åº§åŠå£«è¨“ç·´ç‡Ÿï¼Œå®Œå…¨ä¸æœƒæ”¹å‹•åˆ°æŠ½è±¡è¨“ç·´ç‡Ÿèˆ‡æœ¬ä¾†çš„å¯¦é«”è¨“ç·´ç‡Ÿã€‚

TrainingCamp							Adventurer
+trainAdventurer():Adventurer						+getType():String

ArcherTrainingCamp		WarriorTrainingCamp		Warrior			Archer
+ArcherTrainingCamp()	+WarriorTrainingCamp()		+Warrior()			+Archer()
+trainAdventurer():Adventurer	+trainAdventurer():Adventurer		+getType():String		+getType():String

ç”¢å“ä»‹é¢èˆ‡ç”¢å“å¯¦ä½œé¡åˆ¥

// å†’éšªè€…(Product)
public interface Adventurer {
	// å‘Šè¨´åˆ¥äººä½ æ˜¯å“ªç¨®å†’éšªè€…
	String getType();
}

// å¼“ç®­æ‰‹(ConcreteProduct)
public class Archer implements Adventurer {
	@Override
	public String getType() {
		System.out.println("æˆ‘æ˜¯å¼“ç®­æ‰‹");
		return this.getClass().getSimpleName();
	}
}

// é¬¥å£«(ConcreteProduct)
public class Warrior implements Adventurer {
	@Override
	public String getType() {
		System.out.println("æˆ‘æ˜¯é¬¥å£«");
		return this.getClass().getSimpleName();
	}
}

å·¥å» ä»‹é¢èˆ‡å·¥å» å¯¦ä½œé¡åˆ¥

/**
 *  å†’éšªè€…è¨“ç·´ç‡Ÿä»‹é¢(Factory)-é€™é‚Šåªæ˜¯ä¸€å€‹æ¦‚å¿µæˆ–è¦ç¯„ï¼Œè¨“ç·´ä»€éº¼ã€æ€éº¼è¨“ç·´ç•™çµ¦å­é¡åˆ¥å¯¦ä½œ
 */
public interface TrainingCamp {
	public Adventurer trainAdventurer();
}

/**
 *  å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿ(ConcreteFactory)
 */
public class ArcherTrainingCamp implements TrainingCamp {
	@Override
	public Adventurer trainAdventurer() {
		System.out.println("è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹");
		return new Archer();
	}
}

/**
 *  é¬¥å£«è¨“ç·´ç‡Ÿ(ConcreteFactory)
 */
public class WarriorTrainingCamp implements TrainingCamp {
	@Override
	public Adventurer trainAdventurer() {
		System.out.println("è¨“ç·´ä¸€å€‹é¬¥å£«");
		return new Warrior();
	}
}

æ¸¬è©¦ç¢¼

// å†’éšªè€…è¨“ç·´ç‡Ÿæ¸¬è©¦
public class TrainingCampTest {
	@Test
	public void test() {
		System.out.println("============å·¥å» æ¨¡å¼æ¸¬è©¦============");

		// è¨“ç·´ç‡Ÿè¨“ç·´å†’éšªè€…
		// å…ˆç”¨å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿè¨“ç·´å¼“ç®­æ‰‹
		TrainingCamp trainingCamp = new ArcherTrainingCamp();
		Adventurer memberA = traingingCamp.trainAdventurer();

		// ç”¨é¬¥å£«è¨“ç·´ç‡Ÿè¨“ç·´é¬¥å£«
		trainingCamp = new WarriorTrainingCamp();
		Adventurer memberB = trainingCamp.trainAdventurer();

		// çœ‹çœ‹æ˜¯ä¸æ˜¯çœŸçš„è¨“ç·´å‡ºæˆ‘å€‘æƒ³è¦çš„å†’éšªè€…
		Assert.assertEquals(memberA.getType(), "Archer");
		Assert.assertEquals(memberB.getType(), "Warrior");

		// memberBæ‡‰è©²æ˜¯Warriorä¸æ˜¯Knightï¼Œå› æ­¤ä¸‹é¢é€™è¡Œæœƒå ±éŒ¯
		Assert.assertEquals(memberB.getType(), "Knight");
	}
}

============å·¥å» æ¨¡å¼æ¸¬è©¦============"
è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹
è¨“ç·´ä¸€å€‹é¬¥å£«
æˆ‘æ˜¯å¼“ç®­æ‰‹
æˆ‘æ˜¯é¬¥å£«

ç°¡å–®å·¥å» æ¨¡å¼èˆ‡å·¥å» æ¨¡å¼æ¯”è¼ƒï¼š
ç°¡å–®å·¥å» æ¨¡å¼ï¼šå·¥å» ç›´æ¥è² è²¬ç®¡ç†æ‰€æœ‰çš„ç”¢å“ï¼Œåˆ©ç”¨if else | switch caseåˆ¤æ–·å¼ä¾†ç”¢ç”Ÿç”¢å“ã€‚
å·¥å» æ¨¡å¼ï¼šå·¥å» æå‡ç‚ºä¸€å€‹æ¦‚å¿µï¼Œå¯¦éš›ä¸Šç”¢ç”Ÿç”¢å“çš„æ˜¯å¯¦ä½œå·¥å» æ¦‚å¿µçš„å¯¦é«”å·¥å» ã€‚

æŠ½è±¡å·¥å» æ¨¡å¼ Abstract Factory Pattern 1

ç›®çš„ï¼šåªç”¨ä¸€å€‹å·¥å» ä»‹é¢ä¾†ç”¢ç”Ÿä¸€ç³»åˆ—ç›¸é—œçš„ç‰©ä»¶ï¼Œä½†å¯¦éš›å»ºç«‹é‚£äº›ç‰©ä»¶ç”±å¯¦ä½œå·¥å» çš„å­é¡åˆ¥ä¾†å¯¦ç¾

å‡ºç™¼å†’éšªä¹‹å‰ï¼Œä¸€å®šè¦æœ‰è£å‚™

å‡å¦‚ä¸€å€‹å†’éšªè€…éœ€è¦æ­¦å™¨ã€é ­ç›”ã€ä¸Šè¡£ã€è¤²å­ã€é‹å­ï¼•ç¨®è£å‚™ï¼Œæ‘èŠå…§åˆæœ‰ï¼”ç¨®ä¸åŒå°ˆæ¥­çš„å†’éšªè€…ï¼Œé€™æ¨£æˆ‘å€‘å°±è¦å»ºç«‹ï¼’ï¼ç¨®å·¥å» é¡åˆ¥ä¾†ç”Ÿç”¢è£å‚™ï¼Œå¦‚æœä½¿ç”¨å‰›æ‰çš„å·¥å» æ¨¡å¼ä¾†ç®¡ç†ç”Ÿç”¢è£å‚™ï¼Œå¯¦é«”å·¥å» é¡åˆ¥å°±æœƒéå¸¸å¤šã€‚å› æ­¤é€™é‚Šæ”¹è®Šä¸€ä¸‹å·¥å» çš„å®šç¾©ï¼Œé¦–å…ˆå·¥å» ä»ç„¶æ˜¯æŠ½è±¡ä»‹é¢ï¼Œä½†æ˜¯ä»‹é¢è¦å®šå·¥å» ç¾åœ¨ç”Ÿç”¢çš„ä¸æ˜¯ä¸€ç¨®ç”¢å“ï¼Œè€Œæ˜¯ç”Ÿç”¢ä¸€å€‹å†’éšªè€…é¡åˆ¥ä¸€ç³»åˆ—æ‰€æœ‰çš„è£å‚™ï¼Œä¸€é–“å·¥å» è¦ç”Ÿç”¢æ­¦å™¨ã€é ­ç›”ã€ä¸Šè¡£ã€è¤²å­ã€é‹å­(Product)ï¼Œç•¶ç„¶æœ‰äº†æŠ½è±¡å·¥å» ä»‹é¢ä¹Ÿéœ€è¦å¯¦é«”å·¥å» (ConcreteFactory)ï¼Œä¾‹å¦‚é¬¥å£«è£å‚™ç”Ÿç”¢å·¥å» å°±æœƒç”Ÿç”¢ä¸€ç³»åˆ—çš„é¬¥å£«è£å‚™(ConcreteProduct)ï¼Œé€™å°±æ˜¯æŠ½è±¡å·¥å» æ¨¡å¼ã€‚

EquipFactory						Weapon
+productWeapon():Weapon					-atk:String
+productArmor():Clothes					-range:String

WarriorEquipFactory		ArcherEquipFactory		Bow		LongSword
+WarriorEquipFactory()	+ArcherEquipFactory()		
+productWeapon():Weapon	+productWeapon():Weapon		Clothes
+productArmor():Clothes	+productArmor():Clothes		-name:String
							-def:String

						Leather		Armor

// ä¸Šè¡£ä»‹é¢(Product)

public abstract class Clothes {
	protected in def;	//é˜²ç¦¦åŠ›
	/**
	 *  å±•ç¤ºé€™ä»¶è¡£æœ
	 */
	public void display() {
		System.out.println(this.getClass().getSimpleName() + " def = " + def);
	}
	// ä»¥ä¸‹çœç•¥getter setter
}

/**
 *  ç›”ç”²(ConcreteProduct)-é¬¥å£«ä¸Šè¡£
 */
public class Armor extends Clothes {

}

/**
 *  çš®ç”²(ConcreteProduct)-å¼“ç®­æ‰‹ä¸Šè¡£
 */
public class Leather extends Clothes {
}

/**
 *  æ­¦å™¨ä»‹é¢(Product)
 */
public abstract class Weapon {
	protected int atk;
	protected int range;

	/**
	 *  å±•ç¤ºæ­¦å™¨
	 */
	public void display() {
		System.out.println(this.getClass().getSimpleName() + " atk = " + atk + " , range = " + range);
	}

	// ä»¥ä¸‹çœç•¥getter setter
}

/**
 *  é•·åŠ(ConcreteProduct)-é¬¥å£«æ­¦å™¨
 */
public class LongSword extends Weapon {

}

/**
 *  å¼“(ConcreteProduct)-å¼“ç®­æ‰‹æ­¦å™¨
 */
public class Bow extends Weapon {

}

å·¥å» ä»‹é¢èˆ‡å¯¦é«”å·¥å» é¡åˆ¥
/**
 *  è£å‚™å·¥å» ä»‹é¢(Factory)-å®šç¾©æ¯ä¸€é–“å·¥å» æ‡‰è©²ç”Ÿç”¢é‚£äº›æ±è¥¿
 */
public interface EquipFactory {
	Weapon productWeapon();
	Clothes productArmor();
}

/**
 *  å°ˆé–€ç”Ÿç”¢é¬¥å£«è£å‚™çš„å·¥å» (ConcreteFactory)
 */
public class WarriorEquipFactory implements EquipFactory {
	@Override
	public Weapon productWeapon() {
		LongSword product = new LongSword();
		product.setAtk(10);
		product.setRange(1);
		return product;
	}

	@Override
	public Clothes productArmor() {
		Armor product = new Armor();
		product.setDef(10);
		return product;
	}
}

/**
 *  å°ˆé–€ç”Ÿç”¢å¼“ç®­æ‰‹è£å‚™çš„å·¥å» (ConcreteFactory)
 */
public class ArcherEquipFactory implements EquipFactory {
	@Override
	public Weapon productWeapon() {
		Bow product = new Bow();
		product.setAtk(10);
		product.setRange(10);
		return product;
	}

	@Override
	public Clothes productArmor() {
		Leather product = new Leather();
		product.setDef(5);
		return product;
	}
}

å·¥å» æ¨¡å¼èˆ‡æŠ½è±¡å·¥å» æ¨¡å¼æ¯”è¼ƒï¼š
å·¥å» æ¨¡å¼ï¼šæ³¨é‡çš„æ˜¯å¦‚ä½•ç”Ÿç”¢ä¸€å€‹ç‰©ä»¶ï¼Œä¾‹å¦‚å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿåªè¦è² è²¬å¦‚ä½•ç”Ÿç”¢å‡ºå¼“ç®­æ‰‹ã€‚
æŠ½è±¡å·¥å» æ¨¡å¼ï¼šæ³¨é‡åœ¨ç”¢å“çš„æŠ½è±¡é—œä¿‚ï¼Œåƒæ­¦å™¨èˆ‡è¡£æœæœ¬ä¾†æ˜¯æ‰¯ä¸ä¸Šé—œä¿‚çš„å…©ç¨®ç‰©å“ï¼Œä¸éé€™å…©ç¨®ç‰©å“éƒ½å±¬æ–¼åŒä¸€ç¨®å†’éšªè€…çš„è£å‚™ï¼Œå› æ­¤ä»–å€‘å°±æœ‰äº†é€™å±¤æŠ½è±¡é—œä¿‚ã€‚


æŠ½è±¡å·¥å» æ¨¡å¼ Abstract Factory Pattern 2

ç¾åœ¨å·²ç¶“æœ‰äº†å„å¼å„æ¨£çš„å·¥å» å¯ä»¥ç”Ÿç”¢è£å‚™ï¼Œæ¥ä¸‹ä¾†çœ‹çœ‹å¯¦éš›ä¸Šæ€æ¨£çµ¦å†’éšªè€…è£å‚™ã€‚
é¦–å…ˆè¦ç‚ºå†’éšªè€…å¢åŠ å…©å€‹å±¬æ€§ï¼ŒWeaponã€Clothes
æ¥ä¸‹ä¾†è¨“ç·´ç‡Ÿå…§å¿…é ˆè¦æœ‰å°æ‡‰çš„å·¥å» ä¾†ç”Ÿç”¢å°æ‡‰çš„è£å‚™ã€‚
æœ€å¾Œå‘¼å«çš„å®¢æˆ¶ç«¯ç¨‹å¼èˆ‡å·¥å» æ¨¡å¼Factoryä¸€æ¨£ï¼Œä¸éç¾åœ¨å†’éšªè€…å€‘åœ¨è¨“ç·´å¾Œå°±æœƒç²å¾—åŸºç¤è£å‚™äº†ã€‚

æ¸¬è©¦ç¢¼ï¼š
è·ŸæŠ½è±¡å·¥å» æ¨¡å¼æ²’é—œä¿‚çš„å†’éšªè€…ï¼Œé€™äº›åªæ˜¯ç‚ºäº†æ¸¬è©¦ç”¨
// å·¥å» èˆ‡å„ç¨®è£å‚™åŒä¸Šé 

/**
 *  å†’éšªè€…
 */
public abstract class Adventurer {
	protected Weapon weapon;
	protected Clothes clothes;

	public abstract void display();
		// getter & setter çœç•¥
}

/**
 *  å¯¦é«”å·¥å» -å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿ
 */
public class ArcherTrainingCamp implements TrainingCamp {
	private static EquipFactory factory = new ArcherEquipFactory();

	@Override
	public Adventurer trainAdventurer() {
		System.out.println("è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹");
		Archer archer = new Archer();
		// ...é€²è¡ŒåŸºæœ¬è¨“ç·´
		// ...å¼“ç®­æ‰‹è¨“ç·´èª²ç¨‹
		// è¨“ç·´å®Œæˆé…ç™¼è£å‚™
		archer.setWeapon(factory.productWeapon());
		archer.setClothes(factory.productArmor());
		return archer;
	}
}

/**
 *  å·¥å» ä»‹é¢-å†’éšªè€…è¨“ç·´ç‡Ÿ(é€™åªæ˜¯ç¨®æ¦‚å¿µæˆ–è¦ç¯„ï¼Œè¦è¨“ç·´ä»€éº¼ï¼Œæ€éº¼è¨“ç·´ç•™çµ¦å­é¡åˆ¥å¯¦ä½œ)
 */
public interface TrainingCamp {
	/**
	 *  è¨“ç·´å†’éšªè€…çš„éç¨‹ï¼Œè¨“ç·´å¾Œè«‹çµ¦æˆ‘ä¸€å€‹å†’éšªè€…
	 */
	public Adventurer trainAdventurer();
}

/**
 *  å¯¦é«”å·¥å» -å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿ
 */
public class ArcherTrainingCamp implements TrainingCamp {
	private static EquipFacotry factory = new ArcherEquipFactory();

	@Override
	public Adventurer trainAdventurer() {
		System.out.println("è¨“ç·´ä¸€å€‹å¼“ç®­æ‰‹");
		Archer archer = new Archer();
		// ...é€²è¡ŒåŸºæœ¬è¨“ç·´
		// ...å¼“ç®­æ‰‹è¨“ç·´èª²ç¨‹
		// è¨“ç·´å®Œæˆé…ç™¼è£å‚™
		archer.setWeapon(factory.productWeapon());
		archer.setClothes(factory.productArmor());
		return archer;
	}
}

/**
 *  å¯¦é«”å·¥å» -é¬¥å£«è¨“ç·´ç‡Ÿ
 */
public class WarriorTrainingCamp implements TrainingCamp {
	private static EquipFactory factory = new WarriorEquipFactory();

	@Override
	public Adventurer trainAdventurer() {
		System.out.println("è¨“ç·´ä¸€å€‹é¬¥å£«");
		Warrior warrior = new Warrior();
		// ...é€²è¡ŒåŸºæœ¬è¨“ç·´
		// ...é¬¥å£«è¨“ç·´éç¨‹
		// è¨“ç·´å®Œæˆé…ç™¼è£å‚™
		warrior.setWeapon(factory.productWeapon());
		warrior.setClothes(factory.productArmor());
		return Warrior;
	}
}

/**
 *  å¼“ç®­æ‰‹
 */
public class Archer extends Adventurer {
	@Override
	public void display() {
		System.out.println("æˆ‘æ˜¯å¼“ç®­æ‰‹ï¼Œè£å‚™:");
		weapon.display();
		System.out.println();
		clothes.display();
		System.out.println();
	}
}

/**
 *  é¬¥å£«
 */
public class Warrior extends Adventurer {
	@Override
	public void display() {
		System.out.println("æˆ‘æ˜¯é¬¥å£«ï¼Œè£å‚™:");
		weapon.display();
		System.out.println();
		clothes.display();
		System.out.println();
	}
}

æ¸¬è©¦ç¢¼ï¼š
// æŠ½è±¡å·¥å» æ¨¡å¼-æ¸¬è©¦
public class EquipFactoryTest {
	private EquipFactory equipFactory;
	@Test
	/**
	 *  æ¸¬è©¦å·¥å» æ˜¯å¦èƒ½æ­£ç¢ºç”Ÿç”¢è£å‚™
	 */
	public void equipFactoryTest() {
		System.out.println("==========æŠ½åƒå·¥å» æ¨¡å¼æ¸¬è©¦==========");

		// å¹«å¼“ç®­æ‰‹ç”Ÿç”¢è£å‚™
		equipFactory = new ArcherEquipFactory();
		Clothes archerLeather = equipFactory.productArmor();
		Weapon archerBow = equipFactory.productWeapon();

		// çš®ç”²çš„é˜²ç¦¦æ‡‰è©²æ˜¯5ï¼Œå¼“çš„æ”»æ“Šç‚º10ï¼Œç¯„åœç‚º10
		Assert.assertEquals(5, archerLeather.getDef());
		Assert.assertEquals(10, archerBow.getAtk());
		Assert.assertEquals(10, archerBow.getRange());

		// å¹«é¬¥å£«ç”Ÿç”¢è£å‚™
		equipFactory = new WarriorEquipFactory();
		Clothes armor = equipFactory.productArmor();
		Weapon longSword = equipFactory.productWeapon();

		// ç›”ç”²çš„é˜²ç¦¦æ‡‰è©²æ˜¯10, é•·åŠçš„æ”»æ“Šç‚º10, ç¯„åœç‚º1
		Assert.assertEquals(10, armor.getDef());
		Assert.assertEquals(10, longSword.getAtk());
		Assert.assertEquals(1, longSword.getRange());

		// å¼“ç®­æ‰‹è¨“ç·´ç‡Ÿ
		TrainingCamp camp = new ArcherTrainingCamp();
		// è¨“ç·´å¼“ç®­æ‰‹
		Adventurer archer = camp.trainAdventurer();

		// é¬¥å£«è¨“ç·´ç‡Ÿ
		camp = new WarriorTrainingCamp();
		// è¨“ç·´é¬¥å£«
		Adventurer warrior = camp.trainAdventurer();

		archer.display();
		warrior.display();
	}
}

æ¸¬è©¦çµæœï¼š
==========æŠ½åƒå·¥å» æ¨¡å¼æ¸¬è©¦==========
æˆ‘æ˜¯å¼“ç®­æ‰‹ï¼Œè£å‚™:
	Bow atk:10 range:10
	Leather def:5
æˆ‘æ˜¯é¬¥å£«ï¼Œè£å‚™:
	LongSword atk:10 range:1
	Armor def:10


ç­–ç•¥æ¨¡å¼ Strategy Pattern
ç›®çš„ï¼šå°‡å„ç¨®å¯ä»¥äº’æ›çš„æ¼”ç®—æ³•(ç­–ç•¥)åŒ…è£æˆä¸€å€‹é¡åˆ¥

å†’éšªè€…è¦ä¾†æ‰“æ€ªç‰©äº†ï¼

å†’éšªè€…éœ€è¦é¸æ“‡ä¸åŒçš„æˆ°é¬¥ç­–ç•¥ä¾†è·Ÿå„ç¨®æ€ªç‰©æˆ°é¬¥ï¼Œæ™®é€šæ”»æ“Šã€æŠ€èƒ½ã€ç«...ã€‚

åœ¨ç­–ç•¥æ¨¡å¼ä¸­æœƒæœ‰è¦ç¯„ç”¨çš„ç­–ç•¥ä»‹é¢(Strategy)ï¼Œå„ç¨®å¯¦éš›ä¸Šçš„æˆ°é¬¥ç­–ç•¥å‰‡æ˜¯å¯¦é«”ç­–ç•¥(ConcreteStrategy)ï¼Œä½¿ç”¨ç­–ç•¥çš„å†’éšªè€…å‰‡æ˜¯ç’°å¢ƒé¡åˆ¥(Context)ã€‚

Adventurer			flightStrategy		FlightStrategy
+Adventurer()		â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’		+execute():void
+attack():void				0..1
+choiceStrategy(FlightStrategy):void		NormalAttack	UseSkill		UseItem
					+NormalAttack()	+UseSkill		+UseItem
					+execute():void	+execute():void	+execute():void

ç­–ç•¥ä»‹é¢èˆ‡ç­–ç•¥å¯¦ä½œ

// æˆ°é¬¥ç­–ç•¥(Strategy)

public interface FlightStrategy {
	void execute();
}

// ä¸€èˆ¬æ”»æ“Š(ConcreteStrategy)
public class NormalAttack implements FlightStrategy {
	@Override
	public void execute {
		System.out.println("ä½¿ç”¨ä¸€èˆ¬æ”»æ“Š");
	}
}

// ä½¿ç”¨æŠ€èƒ½(ConcreteStrategy)
public class UseSkill implements FlightStrategy {
	@Override
	public void execute() {
		System.out.println("ä½¿ç”¨è¶…ç´šç—›çš„æŠ€èƒ½æ”»æ“Š");
	}
}

// ä½¿ç”¨é“å…·(ConcreteStrategy)
public class UseItem implements FlightStrategy {
	@Override
	public void execute() {
		System.out.println("ä½¿ç”¨é“å…·ï¼Œä¸Ÿç«æŠŠ");
	}
}

ç’°å¢ƒé¡åˆ¥Context

// å†’éšªè€…(Context)
public class Adventurer {
	FlightStrategy flightStrategy;	// ä¸åŒæˆ°é¬¥æ–¹å¼æ•ˆæœä¸åŒ(strategy)

	public void attack() {
		// é è¨­æ™®é€šæ”»æ“Š
		if (flightStrategy == null) {
			flightStrategy = new NormalAttack();
		}
		flightStrategy.execute();
	}

	// é¸æ“‡ä¸åŒçš„æ­¦å™¨
	public void choiceStrategy(FlightStrategy strategy) {		// æœ‰é»é™åˆ¶èªªæˆ‘è¦ç”¨é è¨­çš„æ™®æ”»ä¹‹å¤–ï¼Œæˆ‘å°±è¦å…ˆchoiceStrategy; attack();ï¼Œå¯ä»¥æŠŠFlightStrategy strategyä¸Ÿé€²attack()å…§ã€‚defined function: 2ã€use function 1~2â†’defined 																				function: 1ã€use function: 1ã€‚
		this.flightStrategy = strategy;
	}
}

æ¸¬è©¦ç¢¼
// ç­–ç•¥æ¨¡å¼-æ¸¬è©¦
public class FlightTest {
	@Test
	public void test() {
		Adventurer ad = new Adventurer();

		// å²èŠå§†ç”¨ä¸€èˆ¬æ”»æ“Šå°±å¯ä»¥
		System.out.println("å‡ºç¾å²èŠå§†");
		ad.choiceStrategy(new NormalAttack());
		ad.attack();
		System.out.println();

		// å²å®³çš„æ•µäººç”¨æŠ€èƒ½
		System.out.println("éå¸¸å·¨å¤§çš„å²èŠå§†");
		ad.choiceStrategy(new UseSkill());
		ad.attack();
		System.out.println();

		// å‡ºç¾ä¸æ€•åˆ€æ§åªæ€•ç«çš„æ•µäºº
		System.out.println("å‡ºç¾ä¸æ€•åˆ€æ§çš„æ®­å±");
		ad.choiceStrategy(new UseItem());
		ad.attack();
	}
}

æ¸¬è©¦çµæœ
å‡ºç¾å²èŠå§†
ä½¿ç”¨ä¸€èˆ¬æ”»æ“Š

éå¸¸å·¨å¤§çš„å²èŠå§†
ä½¿ç”¨è¶…ç´šç—›çš„æŠ€èƒ½æ”»æ“Š

å‡ºç¾ä¸æ€•åˆ€æ§çš„æ®­å±
ä½¿ç”¨é“å…·ï¼Œä¸Ÿç«æŠŠ


ç­–ç•¥æ¨¡å¼å¯¦ä¾‹-æ’åº
åœ¨java APIä¸­å¯ä»¥æ‰¾åˆ°ç­–ç•¥æ¨¡å¼çš„å¯¦éš›æ‡‰ç”¨ï¼ŒCollectioné¡åˆ¥æä¾›äº†sorté€™å€‹æ–¹æ³•ä¾†å°ä¸€ç¾¤è³‡æ–™é€²è¡Œæ’åºã€‚Collections.sort(List list, Comparator<? super T> c)
è¦æ’åºçš„Listã€Comparatorï¼ŒComparatorè£¡é¢çš„æ¼”ç®—æ³•æ±ºå®šå¦‚ä½•æ’åºï¼Œä¸åŒçš„Comparatoråœ¨é€™é‚Šå°±æ˜¯ä¸åŒçš„ç­–ç•¥(Strategy)ã€‚é€™é‚Šæœ‰ä¸‰å€‹æ‘èŠï¼Œåˆ†åˆ¥å°‡ä»¥IDæ’åºçš„Comparator(SortVillageById)ã€ä»¥åç¨±æ’åºçš„Comparator(SortVillageByName)ã€ä»¥äººå£æ’åºçš„Comparator(SortVillageByPopulation)å‚³å…¥sortï¼Œå°æ¸…å–®ä¸­çš„æ‘èŠé€²è¡Œæ’åºã€‚

// æ‘èŠé¡åˆ¥ï¼Œç­‰ç­‰æ‹¿ä¾†æ’åºç”¨

public class Village {
	public int id;
	public String name;
	public int population;
	public double area;

	pubilc Village(int id, String name, int population, double area) {
		this.id = id;
		this.name = name;
		this.population = population;
		this.area = area;
	}

	@Override
	public String toString() {						// Objectçš„æ–¹æ³•ï¼Ÿæ‰€ä»¥å¯ä»¥@Overrideã€‚
		return id + "." + name + "(äººå£: " + population + " é¢ç©: " + area + ")";
	}
}

// ä½¿ç”¨IDæ’åº(ConcreteStrategy)

public class SortVillageById implements Comparator<Village> {
	@Override
	public  int compare(Village o1, Village o2) {
		if( o1.id > o2.id) {
			return 1;
		}

		if (o1.id < o2.id) {
			return -1;
		}
		return 0;
	}
}

// ç”¨æ‘èŠé¢ç©åšæ’åº(ConcreteStrategy)

public class SortVillageByArea implements Comparator<Village> {
	@Override
	public int compare(Village o1, Village o2) {
		if (o1.area > o2.area) {
			return 1;
		}

		if (o1.area < o2.area) {
			return -1;
		}
		return 0;
	}
}

// æ‘èŠåç¨±åšæ’åº(ConcreteStrategy)

public class SortVillageByName implements Comparator<Village> {
	@Override
	public int compare(Village o1, Village o2) {
		if (o1.name.charAt(0) > o2.name.charAt(0) {
			return 1;
		}

		if (o1.name.charAt(0) < o2.name.charAt(0) {
			return -1;
		}
		return 0;
	}
}

// ç­–ç•¥æ¨¡å¼æ’åº-æ¸¬è©¦

public class StrategyExample {
	public static void main(String[] args) {
		// æº–å‚™ä¸‰å€‹æ‘èŠçš„è³‡æ–™
		Village appleFarm = new Village(3, "apple farm", 32, 5.1);
		Village barnField = new Village(1, "barn field", 22, 1.7);
		Village capeValley = new Village(2, "cape valley", 10, 10.2);

		ArrayList<Village> villages = new ArrayList<>();
		villages.add(appleFarm);
		villages.add(barnField);
		villages.add(capeValley);

		System.out.println("æ²’æ’åºéçš„è³‡æ–™");
		showList(villages);

		System.out.println("æ ¹æ“šIDæ’åº");
		Collections.sort(villages, new SortVillageById());
		showList(villages);

		System.out.println("æ ¹æ“šåå­—æ’åº");
		Collections.sort(villages, new sortVillageByName());
		showList(villages);

		System.out.println("æ ¹æ“šäººå£æ’åº");
		Collections.sort(villages, new sortVillageByPopulation());
		showList(villages);

		System.out.println("æ ¹æ“šé¢ç©æ’åº");
		Collections.sort(villages, new sortVillageByArea());
		showList(villages);
	}

	// åªæ˜¯ç‚ºäº†æŠŠè³‡æ–™å°å‡ºä¾†çœ‹
	public static void showList(ArrayList<Village> list) {
		for (Village v : list) {
			System.out.println(v.toString());
		}
	}
}

ç°¡å–®å·¥å» æ¨¡å¼æ˜¯ç”¨ä¾†å»ºç«‹ç‰©ä»¶çš„æ¨¡å¼ï¼Œé—œæ³¨ç‰©ä»¶å¦‚ä½•è¢«ç”¢ç”Ÿã€‚
ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç¨®è¡Œç‚ºæ¨¡å¼ï¼Œé—œæ³¨çš„æ˜¯è¡Œç‚ºçš„å°è£ã€‚

___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆNetworkï¼‰
ç¶²è·¯ç·¨ç¨‹æ˜¯æŒ‡ç·¨å¯«é‹è¡Œåœ¨å¤šå€‹è¨­å‚™(è¨ˆç®—æ©Ÿ)çš„ç¨‹åºï¼Œé€™äº›è¨­å‚™éƒ½é€šéç¶²è·¯é€£æ¥èµ·ä¾†ã€‚
java.netåŒ…ä¸­J2SEçš„APIåŒ…å«æœ‰é¡å’Œæ¥å£ï¼Œå®ƒå€‘æä¾›ä½å±¤æ¬¡çš„é€šä¿¡ç´°ç¯€ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨é€™äº›é¡å’Œæ¥å£ï¼Œä¾†å°ˆæ³¨æ–¼è§£æ±ºå•é¡Œï¼Œè€Œä¸ç”¨é—œæ³¨é€šä¿¡ç´°ç¯€ã€‚
java.netåŒ…ä¸­æä¾›äº†å…©ç¨®å¸¸è¦‹çš„ç¶²è·¯å”è­°çš„æ”¯æŒï¼š
TCP: Transmission Control Protocol, å‚³è¼¸æ§åˆ¶å”è­°ï¼Œæ˜¯ä¸€ç¨®é¢å‘é€£æ¥çš„ã€å¯é çš„ã€åŸºæ–¼å­—ç¯€æµçš„å‚³è¼¸å±¤é€šä¿¡å”è­°ï¼ŒTCPå±¤ä½æ–¼IPå±¤ä¹‹ä¸Šã€æ‡‰ç”¨å±¤ä¹‹ä¸‹çš„ä¸­é–“å±¤ã€‚é€šå¸¸ç”¨æ–¼äº’è¯ç¶²å”è­°ï¼Œè¢«ç¨±TCP/IPã€‚
UDP: User Datagram Protocol, ç”¨æˆ¶æ•¸æ“šå ±å”è­°ï¼Œä½æ–¼OSIæ¨¡å‹çš„å‚³è¼¸å±¤ã€‚ä¸€å€‹ç„¡é€£æ¥çš„å”è­°ã€‚æä¾›äº†æ‡‰ç”¨ç¨‹åºä¹‹é–“è¦ç™¼é€æ•¸æ“šçš„æ•¸æ“šå ±ã€‚æ‡‰ç”¨ç¨‹åºå¿…é ˆå®¹è¨±ä¸€äº›ä¸Ÿå¤±ã€éŒ¯èª¤ã€é‡è¤‡çš„æ•¸æ“šåŒ…ã€‚è¦–è¨Šã€èªéŸ³ç­‰ã€‚

Socketç·¨ç¨‹

å¥—æ¥å­—ä½¿ç”¨TCPé€šä¿¡æ©Ÿåˆ¶ï¼Œå®¢æˆ¶ç«¯ç¨‹åºå‰µå»ºä¸€å€‹å¥—æ¥å­—ï¼Œä¸¦å˜—è©¦é€£æ¥ä¼ºæœå™¨çš„å¥—æ¥å­—ã€‚ç•¶é€£æ¥å»ºç«‹æ™‚ï¼Œä¼ºæœå™¨æœƒå‰µå»ºä¸€å€‹Socketå°è±¡ã€‚å®¢æˆ¶ç«¯å’Œä¼ºæœå™¨ç¾åœ¨å¯ä»¥é€šéå°Socketå°è±¡çš„å¯«å…¥å’Œè®€å–ä¾†é€²è¡Œé€šä¿¡ã€‚
java.net.Socketé¡ä»£è¡¨ä¸€å€‹å¥—æ¥å­—ï¼Œä¸¦ä¸”java.net.ServerSocketé¡ç‚ºä¼ºæœå™¨ç¨‹åºæä¾›äº†ä¸€ç¨®ä¾†ç›£è½å®¢æˆ¶ç«¯ï¼Œä¸¦èˆ‡ä»–å€‘å»ºç«‹é€£æ¥çš„æ©Ÿåˆ¶ã€‚
ä»¥ä¸‹æ­¥é©Ÿåœ¨å…©å°è¨ˆç®—æ©Ÿä¹‹é–“ä½¿ç”¨å¥—æ¥å­—å»ºç«‹TCPé€£æ¥æ™‚æœƒå‡ºç¾ï¼š

ä¼ºæœå™¨å¯¦ä¾‹åŒ–ä¸€å€‹ServerSocketå°è±¡ï¼Œè¡¨ç¤ºé€šéä¼ºæœå™¨ä¸Šçš„ç«¯å£é€šä¿¡ã€‚
ä¼ºæœå™¨èª¿ç”¨ServerSocketé¡çš„accept()ï¼Œè©²æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å®¢æˆ¶ç«¯é€£æ¥åˆ°ä¼ºæœå™¨ä¸Šçµ¦å®šçš„ç«¯å£ã€‚
ä¼ºæœå™¨æ­£åœ¨ç­‰å¾…æ™‚ï¼Œä¸€å€‹å®¢æˆ¶ç«¯å¯¦ä¾‹åŒ–ä¸€å€‹Socketå°è±¡ï¼ŒæŒ‡å®šä¼ºæœå™¨åç¨±å’Œç«¯å£è™Ÿä¾†è«‹æ±‚é€£æ¥ã€‚
Socketé¡çš„æ§‹é€ å‡½æ•¸è©¦åœ–å°‡å®¢æˆ¶ç«¯é€£æ¥åˆ°æŒ‡å®šçš„ä¼ºæœå™¨å’Œç«¯å£è™Ÿã€‚å¦‚æœé€šä¿¡è¢«å»ºç«‹ï¼Œå‰‡åœ¨å®¢æˆ¶ç«¯å‰µå»ºä¸€å€‹Socketå°è±¡èƒ½å¤ èˆ‡ä¼ºæœå™¨é€²è¡Œé€šä¿¡ã€‚
åœ¨ä¼ºæœå™¨ç«¯ï¼Œaccept()è¿”å›ä¼ºæœå™¨ä¸Šä¸€å€‹æ–°çš„Socketå¼•ç”¨ï¼Œè©²Socketé€£æ¥åˆ°å®¢æˆ¶ç«¯çš„Socketã€‚

é€£æ¥å»ºç«‹å¾Œï¼Œé€šéä½¿ç”¨I/Oæµåœ¨é€²è¡Œé€šä¿¡ï¼Œæ¯ä¸€å€‹Socketéƒ½æœ‰ä¸€å€‹è¼¸å‡ºæµå’Œä¸€å€‹è¼¸å…¥æµï¼Œå®¢æˆ¶ç«¯çš„è¼¸å‡ºæµé€£æ¥åˆ°ä¼ºæœå™¨ç«¯çš„è¼¸å…¥æµï¼Œè€Œå®¢æˆ¶ç«¯çš„è¼¸å…¥æµé€£æ¥åˆ°ä¼ºæœå™¨ç«¯çš„è¼¸å‡ºæµã€‚
TCPæ˜¯ä¸€å€‹é›™å‘çš„é€šä¿¡å”è­°ï¼Œå› æ­¤æ•¸æ“šå¯ä»¥é€šéå…©å€‹æ•¸æ“šæµåœ¨åŒä¸€æ™‚é–“ç™¼é€ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é¡æä¾›çš„ä¸€å¥—å®Œæ•´çš„æœ‰ç”¨çš„æ–¹æ³•ä¾†å¯¦ç¾Socketã€‚

ServerSocket
public ServerSocket(int port) throws IOException
public ServerSocket(int port, int backlog) throws IOException
public ServerSocket(int port, int backlog, InetAddress address) throws IOException
public ServerSocket() throws IOException

public int getLocalPort()
public Socket accept() throws IOException
public void setSoTimeout(int timeout)
public void bind(SocketAddress host, int backlog)

Socket
public Socket(String host, int port) throws UnknownHostException, IOException
public Socket(InetAddress host, int port) throws IOException
public Socket(String host, int port, InetAddress localAddress, int localPort) throws IOException
public Socket(InetAddress host, int port, InetAddress localAddress, int localPort) throws IOException
public Socket()

public void connect(SocketAddress host, int timeout) throws IOException
public InetAddress getInetAddress()
public int getPort()
public int getLocalPort()
public SocketAddress getRemoteSocketAddress()
public InputStream getInputStream() throws IOException
public OutputStream getOutputStream throws IOException
public void close() throws IOException

InetAddress
___________________________________________________________________________________________________________________________________________________________________________________________________________________
ï¼ˆOperation Systemï¼‰
ç‚ºäº†ä¿è­‰æ“ä½œç³»çµ±çš„ç©©å®šæ€§å’Œå®‰å…¨æ€§ï¼Œä¸€å€‹é€²ç¨‹çš„åœ°å€ç©ºé–“åŠƒåˆ†ç‚ºã€Œç”¨æˆ¶ç©ºé–“(User space)ã€å’Œã€Œå…§æ ¸ç©ºé–“(Kernel space)ã€ã€‚
åƒæˆ‘å€‘å¹³å¸¸é‹è¡Œçš„æ‡‰ç”¨ç¨‹åºéƒ½æ˜¯é‹è¡Œåœ¨ç”¨æˆ¶ç©ºé–“ï¼Œåªæœ‰å…§æ ¸ç©ºé–“æ‰èƒ½é€²è¡Œç³»çµ±æ…‹ç´šåˆ¥çš„è³‡æºæœ‰é—œçš„æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶ç®¡ç†ã€é€²ç¨‹é€šä¿¡ã€å…§å­˜ç®¡ç†ç­‰ç­‰ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å€‘æƒ³è¦é€²è¡Œ IO æ“ä½œï¼Œä¸€å®šæ˜¯è¦ä¾è³´å…§æ ¸ç©ºé–“çš„èƒ½åŠ›ã€‚

ä¸¦ä¸”ï¼Œç”¨æˆ¶ç©ºé–“çš„ç¨‹åºä¸èƒ½ç›´æ¥è¨ªå•å…§æ ¸ç©ºé–“ã€‚

ç•¶æƒ³è¦åŸ·è¡Œ IO æ“ä½œæ™‚ï¼Œç”±æ–¼æ²’æœ‰åŸ·è¡Œé€™äº›æ“ä½œçš„æ¬Šé™ï¼Œåªèƒ½ç™¼èµ·ã€Œç³»çµ±èª¿ç”¨ã€è«‹æ±‚æ“ä½œç³»çµ±å¹«å¿™å®Œæˆ (é–“æ¥è¨ªå•å…§æ ¸ç©ºé–“)ï¼Œå…·é«” IO çš„åŸ·è¡Œæ˜¯ç”±æ“ä½œç³»çµ±çš„å…§æ ¸ä¾†å®Œæˆçš„ã€‚

æˆ‘å€‘åœ¨å¹³å¸¸é–‹ç™¼éç¨‹ä¸­æ¥è§¸æœ€å¤šçš„å°±æ˜¯ ç£ç›¤ IO(è®€å¯«æ–‡ä»¶) å’Œ ç¶²çµ¡ IO (ç¶²çµ¡è«‹æ±‚å’Œç›¸æ‡‰)ã€‚

ç•¶æ‡‰ç”¨ç¨‹åºç™¼èµ· I/O èª¿ç”¨å¾Œï¼Œæœƒç¶“æ­·å…©å€‹æ­¥é©Ÿï¼š
1. å…§æ ¸ç­‰å¾… I/O è¨­å‚™æº–å‚™å¥½æ•¸æ“š
2. å…§æ ¸å°‡æ•¸æ“šå¾å…§æ ¸ç©ºé–“æ‹·è²åˆ°ç”¨æˆ¶ç©ºé–“

åœ¨ Linux(UNIX) æ“ä½œç³»çµ±ä¸­ï¼Œå…±æœ‰ 5 ç¨® IO æ¨¡å‹ï¼Œåˆ†åˆ¥æ˜¯ï¼šé˜»å¡IOæ¨¡å‹ã€éé˜»å¡IOæ¨¡å‹ã€IOå¾©ç”¨æ¨¡å‹ã€ä¿¡è™Ÿé©…å‹•IOæ¨¡å‹ã€ç•°æ­¥IOæ¨¡å‹ã€‚

æˆ‘å€‘å¸¸èªªçš„IOï¼ŒæŒ‡çš„æ˜¯æ–‡ä»¶çš„è¼¸å…¥å’Œè¼¸å‡ºï¼Œä½†æ˜¯åœ¨æ“ä½œç³»çµ±å±¤é¢å¦‚ä½•å®šç¾©IOçš„å‘¢ï¼Ÿåˆ°åº•ä»€éº¼æ¨£çš„éç¨‹å¯ä»¥å«åšæ˜¯ä¸€æ¬¡IOå‘¢ï¼Ÿ
æ‹¿ç£ç¢Ÿæ–‡ä»¶è®€å–ç‚ºä¾‹ï¼Œæˆ‘å€‘è¦è®€å–çš„æ–‡ä»¶æ˜¯å­˜å„²åœ¨ç£ç›¤ä¸Šçš„ï¼Œæˆ‘å€‘çš„ç›®çš„æ˜¯æŠŠå®ƒè®€åˆ°å…§å­˜ä¸­ã€‚å¯ä»¥æŠŠé€™å€‹æ­¥é©ŸåŒ–ç°¡ç‚ºæŠŠæ•¸æ“šå¾ç¡¬ä»¶(ç¡¬ç›¤)ä¸­è®€å–åˆ°ç”¨æˆ¶ç©ºé–“ä¸­ã€‚
å…¶å¯¦çœŸæ­£çš„æ–‡ä»¶è®€å–é‚„æ¶‰åŠåˆ°ç·©å­˜ç­‰ç´°ç¯€ã€‚é—œæ–¼ç”¨æˆ¶ç©ºé–“ã€å…§æ ¸ç©ºé–“ä»¥åŠç¡¬ä»¶ç­‰çš„é—œä¿‚ï¼Œä¸€æ¬¡å®Œæ•´çš„ IO æ“ä½œï¼Œæ˜¯ã€Œæ–‡ä»¶ã€å¾ã€Œç¡¬ç›¤ã€ä¸­è½‰ç§»(æ‹·è²)åˆ°ã€Œç”¨æˆ¶ç©ºé–“ã€çš„éç¨‹ã€‚

ï¼ˆé˜»å¡IOæ¨¡å‹ï¼‰
æœ€ç°¡å–®çš„IOæ¨¡å‹ã€‚é€²ç¨‹æˆ–ç·šç¨‹ç­‰å¾…æŸå€‹æ¢ä»¶ï¼Œå¦‚æœæ¢ä»¶ä¸æ»¿è¶³ï¼Œå‰‡ä¸€ç›´ç­‰ä¸‹å»ã€‚æ¢ä»¶æ»¿è¶³ï¼Œå‰‡é€²è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚

		æ‡‰ç”¨é€²ç¨‹				ã€€ã€€ å…§æ ¸
				  ç³»çµ±èª¿ç”¨		ã€€     
	ã€€ ã€€ï½›	recvfrom		â€”â€”â€”â€”â†’	ç„¡æ•¸æ“šå ±æº–å‚™å¥½	ï½
	ã€€ ã€€ï½›							ï½
	ã€€ ã€€ï½›					           â†“		ï½
	ã€€ ã€€ï½›							ï½ç­‰å¾…æ•¸æ“š
	ã€€ ã€€ï½›							ï½
é€²ç¨‹é˜»å¡æ–¼ã€€  ï½›					  æ•¸æ“šå ±æº–å‚™å¥½	ï½
recvfromçš„èª¿ç”¨					    è¤‡è£½æ•¸æ“šå ±
	ã€€ã€€ ï½›							ï½
	ã€€ã€€ ï½›					           â†“		ï½
	ã€€ã€€ ï½›							ï½å°‡æ•¸æ“šå¾å…§æ ¸
	 ã€€ã€€ï½›							ï½è¤‡è£½åˆ°ç”¨æˆ¶ç©ºé–“
	ã€€ã€€ ï½›			è¿”å›æˆåŠŸæŒ‡ç¤º			ï½
	ã€€ã€€ ï½›	è™•ç†æ•¸æ“šå ±	â†â€”â€”â€”â€”	ã€€  è¤‡è£½å®Œæˆ	ï½

æ‡‰ç”¨é€²ç¨‹é€šéç³»çµ±èª¿ç”¨ recvfrom æ¥æ”¶æ•¸æ“šï¼Œä½†ç”±æ–¼å…§æ ¸é‚„æœªæº–å‚™å¥½æ•¸æ“šå ±ï¼Œæ‡‰ç”¨é€²ç¨‹å°±æœƒé˜»å¡ä½ï¼Œç›´åˆ°å…§æ ¸æº–å‚™å¥½æ•¸æ“šå ±ï¼Œrecvfrom å®Œæˆæ•¸æ“šå ±è¤‡è£½å·¥ä½œï¼Œæ‡‰ç”¨é€²ç¨‹æ‰èƒ½çµæŸé˜»å¡ç‹€æ…‹ã€‚

ï¼ˆéé˜»å¡IOæ¨¡å‹ï¼‰
æ‡‰ç”¨é€²ç¨‹èˆ‡å…§æ ¸äº¤äº’ï¼Œç›®çš„æœªé”åˆ°ä¹‹å‰ï¼Œä¸å†ä¸€å‘³çš„ç­‰è‘—ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ã€‚ç„¶å¾Œé€šéè¼ªè©¢çš„æ–¹å¼ï¼Œä¸åœçš„å»å•å…§æ ¸æ•¸æ“šæº–å‚™æœ‰æ²’æœ‰æº–å‚™å¥½ã€‚å¦‚æœæŸä¸€æ¬¡è¼ªè©¢ç™¼ç¾æº–å‚™å¥½äº†ï¼Œå°±é‚£æŠŠæ•¸æ“šæ‹·è²åˆ°ç”¨æˆ¶ç©ºé–“ä¸­ã€‚

		æ‡‰ç”¨é€²ç¨‹				ã€€ ã€€ã€€å…§æ ¸
				   ç³»çµ±èª¿ç”¨
	ã€€ã€€ï½›	recvfrom		â€”â€”â€”â€”â€”â†’	ã€€ç„¡æ•¸æ“šå ±æº–å‚™å¥½ã€€  ï½
	ã€€ã€€ï½›		ã€€ã€€ã€€  EWOULDBLOCK		ã€€ã€€ã€€ã€€ã€€ ï½
	ã€€ã€€ï½›			â†â€”â€”â€”â€”â€”			ã€€ï½	
	ã€€ã€€ï½›			   ç³»çµ±èª¿ç”¨			ã€€ï½
	ã€€ã€€ï½›	recvfrom		â€”â€”â€”â€”â€”â†’	ã€€ç„¡æ•¸æ“šå ±æº–å‚™å¥½     ï½
	ã€€ã€€ï½›		ã€€ã€€ã€€  EWOULDBLOCK			ã€€ï½ç­‰å¾…æ•¸æ“š
	ã€€ã€€ï½›			â†â€”â€”â€”â€”â€”			ã€€ï½
é€²ç¨‹åå¾©èª¿ç”¨			   ç³»çµ±èª¿ç”¨
recvfromç­‰å¾…è¿”	recvfrom		â€”â€”â€”â€”â€”â†’	ã€€ç„¡æ•¸æ“šå ±æº–å‚™å¥½
å›æˆåŠŸæŒ‡ç¤º		ã€€ã€€ã€€  EWOULDBLOCK
(è¼ªè©¢)				â†â€”â€”â€”â€”â€”
				   ç³»çµ±èª¿ç”¨
	ã€€ã€€ï½›	recvfrom		â€”â€”â€”â€”â€”â†’	ã€€  æ•¸æ“šå ±æº–å‚™å¥½       ï½
	ã€€ã€€ï½›					 ã€€   è¤‡è£½æ•¸æ“šå ±         ï½
	ã€€ã€€ï½›							ã€€ï½å°‡æ•¸æ“šå¾å…§æ ¸
	ã€€ã€€ï½›					ã€€ã€€ ã€€   â†“	ã€€ï½è¤‡è£½åˆ°ç”¨æˆ¶ç©ºé–“
	ã€€ã€€ï½›							ã€€ï½
	ã€€ã€€ï½›			è¿”å›æˆåŠŸæŒ‡ç¤º			ã€€ï½
	ã€€ã€€ï½›	è™•ç†æ•¸æ“šå ±	â†â€”â€”â€”â€”â€”	   ã€€   è¤‡è£½å®Œæˆ	ã€€ï½



æ‡‰ç”¨é€²ç¨‹é€šé recvfrom èª¿ç”¨ä¸åœçš„å»å’Œå…§æ ¸äº¤äº’ï¼Œç›´åˆ°å…§æ ¸æº–å‚™å¥½æ•¸æ“šå ±ã€‚å¦‚æœæ²’æœ‰æº–å‚™å¥½ï¼Œå…§æ ¸æœƒè¿”å› error ï¼Œæ‡‰ç”¨é€²ç¨‹åœ¨å¾—åˆ° error å¾Œï¼Œéä¸€æ®µæ™‚é–“å†ç™¼é€ recvfrom è«‹æ±‚ã€‚åœ¨å…©æ¬¡ç™¼é€è«‹æ±‚çš„æ™‚é–“æ®µï¼Œé€²ç¨‹å¯ä»¥å…ˆåšåˆ¥çš„äº‹æƒ…ã€‚

ï¼ˆä¿¡è™Ÿé©…å‹•IOæ¨¡å‹ï¼‰
æ‡‰ç”¨é€²ç¨‹åœ¨è®€å–æ–‡ä»¶æ™‚é€šçŸ¥å…§æ ¸ï¼Œå¦‚æœæŸå€‹ socket çš„æŸå€‹äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œè«‹å‘æˆ‘ç™¼ä¸€å€‹ä¿¡è™Ÿã€‚åœ¨æ”¶åˆ°ä¿¡è™Ÿå¾Œï¼Œä¿¡è™Ÿå°æ‡‰çš„è™•ç†å‡½æ•¸æœƒé€²è¡Œå¾ŒçºŒè™•ç†ã€‚

			   æ‡‰ç”¨é€²ç¨‹					ã€€   å…§æ ¸
						sigactionç³»çµ±èª¿ç”¨
						â€”â€”â€”â€”â€”â†’				ï½
		ï½›	å»ºç«‹SIGIOçš„		â†â€”â€”â€”â€”â€”				ï½
é€²ç¨‹ç¹¼çºŒåŸ·è¡Œ	ï½›	ä¿¡è™Ÿè™•ç†ç¨‹åº		ã€€ã€€è¿”å›					ï½
		ï½›									ï½
		ï½›									ï½
		ï½›									ï½ç­‰å¾…æ•¸æ“š
		ï½›				   éäº¤SIGIO				ï½
		ï½›	ä¿¡è™Ÿè™•ç†ç¨‹åº		â†â€”â€”â€”â€”â€”		æ•¸æ“šå ±æº–å‚™å¥½
			ã€€recvfrom		ã€€ç³»çµ±èª¿ç”¨		  è¤‡è£½æ•¸æ“šå ±	ï½
						â€”â€”â€”â€”â€”â†’				ï½
		ï½›									ï½
		ï½›									ï½å°‡æ•¸æ“šå¾å…§æ ¸
æ•¸æ“šè¤‡è£½åˆ°æ‡‰ç”¨ç·©	ï½›						ã€€	ã€€  ã€€â†“		ï½è¤‡è£½åˆ°ç”¨æˆ¶ç©ºé–“
è¡å€æœŸé–“é€²ç¨‹é˜»å¡	ï½›									ï½
		ï½›				è¿”å›æˆåŠŸæŒ‡ç¤º				ï½
		ï½›	è™•ç†æ•¸æ“šå ±		â†â€”â€”â€”â€”â€”		ã€€è¤‡è£½å®Œæˆ
		ï½›				ã€€

æ‡‰ç”¨é€²ç¨‹é å…ˆå‘å…§æ ¸è¨»å†Šä¸€å€‹ã€Œä¿¡è™Ÿè™•ç†å‡½æ•¸ã€ï¼Œç„¶å¾Œç”¨æˆ¶é€²ç¨‹è¿”å›ï¼Œä¸¦ä¸”ä¸é˜»å¡ï¼Œç•¶å…§æ ¸æ•¸æ“šæº–å‚™å°±ç·’æ™‚æœƒç™¼é€ä¸€å€‹ä¿¡è™Ÿçµ¦é€²ç¨‹ï¼Œç”¨æˆ¶é€²ç¨‹ä¾¿åœ¨ä¿¡è™Ÿè™•ç†å‡½æ•¸ä¸­é–‹å§‹æŠŠæ•¸æ“šæ‹·è²çš„ç”¨æˆ¶ç©ºé–“ä¸­ã€‚
ç›¸æ¯”å‰å¹¾ç¨®ï¼Œæ‰€ä½¿ç”¨çš„å·¥å…·æœ‰äº†ä¸€äº›è®ŠåŒ–ï¼Œéœ€è¦æœ‰ä¸€äº›å®šåˆ¶(å¯¦ç¾è¤‡é›œ)ã€‚ä½†æ˜¯å°±å¯ä»¥åœ¨ç­‰å¾…æ™‚å¾¹åº•åšåˆ¥çš„äº‹ã€‚ç­‰è‘—è­¦å ±å™¨éŸ¿å°±è¡Œã€‚

ï¼ˆIOå¾©ç”¨æ¨¡å‹ï¼‰
å¤šå€‹é€²ç¨‹çš„IOå¯ä»¥è¨»å†Šåˆ°åŒä¸€å€‹ç®¡é“ä¸Šï¼Œé€™ç®¡é“æœƒçµ±ä¸€å’Œå…§æ ¸é€²è¡Œäº¤äº’ã€‚ç•¶ç®¡é“ä¸­çš„æŸä¸€å€‹è«‹æ±‚éœ€è¦çš„æ•¸æ“šæº–å‚™å¥½ä¹‹å¾Œï¼Œé€²ç¨‹å†æŠŠå°æ‡‰çš„æ•¸æ“šæ‹·è²åˆ°ç”¨æˆ¶ç©ºé–“ä¸­ã€‚

			æ‡‰ç”¨é€²ç¨‹						ã€€ã€€ å…§æ ¸
						ã€€ç³»çµ±èª¿ç”¨
			  select			â€”â€”â€”â€”â€”â†’		ç„¡æ•¸æ“šå ±æº–å‚™å¥½
		ï½›									ï½
		ï½›									ï½
é€²ç¨‹å—é˜»æ–¼select	ï½›									ï½ç­‰å¾…æ•¸æ“š
èª¿ç”¨ï¼Œç­‰å¾…å¯èƒ½	ï½›							ã€€ã€€ã€€â†“		ï½
å¤šå€‹å¥—æ¥å­—ä¸­çš„	ï½›									ï½
ä»»ä¸€å€‹è®Šç‚ºå¯è®€	ï½›									ï½
		ï½›				è¿”å›å¯è®€æ¢ä»¶				ï½
						â†â€”â€”â€”â€”â€”		  æ•¸æ“šå ±æº–å‚™å¥½
						ã€€ç³»çµ±èª¿ç”¨		ã€€è¤‡è£½æ•¸æ“šå ±
		ï½›	recvfrom			â€”â€”â€”â€”â€”â†’				ï½			
		ï½›									ï½å°‡æ•¸æ“šå¾å…§æ ¸
æ•¸æ“šè¤‡è£½åˆ°æ‡‰ç”¨ç·©	ï½›									ï½è¤‡è£½åˆ°ç”¨æˆ¶ç©ºé–“
è¡å€æœŸé–“é€²ç¨‹é˜»å¡	ï½›							ã€€ã€€   â†“		ï½
		ï½›									ï½
		ï½›				è¿”å›æˆåŠŸæŒ‡ç¤º				ï½
		ï½›				â†â€”â€”â€”â€”â€”		ã€€ è¤‡è£½å®Œæˆ	ï½
		ï½›	è™•ç†æ•¸æ“šå ±							ï½

IOå¤šè·¯è½‰æ¥æ˜¯å¤šäº†ä¸€å€‹ select å‡½æ•¸ï¼Œå¤šå€‹é€²ç¨‹çš„IOå¯ä»¥è¨»å†Šåˆ°åŒä¸€å€‹ select ä¸Šï¼Œç•¶ç”¨æˆ¶é€²ç¨‹èª¿ç”¨è©² selectï¼Œselect æœƒç›£è½æ‰€æœ‰è¨»å†Šå¥½çš„IOï¼Œå¦‚æœæ‰€æœ‰è¢«ç›£è½çš„IOéœ€è¦çš„æ•¸æ“šéƒ½
æ²’æœ‰æº–å‚™å¥½æ™‚ï¼Œselect èª¿ç”¨é€²ç¨‹æœƒé˜»å¡ã€‚ç•¶ä»»æ„ä¸€å€‹IOæ‰€éœ€çš„æ•¸æ“šæº–å‚™å¥½ä¹‹å¾Œï¼Œselect èª¿ç”¨å°±æœƒè¿”å›ï¼Œç„¶å¾Œé€²ç¨‹å†é€šé recvfrom ä¾†é€²è¡Œæ•¸æ“šæ‹·è²ã€‚

é€™è£¡çš„IOå¾©ç”¨æ¨¡å‹ï¼Œä¸¦æ²’æœ‰å‘å…§æ ¸è¨»å†Šä¿¡è™Ÿè™•ç†å‡½æ•¸ï¼Œæ‰€ä»¥ï¼Œå®ƒä¸¦ä¸æ˜¯éé˜»å¡çš„ã€‚é€²ç¨‹åœ¨ç™¼å‡º select å¾Œï¼Œè¦ç­‰åˆ° select ç›£è½çš„æ‰€æœ‰IOæ“ä½œä¸­è‡³å°‘æœ‰ä¸€å€‹éœ€è¦çš„æ•¸æ“šæº–å‚™å¥½ï¼Œ
æ‰æœƒæœ‰è¿”å›ï¼Œä¸¦ä¸”ä¹Ÿéœ€è¦å†æ¬¡ç™¼é€è«‹æ±‚å»é€²è¡Œæ–‡ä»¶çš„æ‹·è²ã€‚

é˜»å¡IOã€éé˜»å¡IOã€ä¿¡è™Ÿé©…å‹•IOã€IOå¾©ç”¨éƒ½æ˜¯ã€ŒåŒæ­¥ã€çš„IOæ¨¡å‹ã€‚å› ç‚ºçœŸæ­£çš„æ•¸æ“šæ‹·è²éç¨‹ï¼Œéƒ½æ˜¯åŒæ­¥é€²è¡Œçš„ã€‚

ä¿¡è™Ÿé©…å‹•é›£é“ä¸æ˜¯ç•°æ­¥çš„éº¼ï¼Ÿä¿¡è™Ÿé©…å‹•ï¼Œå…§æ ¸æ˜¯åœ¨æ•¸æ“šæº–å‚™å¥½ä¹‹å¾Œé€šçŸ¥é€²ç¨‹ï¼Œç„¶å¾Œé€²ç¨‹å†é€šé recvfrom æ“ä½œé€²è¡Œæ•¸æ“šæ‹·è²ã€‚æˆ‘å€‘å¯ä»¥èªç‚ºæ•¸æ“šæº–å‚™éšæ®µæ˜¯ç•°æ­¥çš„ï¼Œ
ä½†æ˜¯ï¼Œæ•¸æ“šæ‹·è²æ“ä½œæ˜¯åŒæ­¥çš„ã€‚æ‰€ä»¥ï¼Œæ•´å€‹IOéç¨‹ä¹Ÿä¸èƒ½èªç‚ºæ˜¯ç•°æ­¥çš„ã€‚

æŠŠé‡£é­šéç¨‹ï¼Œæ‹†åˆ†ç‚ºå…©æ­¥é©Ÿï¼š1. é­šå’¬é¤Œ (æ•¸æ“šæº–å‚™)ã€‚2. æŠŠé­šé‡£èµ·ä¾†æ”¾é€²é­šç°è£¡ (æ•¸æ“šæ‹·è²)ã€‚ç„¡è«–ä»¥ä¸Šæåˆ°çš„å“ªç¨®é‡£é­šæ–¹å¼ï¼Œåœ¨ç¬¬äºŒæ­¥ï¼Œéƒ½æ˜¯éœ€è¦äººä¸»å‹•å»åšçš„ï¼Œä¸¦ä¸æ˜¯é­šç«¿è‡ªå·±å®Œæˆçš„ã€‚æ‰€ä»¥ï¼Œé€™å€‹é‡£é­šéç¨‹å…¶å¯¦é‚„æ˜¯åŒæ­¥é€²è¡Œçš„ã€‚

ç‡’æ°´çš„è­¦å ±å™¨ä¸€éŸ¿ï¼Œæ•´å€‹ç‡’æ°´éç¨‹å°±å®Œæˆäº†ã€‚æ°´å·²ç¶“æ˜¯é–‹æ°´äº†ã€‚
é‡£é­šçš„è­¦å ±å™¨ä¸€éŸ¿ï¼Œåªèƒ½èªªæ˜é­šå…’å·²ç¶“å’¬é‰¤ï¼Œä½†æ˜¯é‚„æ²’æœ‰çœŸæ­£çš„é‡£ä¸Šä¾†ã€‚

æ‰€ä»¥ï¼Œä½¿ç”¨å¸¶æœ‰è­¦å ±å™¨çš„æ°´å£ºç‡’æ°´ï¼Œç‡’æ°´éç¨‹æ˜¯ç•°æ­¥çš„ã€‚
è€Œä½¿ç”¨å¸¶æœ‰è­¦å ±å™¨çš„é­šç«¿é‡£é­šï¼Œé‡£é­šçš„éç¨‹é‚„æ˜¯åŒæ­¥çš„ã€‚

ï¼ˆç•°æ­¥IOæ¨¡å‹ï¼‰
å¯ä»¥è‡ªå‹•æ„Ÿæ‡‰é­šä¸Šé‰¤ï¼Œè‡ªå‹•æ”¶ç«¿ï¼Œæ›´å²å®³çš„å¯ä»¥è‡ªå‹•æŠŠé­šæ”¾é€²é­šç°è£¡ã€‚ç„¶å¾Œï¼Œé€šçŸ¥æˆ‘å€‘é­šå·²ç¶“é‡£åˆ°äº†ï¼Œå®ƒå°±ç¹¼çºŒå»é‡£ä¸‹ä¸€æ¢é­šå»äº†ã€‚

æ˜ å°„åˆ° Linux æ“ä½œç³»çµ±ä¸­ï¼Œé€™å°±æ˜¯ç•°æ­¥IOæ¨¡å‹ã€‚æ‡‰ç”¨é€²ç¨‹æŠŠIOè«‹æ±‚å‚³çµ¦å…§æ ¸å¾Œï¼Œå®Œå…¨ç”±å…§æ ¸å»æ“ä½œæ–‡ä»¶æ‹·è²ã€‚å…§æ ¸å®Œæˆç›¸é—œæ“ä½œå¾Œï¼Œæœƒç™¼ä¿¡è™Ÿå‘Šè¨´æ‡‰ç”¨é€²ç¨‹æœ¬æ¬¡IOå·²ç¶“å®Œæˆã€‚

		æ‡‰ç”¨é€²ç¨‹						ã€€ã€€ å…§æ ¸
					ã€€ç³»çµ±èª¿ç”¨
		aio_read			â€”â€”â€”â€”â€”â†’		ç„¡æ•¸æ“šå ±æº–å‚™å¥½	ï½
	ã€€ã€€ï½›				â†â€”â€”â€”â€”â€”				ï½
	ã€€ã€€ï½›				ã€€ã€€è¿”å›					ï½	
	ã€€ã€€ï½›							ã€€ã€€  â†“		ï½ç­‰å¾…æ•¸æ“š
	ã€€ã€€ï½›									ï½
	ã€€ã€€ï½›									ï½	
é€²ç¨‹ç¹¼çºŒåŸ·è¡Œ ï½›									ï½
	ã€€ã€€ï½›							æ•¸æ“šå ±æº–å‚™å¥½	
	ã€€ã€€ï½›							è¤‡è£½æ•¸æ“šå ±	ï½
	ã€€ã€€ï½›									ï½
	ã€€ã€€ï½›									ï½
	ã€€ã€€ï½›							ã€€ã€€  â†“		ï½å°‡æ•¸æ“šå¾å…§æ ¸
	ã€€ã€€ï½›									ï½è¤‡è£½åˆ°ç”¨æˆ¶ç©ºé–“
	ã€€ã€€ï½›ã€€	ä¿¡è™Ÿè™•ç†			éäº¤åœ¨aio_readä¸­				ï½
		ç¨‹åºè™•ç†			  â†â€”â€”â€”â€”â€”		ã€€è¤‡è£½å®Œæˆ	ï½
		æ•¸æ“šå ±			ã€€æŒ‡å®šçš„ä¿¡è™Ÿ

ç”¨æˆ¶é€²ç¨‹ç™¼èµ· aio_read æ“ä½œä¹‹å¾Œï¼Œçµ¦å…§æ ¸å‚³éæè¿°ç¬¦ã€ç·©è¡å€æŒ‡é‡ã€ç·©è¡å€å¤§å°ç­‰ï¼Œå‘Šè¨´å…§æ ¸ç•¶æ•´å€‹æ“ä½œå®Œæˆæ™‚ï¼Œå¦‚ä½•é€šçŸ¥é€²ç¨‹ï¼Œç„¶å¾Œå°±ç«‹åˆ»å»åšå…¶ä»–äº‹æƒ…äº†ã€‚
ç•¶å…§æ ¸æ”¶åˆ° aio_read å¾Œï¼Œæœƒç«‹åˆ»è¿”å›ï¼Œç„¶å¾Œå…§æ ¸é–‹å§‹ç­‰å¾…æ•¸æ“šæº–å‚™ï¼Œæ•¸æ“šæº–å‚™å¥½ä»¥å¾Œï¼Œç›´æ¥æŠŠæ•¸æ“šæ‹·è²åˆ°ç”¨æˆ¶ç©ºé–“ï¼Œç„¶å¾Œå†é€šçŸ¥é€²ç¨‹æœ¬æ¬¡IOå·²ç¶“å®Œæˆã€‚

5 ç¨® IO æ¨¡å‹å°æ¯”ï¼š

é˜»å¡I/O		éé˜»å¡I/O	ä¿¡è™Ÿé©…å‹•I/O	I/Oå¾©ç”¨		ç•°æ­¥I/O
  ç™¼èµ·		ã€€æª¢æŸ¥		ã€€ã€€		  æª¢æŸ¥		   ç™¼èµ·		ï½
ã€€ï½œ		ã€€æª¢æŸ¥				ã€€ï½œ				ï½
ã€€ï½œ		ã€€æª¢æŸ¥				ã€€ï½œé˜»å¡				ï½ç­‰å¾…
ã€€ï½œ		ã€€æª¢æŸ¥				ã€€â†“				ï½æ•¸æ“š
ã€€ï½œé˜»å¡		ã€€æª¢æŸ¥		ã€€ã€€é€šçŸ¥		  å°±ç·’				ï½
ã€€ï½œ		 ã€€ ï½œ		ã€€ã€€ç™¼èµ·		  ç™¼èµ·				ï½
ã€€ï½œ		  ã€€ï½œé˜»å¡	ã€€ã€€  ï½œ		ã€€ï½œ				ï½å°‡æ•¸æ“šå¾
ã€€ï½œ		 ã€€ ï½œ		ã€€ã€€  ï½œé˜»å¡	ã€€ï½œé˜»å¡				ï½å…§æ ¸è¤‡è£½
ã€€â†“		ã€€  â†“		ã€€ã€€  â†“		ã€€â†“				ï½åˆ°ç”¨æˆ¶ç©ºé–“
  å®Œæˆ		ã€€å®Œæˆ		ã€€ã€€å®Œæˆ		  å®Œæˆ		   é€šçŸ¥		ï½


